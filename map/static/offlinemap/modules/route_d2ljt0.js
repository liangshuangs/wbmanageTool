/**/﻿_jsload&&_jsload('route', 'function gy(e,hJ,i){d5.call(this);if(!e){return}this.container=(typeof(e)=="object")?e:C.G(e);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=hJ;this.update=true;var T={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!i){i=T}for(var hI in i){if(typeof(i[hI])!="undefined"){this[hI]=i[hI]}}this.render()}C.extend(gy.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var i=location.search;var T=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var e=i.match(T);this.page=RegExp.$1},createHtml:function(){var hO=[];var hI=this.page-1;var hL=this.page+1;hO.push(\'<p style="margin:0;padding:0;white-space:nowrap">\');if(hI<1){}else{if(this.page>=this.pagecap){var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp1}">首页</a></span>\';hO.push(T.replace("{temp1}","BMapGL.I(\'"+this.hashCode+"\').toPage(1);"))}var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp2}">上一页</a></span>\';hO.push(T.replace("{temp2}","BMapGL.I(\'"+this.hashCode+"\').toPage("+hI+");"))}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var hJ=this.page-this.pagecap-1}else{var hJ=this.page-this.page%this.pagecap+1}var hM=hJ+this.pagecap-1}else{var hN=Math.floor(this.pagecap/2);var hK=this.pagecap%2-1;if(this.pageCount>this.page+hN){var hM=this.page+hN;var hJ=this.page-hN-hK}else{var hM=this.pageCount;var hJ=this.page-hN-hK}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var hJ=this.pageCount-this.pagecap+1;var hM=this.pageCount}for(var e=hJ;e<=hM;e++){if(e>0){if(e==this.page){hO.push(\'<span style="margin-right:3px">\'+e+"</span>")}else{if(e>=1&&e<=this.pageCount){var T=\'<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="{temp3}">[\'+e+"]</a></span>";hO.push(T.replace("{temp3}","BMapGL.I(\'"+this.hashCode+"\').toPage("+e+");"))}}}}if(hL>this.pageCount){}else{var T=\'<span><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp4}">下一页</a></span>\';hO.push(T.replace("{temp4}","BMapGL.I(\'"+this.hashCode+"\').toPage("+hL+");"))}hO.push("</p>");return hO.join("")},toPage:function(i){var e=i?i:1;if(typeof(this.callback)=="function"){this.callback(e);this.page=e}if(this.update){this.render()}}});function f9(e){this["city"]=e.city;this._start=e.start;this._end=e.end;this._plans=e.plans;this["moreResultsUrl"]=e.url;this["taxiFare"]=e.taxiFare||null;this._startStatus=e.startStatus||BMAP_ROUTE_STATUS_NORMAL;this._endStatus=e.endStatus||BMAP_ROUTE_STATUS_NORMAL}C.extend(f9.prototype,{getStart:function(){return this._start},getEnd:function(){return this._end},getStartStatus:function(){return this._startStatus},getEndStatus:function(){return this._endStatus},getNumPlans:function(){return this._plans.length},getPlan:function(e){if(this._plans[e]){return this._plans[e]}}});function dh(e){f9.call(this,e);this["policy"]=e.policy}C.inherit(dh,f9,"DrivingRouteResult");function cO(e){f9.call(this,e)}C.inherit(cO,f9,"WalkingRouteResult");function au(e){f9.call(this,e)}C.inherit(au,f9,"RidingRouteResult");function aA(e){f9.call(this,e);this["policy"]=e.policy;this["transitType"]=e.transitType;this["intercityPolicy"]=e.intercityPolicy;this["transitTypePolicy"]=e.transitTypePolicy}C.inherit(aA,f9,"TransitRouteResult");C.extend(aA.prototype,{getTransitType:function(){return this["transitType"]}});function gI(e){this._routes=e.routes.slice(0);this._distance=e.distance||0;this._duration=e.duration||0;this._dragPois=e.dragPois||[]}C.extend(gI.prototype,{getRoute:function(e){if(this._routes[e]){return this._routes[e]}},getNumRoutes:function(){return this._routes.length},getDistance:function(e){if(e===false){return this._distance}else{return aR(this._distance)}},getDuration:function(e){if(e===false){return this._duration}else{return aE(this._duration,"nav")}},getDragPois:function(){return this._dragPois}});function b0(e){gI.call(this,e);this._lines=e.lines;this._description=e.description;this._duration=e.duration||0;this._totalType=e.totalType||[];this._total=e.total||[]}C.inherit(b0,gI,"TransitRoutePlan");C.extend(b0.prototype,{getNumLines:function(){return this._lines.length},getLine:function(e){if(this._lines[e]){return this._lines[e]}},getDescription:function(e){if(e===false){return O.removeHtml(this._description)}else{return this._description}},getDuration:function(e){if(e===false){return this._duration}else{return aE(this._duration,"bustime")}},getLinesTitle:function(){var hI="";var e=this._lines.length-1;for(var T=0;T<e;T++){if(this._lines[T]&&this._lines[T]["title"]){hI+=this._lines[T]["title"]+" → "}}hI+=this._lines[e]["title"];return hI},getBusName:function(e){return e.substring(0,e.indexOf("("))},getWalkDistance:function(){var T=0;var e=this._routes.length;for(var hI=0;hI<e;hI++){T+=this._routes[hI].getDistance(false)}return aR(T)},getNumTotal:function(){return this._totalType.length},getTotalType:function(e){return this._totalType[e]},getTotal:function(e){return this._total[e]}});function dY(e){this._steps=e.steps&&e.steps.slice(0)||[];this._distance=e.distance||0;this._index=e.index||0;this._points=e.points.slice(0);this._planIndex=e.planIndex||0;this._rt=e.rt;if(this._distance===0&&this._points.length>2){this._points.length=2}}C.extend(dY.prototype,{getNumSteps:function(){return this._steps.length},getStep:function(e){if(this._steps[e]){return this._steps[e]}},getDistance:function(e){if(e===false){return this._distance}else{return aR(this._distance)}},getIndex:function(){return this._index},getPolyline:function(){return this._polyline},getPath:function(){return this._points},getRouteType:function(){return this._rt},getPlanIndex:function(){return this._planIndex}});function hc(e){this["title"]=e.title;this.uid=e.uid;this["type"]=e.type;this._stops=e.stops.slice(0);this._points=e.points.slice(0);this._distance=e.distance||0;this._numViaStops=e.numViaStops||0;this._status=e.status||{}}C.extend(hc.prototype,{getNumViaStops:function(){return this._numViaStops},getGetOnStop:function(){return this._stops[0]},getGetOffStop:function(){return this._stops[1]},getPath:function(){return this._points},getPolyline:function(){return this._polyline},getDistance:function(e){if(e===false){return this._distance}else{return aR(this._distance)}},getTitle:function(){return this["title"]}});function eq(e){this._path=e.path;this._point=e.point;this._index=e.index;this._description=e.description;this._distance=e.distance||0;this._routeIndex=e.routeIndex||0;this._planIndex=e.planIndex||0}C.extend(eq.prototype,{getPosition:function(){return this._point},getIndex:function(){return this._index},getDescription:function(e){if(e===false){return O.removeHtml(this._description)}else{return this._description}},getDistance:function(e){if(e===false){return this._distance}else{return aR(this._distance)}},getRouteIndex:function(){return this._routeIndex},getPlanIndex:function(){return this._planIndex}});g6._genTitle=function(hJ,hL,hI){var i="-21px";var e="";if(hI===0){e+=";border-top:1px solid #e4e6e7";i="5px"}var hK="nav-ed";if(hI===0){hK="nav-st"}var T=["<div style=\'"+e+"\'><div style=\'cursor:pointer;padding:8px 0 8px 10px;line-height:15px\'"];T.push("onclick=\'"+hL+"\'>");T.push("<span class=\'navtrans-navlist-icon "+hK+"\'></span>");T.push("<div style=\'overflow:hidden;line-height:20px;\'>"+hJ);T.push("</div></div></div>");return T.join("")};g6._genResultTitle=function(T,i,e){return\'<h1 style="margin:0;border-top:1px solid #e4e6e7;\'+(e?"border-bottom:1px solid #e4e6e7;padding:10px 0 10px 7px;":"padding:10px 0 9px 7px;")+"font:bold 16px "+eV.fontFamily+\'"> \'+i+"前往 "+T+" 的路线</h1>"};C.extend(g6.prototype,{search:function(i,e){if(!i||!e){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE);return false}return true},clearResults:function(){delete this._results;delete this._ud;delete this._json;delete this._boundsPoints;delete this._segPolylinePoints;var e=this._opts.renderOptions;this._setStatus();if(e.panel){e.panel.innerHTML=""}if(e.map){e.map.closeInfoWindow()}this._clearOverlays();this._curIndex=-1},_formatDestQuery:function(i,T){var e;T=T||{};if(typeof i==="string"){e=[2,"","",i,0,""]}else{if(i instanceof hj||i instanceof cX){var hI=ef.convertLL2MC(i);e=[1,"",hI.lng+","+hI.lat,(T.wd||""),0,""]}else{var hI=ef.convertLL2MC(i.point);e=[1,""+i.uid,hI.lng+","+hI.lat,i.title,0,""]}}return e.join("$$")+"$$"},_formatDestQuery30:function(i,T){var e;T=T||{};if(typeof i==="string"){e=i}else{if(i instanceof hj||i instanceof cX){e=i.lat.toFixed(6)+","+i.lng.toFixed(6)}else{var hI=i.point;e=hI.lat.toFixed(6)+","+hI.lng.toFixed(6)}}return e},_formatDestUri:function(T,i){var e;if(typeof T==="string"){e=T}else{if(T instanceof hj||T instanceof cX){var hI=T;e=hI.lat+","+hI.lng}else{var hI=T.point;e=hI.lat+","+hI.lng}}if(typeof T!=="string"&&i&&i!==""&&typeof(i)==="string"){e="name:"+i+"|latlng:"+e}return e},getTPointQueryParam:function(e){var hI="";var T="1";var i=this._formatDestQuery(e);return i+hI+"$$"+T+"$$"},_getUriByOptions:function(i){var e;i=i||{};if(typeof dest==="string"){e=dest}else{if(dest instanceof hj||dest instanceof cX){var T=dest;e=T.lat+","+T.lng}else{var T=dest.point;e=T.lat+","+T.lng}}return e}});var c9=0;var bV=1;function aR(e){if(typeof e==="string"){e=parseFloat(e)}var i;if(!e||e<0){i="0米"}else{if(e<=10){i="10米"}else{i=e<1000?Math.round(e/10)*10+"米":(e/1000).toFixed(1)+"公里"}}if(i==="1000米"){i="1.0公里"}return i}function aE(hN,hI){if(hN===0){hN=1}if(!hN||isNaN(hN)){return""}var e="";var i=60;var hJ=i*24;var T=Math.ceil(hN/i);if(hI==="bustime"){var hM=T%10;var hK=parseInt(T/10,10);T=hM!==0?(hM>5?(++hK*10):hK?(hK*10):5):T}var hO=parseInt(T/hJ,10);T%=hJ;var hL=parseInt(T/i,10);T%=i;if(hO>=1){e+=hO+"天"}if(hL>=1){e+=hL+"小时"}if(T>=1){if(hI&&hI==="nav"&&hO>=1){return e}else{e+=T+"分钟"}}return e}function bN(e){var T=e.getSouthWest();var i=e.getNorthEast();return[T,i]}C.extend(bD.prototype,{_asyncSearch:function(){for(var T=0,e=this._queryList.length;T<e;T++){var hJ=this._queryList[T];this[hJ.method].apply(this,hJ.arguments)}delete this._queryList;var hI=this;if(this._opts.renderOptions.map){this._opts.renderOptions.map.addEventListener("onpoiselected",function(i){hI.preciseSearch(i)})}},_internalSearch:function(hI,e){var i=this;function T(hL){var hJ=hL.split("$$");var hK=hJ[0];var hM=null;if(/[0-2]/.test(hK)&&hJ.length===7){hM=hJ[+hK+1]}return hM}this._getIdByLoc(this._loc,function(hM){var hK={qt:i.QUERY_TYPE,c:hM,sn:hI,en:e,sy:i._opts.policy||0,ext:1};if(hK.sy===BMAP_TRANSIT_POLICY_AVOID_SUBWAYS){hK.f="[0,2,4,7,5,8,9,10,11]"}var hL=T(hI);var hJ=T(e);cv.request(function(hO,hN){i._rawDataCbk(hO,hN)},hK,{start:hL,end:hJ})})},search:function(T,e){if(g6.prototype.search.call(this,T,e)===true){var i=this;this._getIdByLoc(this._loc,function(hK){if(!hK){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE);return}if(typeof e==="string"||typeof T==="string"){i._setStatus(BMAP_STATUS_INVALID_REQUEST);i._triggerCbk(ft.CBK_SEARCH_COMPLETE);return}else{var hJ;hJ={output:"json",qt:fI,v:"3.0"};hJ.origin=i._formatDestQuery30(T);hJ.destination=i._formatDestQuery30(e);hJ.mode="transit";hJ.tactics_incity=i._opts.policy||0;hJ.trans_type_intercity=i._opts.transitTypePolicy||0;hJ.tactics_intercity=i._opts.intercityPolicy||0}var hI={start:T,end:e,_from:"search",policy:hJ.tactics_incity,intercityPolicy:hJ.tactics_intercity,transitTypePolicy:hJ.trans_type_intercity};cv.request(function(hM,hL){i._rawDataCbk(hM,hL)},hJ,hI)})}},preciseSearch:function(hI){if(hI.sType!==this.QUERY_TYPE){return}var hJ=hI.paramInfo;hJ.qt=this.QUERY_TYPE;var T=this;hJ.sy=T._opts.policy||0;var i={start:hJ.sq,end:hJ.eq,_from:"preciseSearch"};if(this._opts._enableTraffic){i.reqURL=eV.mapHost+"mobile/webapp/interface/wiseBus/";i.enableTraffic=true}cv.request(function(hK,e){T._rawDataCbk(hK,i)},hJ,i)},_rawDataCbk:function(i,e){var hJ=this._opts.renderOptions.map;this.clearResults();this._json=i;var hI=i.result;var hK=i.content;this._ud=e;if(hI.error!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,{})}else{if(hK.status!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,{})}else{if(hK.type===Q){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,{})}else{if(hK.type===b7){var T=hK.result;if(T.routes===null||T.routes.length===0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,{});return}if(T.origin["city_id"]===T.destination["city_id"]||T.origin["city_name"]===T.destination["city_name"]){this._json.content["transitType"]=BMAP_TRANSIT_TYPE_IN_CITY;this._processRawInCity()}else{this._json.content["transitType"]=BMAP_TRANSIT_TYPE_CROSS_CITY;this._processRawCrossCity()}this._renderList();this["_selectPlan"](0);return}}}}return},_getRouteStatus:function(T,i){var e=BMAP_ROUTE_STATUS_NORMAL;if(i===0){if(T>0){e=BMAP_ROUTE_STATUS_ADDRESS}else{e=BMAP_ROUTE_STATUS_EMPTY}}return e},_processRawInCity:function(){var ia=this;var h7=this._json.content;var h0=h7.result;var hP={};var hN={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof hj||this._ud.start instanceof cX)){C.extend(hP,this._ud.start)}else{hP.title="起点";hP.city=h0.origin["city_name"];hP.point=new hj(h0.origin["location"]["lng"],h0.origin["location"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof hj||this._ud.end instanceof cX)){C.extend(hN,this._ud.end)}else{hN.title="终点";hN.city=h0.destination["city_name"];hN.point=new hj(h0.destination["location"]["lng"],h0.destination["location"]["lat"])}var hT=h7.result["routes"];var h6=[];var hY=0;this._boundsPoints=[];for(var h3=0;h3<hT.length;h3++){if(hY>this._opts.pageCapacity-1){break}this._boundsPoints[hY]=[];var h5="<table class=\'trans-plan-content\'>";var hR=hT[h3];var hO=hR.distance;var e=hR.duration;var hI="";var h4=hR.steps;var hU=0;var h1=0;var h9=[];var hS=[];var hQ=[];var hJ=[];for(var h2=0;h2<h4.length;h2++){var hZ=h4[h2][0];var hL=[];hL.push(new hj(hZ.start_location["lng"],hZ.start_location["lat"]));hL=hL.concat(O.pathToPoints(hZ.path));hL.push(new hj(hZ.end_location["lng"],hZ.end_location["lat"]));if(hZ.vehicle_info["type"]===gG){var h8=new dY({distance:hZ.distance,points:hL,rt:BMAP_ROUTE_TYPE_WALKING,index:hU,planIndex:h3});hU++;h9.push(h8);hQ.push(h8);var hM="";if(h2===h4.length-1){hM=hN.title}else{hM=h4[h2+1][0]["vehicle_info"]["detail"]["on_station"]}h5+="<tr><td><span class=\'navtrans-bus-icon walk\'></span><div class=\'navtrans-bus-desc\'>步行约"+aR(hZ.distance)+"，到达<span class=\'navtrans-busstation\'>"+hM+"</span></div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}else{if(hZ.vehicle_info["type"]===de){var hV=hZ.vehicle_info["detail"];var hW={title:hV.on_station,point:new hj(hZ.start_location["lng"],hZ.start_location["lat"])};var hK={title:hV.off_station,point:new hj(hZ.end_location["lng"],hZ.end_location["lat"])};var hX=new hc({title:hV.name,distance:hZ.distance,points:hL,stops:[hW,hK],type:this._getLineType(hV.type,false),numViaStops:hV.stop_num});hS.push(hX);hQ.push(hX);h5+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+hV.name+"</span>，经过"+hV.stop_num+"站，到达<span class=\'navtrans-busstation\'>"+hK.title+"</span></div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}}}h5+="</table>";var T=new b0({routes:h9,lines:hS,total:hQ,distance:hO,duration:e,description:h5,totalType:hJ});h6.push(T);hY++}this._results=new aA({plans:h6,start:hP,end:hN,url:"",transitType:this._json.content["transitType"],intercityPolicy:this._ud.intercityPolicy,transitTypePolicy:this._ud.transitTypePolicy,policy:this._ud.policy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._results);return},_processRawCrossCity:function(){var ic=this;var h9=this._json.content;var h1=h9.result;var hP={};var hN={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof hj||this._ud.start instanceof cX)){C.extend(hP,this._ud.start)}else{hP.title="起点";hP.city=h1.origin["city_name"];hP.point=new hj(h1.origin["location"]["lng"],h1.origin["location"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof hj||this._ud.end instanceof cX)){C.extend(hN,this._ud.end)}else{hN.title="终点";hN.city=h1.destination["city_name"];hN.point=new hj(h1.destination["location"]["lng"],h1.destination["location"]["lat"])}var hU=h9.result["routes"];var h8=[];var hZ=0;this._boundsPoints=[];for(var h5=0;h5<hU.length;h5++){if(hZ>this._opts.pageCapacity-1){break}this._boundsPoints[hZ]=[];var h7="<table class=\'trans-plan-content\'>";var hR=hU[h5];var hO=hR.distance;var e=hR.duration;var hI="";var h6=hR.steps;var hV=0;var h3=0;var ib=[];var hS=[];var hQ=[];var hJ=[];for(var h4=0;h4<h6.length;h4++){for(var h2=0;h2<h6[h4].length;h2++){var h0=h6[h4][h2];var hL=[];hL.push(new hj(h0.start_location["lng"],h0.start_location["lat"]));hL=hL.concat(O.pathToPoints(h0.path));hL.push(new hj(h0.end_location["lng"],h0.end_location["lat"]));if(h0.vehicle_info["type"]===gG){var ia=new dY({distance:h0.distance,points:hL,rt:BMAP_ROUTE_TYPE_WALKING,index:hV,planIndex:h5});hV++;ib.push(ia);hQ.push(ia);var hM="";if(h4===h6.length-1&&h2===h6[h4].length-1){hM=hN.title}else{if(h4<h6.length-1&&h2===h6[h4].length-1){var hT=h6[h4+1][0]["vehicle_info"];switch(hT.type){case de:hM=hT.detail["on_station"];break;case hp:case dT:case gX:hM=hT.detail["departure_station"];break}}else{if(h2<h6[h4].length-1){var hT=h6[h4][h2+1]["vehicle_info"];switch(hT.type){case de:hM=hT.detail["on_station"];break;case hp:case dT:case gX:hM=hT.detail["departure_station"];break}}}}h7+="<tr><td><span class=\'navtrans-bus-icon walk\'></span><div class=\'navtrans-bus-desc\'>步行约"+aR(h0.distance)+"，到达<span class=\'navtrans-busstation\'>"+hM+"</span></div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}else{if(h0.vehicle_info["type"]===de){var hW=h0.vehicle_info["detail"];var hX={title:hW.on_station,point:new hj(h0.start_location["lng"],h0.start_location["lat"])};var hK={title:hW.off_station,point:new hj(h0.end_location["lng"],h0.end_location["lat"])};var hY=new hc({title:hW.name,distance:h0.distance,points:hL,stops:[hX,hK],type:this._getLineType(hW.type),numViaStops:hW.stop_num});hS.push(hY);hQ.push(hY);h7+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+hW.name+"</span>，经过"+hW.stop_num+"站，到达<span class=\'navtrans-busstation\'>"+hK.title+"</span></div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(h0.vehicle_info["type"]===hp){var hW=h0.vehicle_info["detail"];var hX={title:hW.departure_station,point:new hj(h0.start_location["lng"],h0.start_location["lat"])};var hK={title:hW.arrive_station,point:new hj(h0.end_location["lng"],h0.end_location["lat"])};var hY=new hc({title:hW.name,distance:h0.distance,points:hL,stops:[hX,hK],type:this._getLineType(h0.vehicle_info["type"],true)});hS.push(hY);hQ.push(hY);h7+="<tr><td><span class=\'navtrans-cross-city-icon train\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+hW.name+"</span>到达<span class=\'navtrans-busstation\'>"+hK.title+"</span></div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(h0.vehicle_info["type"]===dT){var hW=h0.vehicle_info["detail"];var hX={title:hW.departure_station,point:new hj(h0.start_location["lng"],h0.start_location["lat"])};var hK={title:hW.arrive_station,point:new hj(h0.end_location["lng"],h0.end_location["lat"])};var hY=new hc({title:hW.name,distance:h0.distance,points:hL,stops:[hX,hK],type:this._getLineType(h0.vehicle_info["type"],true)});hS.push(hY);hQ.push(hY);h7+="<tr><td><span class=\'navtrans-cross-city-icon airplane\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+hW.name+"</span>到达<span class=\'navtrans-busstation\'>"+hK.title+"</span></div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(h0.vehicle_info["type"]===gX){var hW=h0.vehicle_info["detail"];var hX={title:hW.departure_station,point:new hj(h0.start_location["lng"],h0.start_location["lat"])};var hK={title:hW.arrive_station,point:new hj(h0.end_location["lng"],h0.end_location["lat"])};var hY=new hc({title:hW.name,distance:h0.distance,points:hL,stops:[hX,hK],type:this._getLineType(h0.vehicle_info["type"],true)});hS.push(hY);hQ.push(hY);h7+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+hW.name+"</span>到达<span class=\'navtrans-busstation\'>"+hK.title+"</span></div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(h0.vehicle_info["type"]===fb){var ia=new dY({distance:h0.distance,points:hL,rt:BMAP_ROUTE_TYPE_DRIVING,index:hV,planIndex:h5});hV++;ib.push(ia);hQ.push(ia);h7+="<tr><td><span class=\'navtrans-bus-icon drive\'></span><div class=\'navtrans-bus-desc\'>驾车约"+aR(h0.distance)+"</div></td></tr>";hJ.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}}}}}}}}h7+="</table>";var T=new b0({routes:ib,lines:hS,total:hQ,distance:hO,duration:e,description:h7,totalType:hJ});h8.push(T);hZ++}this._results=new aA({plans:h8,start:hP,end:hN,url:"",transitType:this._json.content["transitType"],policy:this._ud.policy,intercityPolicy:this._ud.intercityPolicy,transitTypePolicy:this._ud.transitTypePolicy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._results);return},_renderPlan:function(hJ){var hY=this._opts.renderOptions.map;var e=[];var h0=this;if(!hY){return}var T=this._results.getPlan(hJ);if(!T){return}var hI=this._results.getStart();var hW=this._results.getEnd();var hS=cZ.addDestPoi(hY,hI.point,hI.title,c9);hI.marker=hS;hS.addEventListener("click",function(){h0._select(0)});this._overlays.push(hS);var hQ=cZ.addDestPoi(hY,hW.point,hW.title,bV);hW.marker=hQ;this._overlays.push(hQ);hQ.addEventListener("click",function(){h0._selectLast()});var hO=hI.point;var hV=hW.point;this._boundsPoints[hJ].push(hO,hV);for(var hU=0,hR=T.getNumTotal(),hT=0;hU<hR;hU++){if(T.getTotalType(hU)===BMAP_TRANSIT_PLAN_TYPE_LINE){var hN=T.getTotal(hU);var hP=cZ.addLine(hY,hN.getPath());hN._polyline=hP;this._overlays.push(hP);var hL=hN.getGetOnStop();e.push(hL);var hM=cZ.addTransPoi(hY,hL.point,hN.type,hL.title);hL.marker=hM;this._overlays.push(hM);var hZ=hN.getGetOffStop();e.push(hZ);var hK=cZ.addTransPoi(hY,hZ.point,hN.type,hZ.title);hZ.marker=hK;(function(){var i=hT;hT=hT+1;hM.addEventListener("click",function(){h0._select((i+1)*2-1)});hK.addEventListener("click",function(){h0._select((i+1)*2)})})();this._overlays.push(hK);this._boundsPoints[hJ].push(hL.point,hZ.point)}else{if(T.getTotalType(hU)===BMAP_TRANSIT_PLAN_TYPE_ROUTE){var hX=T.getTotal(hU);hP=cZ.addRoute(hY,hX.getPath(),hX.getRouteType());hX._polyline=hP;this._overlays.push(hP)}}}var h0=this;if(this._opts.renderOptions.autoViewport){hY.setViewport(this._boundsPoints[hJ],{margins:[30,30,30,30]})}this._triggerCbk(ft.CBK_POLYLINES_SET,T._lines,T._routes);this._triggerCbk(ft.CBK_MARKERS_SET,[hI,hW],e)},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var T=S("div",{style:"font:12px "+eV.fontFamily+";background:#fff"});var hT=g6._genResultTitle(this._results.getEnd()["title"],"乘公共交通工具");var hN=this._genTitleHtml(this._results.getStart()["title"],\'BMapGL.I("\'+this.hashCode+\'")["_select"](0)\',0);var hJ=this._genTitleHtml(this._results.getEnd().title,\'BMapGL.I("\'+this.hashCode+\'")["_selectLast"]()\',1);var hU=["<table style=\'font:12px "+eV.fontFamily+";border-collapse:collapse;width:100%;\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];for(var hQ=0,hO=this._results.getNumPlans();hQ<hO;hQ++){var hS=this._results.getPlan(hQ);var hL=hS.getDistance().replace(/(\\d+(?:.\\d+)?)/,"$1 ");var e=hS.getDuration().replace(/(\\d+)/,"$1 ");var hM=hS.getWalkDistance();bg="";var hR="<p style=\'margin:0px 0px 5px 0px;font-size:14px;color: #36c;\'>"+hS.getLinesTitle()+"</p>";if(this._json.content["transitType"]===BMAP_TRANSIT_TYPE_IN_CITY){hL=hL+"  &nbsp;|&nbsp;  "}else{hL=""}var hI="<p style=\'margin:5px 0px;font-size:12px;\'>"+hL+e+"  &nbsp;|&nbsp; 步行"+hM+"</p>";var hK="vertical-align:top;";hU.push("<tr class=\'tranroute-plan-list\' style=\\"cursor:pointer"+bg+\'">\');hU.push("<td style=\'"+hK+"line-height:18px\' ><div style=\'margin:3px 0px;border:1px solid #e4e6e7;\'><div class=\'trans-title\' style=\'padding: 5px 10px;\' onclick=\'BMapGL.I(\\""+this.hashCode+\'")._selectPlan(\'+hQ+")\'>"+hR+hI+"</div><div class=\'trans_plan_desc\' style=\'padding:0px 8px;margin:0px;display:none;position:relative;\'>"+hN+hS.getDescription()+hJ+"</div></div></td>");hU.push("</tr>")}hU.push("</table>");var hP="<div style=\'border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>";if(this._results.moreResultsUrl){hP+="<a style=\'color:#7777cc\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>到百度地图查看&#187;</a>"}hP+="&nbsp;</div>";T.innerHTML=hT+hU.join("")+hP;this._opts.renderOptions.panel.appendChild(T);this._triggerCbk(ft.CBK_RESULTS_HTML_SET,T)}},_select:function(hL,hN){var T=this._opts.renderOptions.map;if(T){hN=hN||window.event;var hQ=this._results.getPlan(this._curIndex);if(!hQ){return}var hP=this;var hR=hQ.getNumLines()*2;if(hL===0||hL===hR+1){var hO=hL===0?this._results.getStart():this._results.getEnd();var hJ=cZ.createTransInfoWnd({content:"<b>"+hO.title+"</b>",total:hR,curIndex:hL,nextTransCbk:function(e){hP._select(e)}});hJ.addEventListener("open",function(){hP._triggerCbk(ft.CBK_INFO_HTML_SET,hO,cZ.getInfoWindowDom(T))});var hM=hL===0?0:1;var hP=this;if(T.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(hJ,T.getCurrentCity().code,{panoInstance:T._pano,lngLat:hO.point,titleTip:hO.title,type:"busline",beforeDomId:"trans_nav"},function(){hP._overlays[hM].openInfoWindow(hJ)})}else{hP._overlays[hM].openInfoWindow(hJ)}}else{var i=hQ.getLine(Math.floor((hL+1)/2)-1);var hS;var hI=i.getTitle();var hK;if(hL%2===1){hS=i.getGetOnStop();hK=hI+"<b>"+hS.title+"上车</b>"}else{hS=i.getGetOffStop();hK=hI+"<b>"+hS.title+"下车</b>"}var hJ=cZ.createTransInfoWnd({content:hK,total:hR,curIndex:hL,nextTransCbk:function(e){hP._select(e)}});hJ.addEventListener("open",function(){hP._triggerCbk(ft.CBK_INFO_HTML_SET,hS,cZ.getInfoWindowDom(T))});var hP=this;if(T.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(hJ,T.getCurrentCity().code,{panoInstance:T._pano,lngLat:hS.point,titleTip:hS.title,type:"busline",beforeDomId:"trans_nav"},function(){hS.marker.openInfoWindow(hJ)})}else{hS.marker.openInfoWindow(hJ)}}}},_selectLast:function(hI){hI=hI||window.event;if(this._results&&this._curIndex>-1){var T=this._results.getPlan(this._curIndex);if(!T){return}var i=T.getNumLines()*2;this["_select"](i+1)}},_selectPlan:function(hK){if(!this._results&&!this._result.getPlan(hK)){return}var hN=this._results.getPlan(hK);var e=this._opts.renderOptions.map;if(e){e.closeInfoWindow();this._clearOverlays();this._renderPlan(hK)}if(this._opts.renderOptions.panel){var hO=this._opts.renderOptions.panel.getElementsByTagName("table")[0];if(!hO){return}var hL=C.getElementsByClassName(hO,"tranroute-plan-list");var hM=C.getElementsByClassName(hO,"trans_plan_desc");for(var hI=0;hI<hM.length;hI++){if(hI!==hK){hM[hI].style.display="none"}}for(var T=0;T<hL.length;T++){C.removeClassName(hL[T],"expand")}var hJ=C.getElementsByClassName(hL[hK],"trans_plan_desc")[0];if(hJ.style.display==="none"){hJ.style.display="block";C.addClassName(hL[hK],"expand")}else{hJ.style.display="none"}}this._curIndex=hK},_clearOverlays:function(){for(var e=0;e<this._overlays.length;e++){if(this._overlays[e]&&this._overlays[e]._p){this._overlays[e]._p.remove();this._overlays[e]._p=null}this._overlays[e]&&this._overlays[e].remove();this._overlays[e]=null}this._overlays.length=0},_getLineType:function(i,e){if(!e){return bD.LINE_TYPE_MAPPING[i]}else{return bD.LINE_TYPE_MAPPING_CROSS_CITY[i]}},_genTitleHtml:function(hI,hK,T){var i="";if(T===0){i+="padding-top:5px;"}var hJ="nav-ed";if(T===0){hJ="nav-st"}var e=["<div style=\'"+i+"\'><div style=\'cursor:pointer;padding:2px 0 2px 0px;line-height:15px\'"];e.push("onclick=\'"+hK+"\'>");e.push("<span class=\'navtrans-navlist-icon "+hJ+"\'></span>");e.push("<div style=\'overflow:hidden;line-height:20px;\'>"+hI);e.push("</div></div></div>");return e.join("")}});cE.MAX_THRESHOLD=20;cE.DRAG_REQ_FREQUENCE=50;cE.DRAG_MAXPOINTS=10;C.extend(cE.prototype,{init_d:function(){this._d={plys:[],viaPts:[],viaPtsInfo:[],dragOverlays:[],tipLbl:null,sliderMkr:null,dragReqFlag:false,cbkDragPt:null,cbkPly:null,isSearchByDrag:false,curDragPly:null,dragSrcCityCode:1,dragEndCityCode:1,cbkStartPoiName:"起点",cbkEndPoiName:"终点",mouseOnViaMkr:false,cxtMenu:[]}},_asyncSearch:function(){this.init_d();for(var T=0,e=this._queryList.length;T<e;T++){var hJ=this._queryList[T];this[hJ.method].apply(this,hJ.arguments)}delete this._queryList;var hI=this;if(this._opts.renderOptions.map){this._opts.renderOptions.map.addEventListener("onpoiselected",function(i){hI.preciseSearch(i)})}},search:function(hI,e,T){this._d.isSearchByDrag=false;var T=T||{};if(g6.prototype.search.call(this,hI,e)===true){var i=this;this._getIdByLoc(this._loc,function(hM){hM=hM||1;var hL;hL={output:"json",qt:fI,v:"3.0"};var hJ={start:hI,end:e};var hK="";if(i.QUERY_TYPE===ec){hL.origin=i._formatDestQuery30(hI);hL.destination=i._formatDestQuery30(e);hL.region=hM;hL.mode="walking"}else{if(i.QUERY_TYPE===cJ){if(typeof e==="string"||typeof hI==="string"){i._setStatus(BMAP_STATUS_INVALID_REQUEST);i._triggerCbk(ft.CBK_SEARCH_COMPLETE,{});return}else{hL.origin=i._formatDestQuery30(hI);hL.destination=i._formatDestQuery30(e);hL.mode="driving";hL.tactics=i._opts.policy||0;hJ.policy=hL.tactics}}else{if(i.QUERY_TYPE===R){hL.origin=i._formatDestQuery30(hI);hL.destination=i._formatDestQuery30(e);hL.region=hM;hL.mode="riding"}}}cv.request(function(hO,hN){i._rawDataCbk(hO,hN)},hL,hJ,hK)})}},_dragSearch:function(T,e){var i=this;i._d.isSearchByDrag=true;i._getIdByLoc(i._loc,function(hJ){hJ=hJ||1;var hN=ef.convertLL2MC(i._d.viaPts[0]);var hI="1$$$$"+hN.lng+","+hN.lat+"$$$$";var hR=i._d.dragSrcCityCode||hJ;var hQ="";var hK="";for(var hO=1,hL=i._d.viaPts.length;hO<hL;hO++){var hP=i._d.viaPts[hO];if(hO===hL-1){hQ+=i._formatDestQuery(hP);hK+=(i._d.dragEndCityCode||hJ)}else{if(hP.if_wp){hQ+=i.getTPointQueryParam(hP)+"+to:"}else{hQ+=i._formatDestQuery(hP)+"+to:"}hK+="0 +to:"}}var hM={qt:i.QUERY_TYPE,c:hJ,drag:1,sc:hR,ec:hK,sn:hI,en:hQ,sy:i._opts.policy||0};if(i._opts._enableTraffic){hM.route_traffic=1;hM.version=4;hM.mrs=0}var hS={start:T,end:e,enableTraffic:i._opts._enableTraffic};C.extend(hS,{useEncodeURI:true});cv.request(function(hU,hT){i._rawDataCbk(hU,hT)},hM,hS)})},preciseSearch:function(hI){var T=this;var hJ={};hJ.qt=fI;if(T.QUERY_TYPE===ec){hJ.origin=hI.paramInfo["start_name"];hJ.destination=hI.paramInfo["end_name"];hJ.region=hI.paramInfo["region"];hJ.mode="walking";hJ.v="3.0"}if(T.QUERY_TYPE===R){hJ.origin=hI.paramInfo["start_name"];hJ.destination=hI.paramInfo["end_name"];hJ.region=hI.paramInfo["region"];hJ.mode="riding";hJ.v="3.0"}var i={start:hJ.origin,end:hJ.destination};cv.request(function(hK,e){T._rawDataCbk(hK,i)},hJ,i)},_rawDataCbk:function(hN,T){this.clearResults();this._json=hN;var e=hN.result;var hK=hN.content;this._ud=T;if(e.error!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,{})}else{if(hK.status!==0||(hK.result&&hK.result["routes"]===null)){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,{})}else{if(hK.type===Q){if(this.QUERY_TYPE===ec||this.QUERY_TYPE===R){var hI=hK.result;var hJ;var hL;hJ=this._getRouteStatus30(hI.origin["content"]);hL=this._getRouteStatus30(hI.destination["content"]);if(hJ!=BMAP_ROUTE_STATUS_EMPTY&&hL!=BMAP_ROUTE_STATUS_EMPTY&&this._opts.renderOptions.map){var hM=new cH(hN,{renderOptions:this._opts.renderOptions,sType:this.QUERY_TYPE});var i=S("div",{style:"font:12px "+eV.fontFamily+";background:#fff"});i.innerHTML=hM.render(T);if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.appendChild(i);hM.initialize();return}else{hM.withoutPanelInitial();return}}this._results=this._createResults({city:"",plans:[],startStatus:hJ,endStatus:hL});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._results);return}else{if(this.QUERY_TYPE===cJ){}}}else{if(hK.type===b7){if(this.QUERY_TYPE===cJ){this._opts.renderOptions.panel=null}this._processRaw();this._renderMap();if(this.QUERY_TYPE===ec||this.QUERY_TYPE===R){this._renderList()}}}}}},_getRouteStatus:function(T,i){var e=BMAP_ROUTE_STATUS_NORMAL;if(i===0){if(T>0){e=BMAP_ROUTE_STATUS_ADDRESS}else{e=BMAP_ROUTE_STATUS_EMPTY}}return e},_getRouteStatus30:function(i){var e=BMAP_ROUTE_STATUS_NORMAL;if(typeof i==="undefined"||i===null||i.length===0){e=BMAP_ROUTE_STATUS_EMPTY}else{if(i.length>0){e=BMAP_ROUTE_STATUS_ADDRESS}}return e},_stopDragging:function(){var hJ=this;if(hJ._d.sliderMkr){hJ._d.sliderMkr.disableDragging()}for(var hI=0,e=this._d.dragOverlays.length;hI<e;hI++){var T=this._d.dragOverlays[hI];if(T instanceof dk){T.disableDragging()}}},_processRaw:function(){var ib=this;var ia=this._json.content;var hX=ia.result;var hN={};var hL={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof hj||this._ud.start instanceof cX)){C.extend(hN,this._ud.start)}else{if(ib.QUERY_TYPE===ec||ib.QUERY_TYPE===R){hN.title=hX.origin["wd"]||"起点";hN.uid=hX.origin["uid"];hN.url=ft._getPoiUrl(hN.uid,hX.origin["area_id"]);hN.point=new hj(hX.origin["originPt"]["lng"],hX.origin["originPt"]["lat"]);hN.city=hX.origin["cname"]}else{if(ib.QUERY_TYPE===cJ){hN.title="起点";hN.point=new hj(hX.routes[0]["origin"]["lng"],hX.routes[0]["origin"]["lat"])}}}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof hj||this._ud.end instanceof cX)){C.extend(hL,this._ud.end)}else{if(ib.QUERY_TYPE===ec||ib.QUERY_TYPE===R){hL.title=hX.destination["wd"]||"终点";hL.uid=hX.destination["uid"];hL.url=ft._getPoiUrl(hL.uid,hX.destination["area_id"]);hL.point=new hj(hX.destination["destinationPt"]["lng"],hX.destination["destinationPt"]["lat"]);hL.city=hX.destination["cname"]}else{if(ib.QUERY_TYPE===cJ){hL.title="终点";hL.point=new hj(hX.routes[0]["destination"]["lng"],hX.routes[0]["destination"]["lat"])}}}var hU=[];this._d.viaPtsInfo.length=0;var h6=1;var h9=[];this._segPolylinePoints=[];var hQ=0;var hV=[];var h2=[];var h8=[];var h3=[];var hS=hX.routes;if(ib.QUERY_TYPE===ec||ib.QUERY_TYPE===R){for(var h4=0;h4<hS.length;h4++){var hY=hS[h4];for(var h0=0;h0<1;h0++){var h5=hY.steps;for(j=0;j<h5.length;j++){var hZ=new hj(h5[j]["stepOriginLocation"]["lng"],h5[j]["stepOriginLocation"]["lat"]);var hW=j;var hO=h5[j]["instructions"];var hK=h5[j]["distance"];var hP=new eq({point:hZ,index:hW,description:hO,distance:hK});h8.push(hP);var hJ=[];hJ.push(hZ);hJ=hJ.concat(O.pathToPoints(h5[j]["path"]));hJ.push(new hj(h5[j]["stepDestinationLocation"]["lng"],h5[j]["stepDestinationLocation"]["lat"]));h3=h3.concat(hJ);if(hJ.length>0){this._segPolylinePoints[hQ]=hJ;h9=h9.concat(hJ)}hQ++}var hK=hY.distance;var e=new dY({steps:h8,distance:hK,index:h0,points:h3,rt:this.ROUTE_TYPE});h2.push(e)}var hR=new gI({routes:h2,distance:hY.distance,duration:hY.duration});hV.push(hR)}var hT={plans:hV,start:hN,end:hL}}else{if(ib.QUERY_TYPE===cJ){for(var h4=0;h4<hS.length;h4++){var hY=hS[h4];for(var h0=0;h0<1;h0++){var h5=hY.steps;for(j=0;j<h5.length;j++){var hZ=new hj(h5[j]["start_location"]["lng"],h5[j]["start_location"]["lat"]);var hW=j;var hO="";var hK=h5[j]["distance"];var hP=new eq({point:hZ,index:hW,description:hO,distance:hK});h8.push(hP);var hJ=[];hJ=hJ.concat(O.pathToPoints(h5[j]["path"]));h3=h3.concat(hJ);if(hJ.length>0){this._segPolylinePoints[hQ]=hJ;h9=h9.concat(hJ)}hQ++}var hK=hY.distance;var e=new dY({steps:h8,distance:hK,index:h0,points:h3,rt:this.ROUTE_TYPE});h2.push(e)}var hR=new gI({routes:h2,distance:hY.distance,duration:hY.duration});hV.push(hR)}var hT={plans:hV,start:hN,end:hL,policy:ib._ud.policy}}}this._results=this._createResults(hT);this._d.viaPts.length=0;this._d.plys.length=0;var T=hN.point;this._d.viaPts.push(T);for(var h4=0,h1=hU.length;h4<h1;h4++){var h7=hU[h4];this._d.viaPts.push(h7)}var hI=hL.point;this._d.viaPts.push(hI);var hM=h3;hM.stNo=h4;hM.edNo=h4+1;this._d.plys.push(hM);this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._results)},_getAllStepCount:function(){var hJ=0;var hK=this._results.getPlan(0);for(var hI=0,e=hK.getNumRoutes();hI<e;hI++){var T=hK.getRoute(hI);hJ+=T.getNumSteps()}return hJ},_getCurStep:function(hL){var hK=0;var hM=this._results.getPlan(0);for(var hJ=0,T=hM.getNumRoutes();hJ<T;hJ++){var hO=hM.getRoute(hJ);for(var hI=0,hN=hO.getNumSteps();hI<hN;hI++){var e=hO.getStep(hI);if(hK===hL){return e}hK++}}},_getDescription:function(hN,hM,hX,hT,hS,hI,h1){var hK="";var hR=parseInt(hM.d,10);var hO=hM.poi;if(hO){hR=hR-hO.pd}var hW=aR(hR);var T=this._getRoadName(hI.t,hI.n);var hJ=this._getRoadName(hM.t,hM.n);var h0=this._getRoadName(hM.t,hX.n);var hP=this._getDwType(hN.dw)||"";var hQ=hN.dr?(hP+"<span>"+hN.dr+"</span>，"):"";if(h1.rt===3){hQ+="到达<span>"+this._getRetType(h1.rt)+"</span>，"}var hY=((hJ!==""&&T===hJ)?"继续":"")+this._getRoadAct(hM.t,hM.n);var e=this._getPoiInfo(hM);var hV=this._getTicInfo(hN);var hZ=(hJ===h0)?"":(this._getRetAct(hX.t,hX.n)+"<span>"+h0+"</span>");var hU=this._getTurnIcon(hN.ett||hN.extt||hN.tt);hK=hU+"<div class=\'navtrans-navlist-content\'>"+hY+hJ+this._getRetType(hN.rt)+hW+"，"+e+hV+hQ;if(hT===0){hK=hU+"<div class=\'navtrans-navlist-content\'>从起点向"+this._getTurnType(hN.ett||hN.extt||hN.tt)+"出发</div>"}else{if(hT>0&&hT<hS-1){var hL=this._getTurnType(hN.ett||hN.extt||hN.tt);if(!hL){hL=this._getTurnType(1)}hK=hK+hL+hZ+"</div>"}else{hK=hK+"到达终点</div>"}}return hK},_isInThreshold:function(hM,T,hL){if(T&&hL&&hL.length>0){for(var hK=0,e=hL.length;hK<e;hK++){var hJ=hL[hK];var hI=hM.pointToPixel(hJ);if(cZ.getDistanceByPixel(T,hI)<=cE.MAX_THRESHOLD){return true}}}return false},_renderMap:function(){var e=this._opts.renderOptions.map;if(e&&this._results){this._renderViaMkr();this._renderPly()}},_renderPly:function(){var h0=this._opts.renderOptions.map;var e=this._results.getPlan(0);var hZ=e.getRoute(0);var hI=this._results.getStart();var hY=this._results.getEnd();var h1=this;var hK=this._d.viaPts.length;var hX=[];var hM=[];var T;for(var hU=0,hR=this._d.plys.length;hU<hR;hU++){var hP=this._d.plys[hU];T=cZ.addRoute(h0,hP,hZ.getRouteType());e._routes[hU]._polyline=T;T.stNo=hP.stNo;T.edNo=hP.edNo;var hS=T.getBounds();hX.push(hS.getSouthWest());hX.push(hS.getNorthEast());if(this._enableDragging){if(hK<cE.DRAG_MAXPOINTS+2){T.addEventListener("mousemove",function(i){if(h1._d.mouseOnViaMkr){if(h1._d.sliderMkr){h1._d.sliderMkr.hide()}return}h1._d.curDragPly=this;if(h1._d.sliderMkr){if(h1._isInThreshold(h0,i.pixel,h1._d.viaPts)){h1._d.sliderMkr.hide()}else{h1._d.sliderMkr.show();h1._d.sliderMkr.setPosition(i.point);h1._d.tipLbl.setContent("拖动以更改路线");h1._d.tipLbl.show();h1._d.sliderMkr.setLabel(h1._d.tipLbl)}}else{h1._d.sliderMkr=cZ.addDragMkr(h0,i.point);h1._d.sliderMkr.enableDragging();h1._d.sliderMkr.addEventListener("dragging",function(h3){var h4=h1._d.curDragPly.stNo;var h2=h1._d.curDragPly.edNo;h1._requestDragging(this,h0,h4,h2)});h1._d.sliderMkr.addEventListener("dragend",function(h4){var h3=h1._d.cbkDragPt;var h5=h3.name;var h2=h1._d.curDragPly.edNo;h3.if_wp=null;h1._d.viaPts.splice(h2,0,h3);h1._d.viaPtsInfo.splice(h2,0,{title:!!h5?h5:"未知路段",curNo:h2,point:h3});this.setPosition(h3);h1._stopDragging();h1._dragSearch(hI,hY)});if(!h1._d.tipLbl){h1._d.tipLbl=cZ.createTipLbl("拖动以更改路线")}h0.addOverlay(h1._d.sliderMkr)}});T.addEventListener("mouseout",function(i){if(h1._d.sliderMkr){h1._d.sliderMkr.hide()}})}}h1._d.dragOverlays.push(T);if(this._opts._enableTraffic){hZ=e.getRoute(hU);for(var hT=0,hN=hZ._steps.length;hT<hN;hT++){var hJ=hZ._steps[hT];var hQ=hJ.trafficPaths;var hV=hJ.trafficStatus;for(var hO=0,hW=hQ.length;hO<hW;hO++){if(hV[hO]){var hL=cZ.addRouteWithTraffic(h0,hQ[hO],hV[hO])}hM.push(hL);h1._d.dragOverlays.push(hL)}}hZ._trafficePlys=hM}}if(this._opts.renderOptions.autoViewport){h0.setViewport(hX,{margins:[30,30,30,30]})}this._triggerCbk(ft.CBK_POLYLINES_SET,e._routes)},_renderViaMkr:function(){var T=this._opts.renderOptions.map;var hR=this._results.getPlan(0);var e=this._results.getStart();var hO=this._results.getEnd();var hP=this;var hQ=0;for(var hM=0,hI=this._d.viaPts.length;hM<hI;hM++){var hN=this._d.viaPts[hM];var hK;if(hM===0){hK=cZ.addDestPoi(T,hN,e.title,c9);e.marker=hK;if(this.QUERY_TYPE===ec||this.QUERY_TYPE===R){hK.addEventListener("click",function(){hP._select(0)})}this._overlays.push(hK)}else{if(hM===this._d.viaPts.length-1){hK=cZ.addDestPoi(T,hN,hO.title,bV);hO.marker=hK;if(this.QUERY_TYPE===ec||this.QUERY_TYPE===R){hK.addEventListener("click",function(){hP._select(hP._getAllStepCount()+1)})}this._overlays.push(hK)}else{if(hN.if_wp){hK=cZ.addWayPointMkr(T,hN,hQ);hQ++;hK.if_wp=1}else{hK=cZ.addDragMkr(T,hN)}this._d.viaPtsInfo[hM-1].marker=hK;var hL=new ca();hL.addItem(new fq("删除该点",function(hT,hS,i){hP._delVia(i.curNo)},{width:60}));hK.addContextMenu(hL);hP._d.cxtMenu.push(hL)}}hK.curNo=hM;if(this._enableDragging){hK.enableDragging();hK.addEventListener("mouseover",function(i){hP._d.mouseOnViaMkr=true;if(hP._d.tipLbl){hP._d.tipLbl.setContent("拖动以更改路线");hP._d.tipLbl.show();this.setLabel(hP._d.tipLbl)}else{hP._d.tipLbl=cZ.createTipLbl("拖动以更改路线");this.setLabel(hP._d.tipLbl)}});hK.addEventListener("mouseout",function(i){this.getLabel()&&this.getLabel().hide();hP._d.mouseOnViaMkr=false});hK.addEventListener("dragging",function(i){hP._requestDragging(this,T)});hK.addEventListener("dragend",function(hS){var i=hP._d.cbkDragPt;var hT=this.curNo;if(this.if_wp){i.if_wp=1}hP._d.viaPts[hT]=i;this.setPosition(i);var hV=hP._d.viaPts[0];var hU=hP._d.viaPts[hP._d.viaPts.length-1];if(hT===0){e.point=hV;e.title=hP._d.cbkStartPoiName}if(hT===hP._d.viaPts.length-1){hO.point=hU;hO.title=hP._d.cbkEndPoiName}hP._stopDragging();hP._dragSearch(e,hO)})}hP._d.dragOverlays.push(hK)}var hJ=[e];hJ=hJ.concat(this._d.viaPtsInfo);hJ=hJ.concat([hO]);this._triggerCbk(ft.CBK_MARKERS_SET,hJ)},_requestDragging:function(hM,i,hI,hN){var hP=this;if(hP._d.dragReqFlag===true){return}hP._d.dragReqFlag=true;setTimeout(function(){hP._d.dragReqFlag=false},cE.DRAG_REQ_FREQUENCE);var hK;var hR=ef.convertLL2MC(hM.getPosition());var e=i.getZoom();var hO=hM.curNo;var hQ=hP._opts.policy;if(typeof hI!=="undefiend"&&typeof hN!=="undefined"){var hJ=hP._d.viaPts[hI];hJ=ef.convertLL2MC(hJ);var hL=hP._d.viaPts[hN];hL=ef.convertLL2MC(hL);hK={qt:bU,pt:hR.lng+","+hR.lat,sn:hJ.lng+","+hJ.lat,en:hL.lng+","+hL.lat,r:5000,st:1,et:1,sy:hQ,l:e}}else{if(hO===0){var hL=hP._d.viaPts[hO+1];hL=ef.convertLL2MC(hL);hK={qt:bU,pt:hR.lng+","+hR.lat,sn:"",en:hL.lng+","+hL.lat,r:5000,st:1,et:1,sy:hQ,l:e}}else{if(hO===this._d.viaPts.length-1){var hJ=hP._d.viaPts[hO-1];hJ=ef.convertLL2MC(hJ);hK={qt:bU,pt:hR.lng+","+hR.lat,sn:hJ.lng+","+hJ.lat,en:"",r:5000,st:1,et:1,sy:hQ,l:e}}else{var hJ=hP._d.viaPts[hO-1];hJ=ef.convertLL2MC(hJ);var hL=hP._d.viaPts[hO+1];hL=ef.convertLL2MC(hL);hK={qt:bU,pt:hR.lng+","+hR.lat,sn:hJ.lng+","+hJ.lat,en:hL.lng+","+hL.lat,r:5000,st:1,et:1,sy:hQ,l:e}}}}var T={curDragMkr:hM,map:i,stNo:hI,edNo:hN};cv.request(function(hT,hS){hP._requestDraggingCbk(hT,hS)},hK,T)},_requestDraggingCbk:function(hR,T){var hN=this;if(hR&&hR.content){hN._d.cbkDragPt=O.parseGeo(hR.content["dragpt"],true).point;var hQ;var i=T.map;var hJ=T.stNo;var hL=T.edNo;var hK=T.curDragMkr;var hM=hK.curNo;if(typeof hJ!=="undefiend"&&typeof hL!=="undefined"){hQ=O.parseGeoExt(hR.content["geo"]).points}else{if(hM===0){hQ=O.parseGeo(hR.content["geo"],true).points;hN._d.cbkStartPoiName=hR.content["name"]?hR.content["name"]:"起点"}else{if(hM===hN._d.viaPts.length-1){hQ=O.parseGeo(hR.content["geo"],true).points;hN._d.cbkEndPoiName=hR.content["name"]?hR.content["name"]:"终点"}else{hQ=O.parseGeoExt(hR.content["geo"]).points}}}if(hQ){hN._clearOldLine(hM,i,hJ,hL);if(hN._d.cbkPly){hN._d.cbkPly.setPath(hQ)}else{var hO=hN._results.getPlan(0);var hP=hO.getRoute(0);hN._d.cbkPly=cZ.addRoute(i,hQ,hP.getRouteType())}}var e=hR.content["name"]?hR.content["name"]:"未知路段";hN._d.cbkDragPt.name=e;var hI="("+aR(hR.content["dis"])+")";hN._d.tipLbl&&hN._d.tipLbl.show();hN._d.tipLbl&&hN._d.tipLbl.setContent(e+hI)}},_clearOldLine:function(hL,hM,hK,T){for(var hJ=0,e=this._d.dragOverlays.length;hJ<e;hJ++){var hI=this._d.dragOverlays[hJ];if(hI instanceof a){if(typeof hK!=="undefiend"&&typeof T!=="undefined"){if(hI.stNo===hK&&hI.edNo===T){hM.removeOverlay(hI);break}}else{if(hI.stNo===hL||hI.edNo===hL){hM.removeOverlay(hI)}}}}if(this._hlRoute){this._hlRoute.hide()}},_select:function(T){var hL=this._curIndex;var hJ=this._opts.renderOptions;if(hJ.panel){var hK=hJ.panel.getElementsByTagName("table");var hQ=hK[hK.length-1];var hN=hQ.getElementsByTagName("tr");if(hL-1>=0&&hN[hL-1]){hN[hL-1].style.background=""}if(T-1>=0&&hN[T-1]){hN[T-1].style.background="#f0f0f0"}}var hU=hJ.map;if(hU){var e=this._results.getPlan(0);var hS=e.getRoute(0);var hW=this._getAllStepCount();var hV=this;hU.closeInfoWindow();if(T===0||T===hW+1){var hR=T===0?this._results.getStart():this._results.getEnd();var i=cZ.createTransInfoWnd({content:"<b>"+hR.title+"</b>",total:hW,curIndex:T,nextTransCbk:function(hX){hV._select(hX)},hideStep:(hJ.highlightMode===BMAP_HIGHLIGHT_STEP?false:true)});i.addEventListener("open",function(){hV._triggerCbk(ft.CBK_INFO_HTML_SET,hR,cZ.getInfoWindowDom(hU))});i.addEventListener("close",function(){if(hV._opts.renderOptions.panel){var hY=hJ.panel.getElementsByTagName("table");var hZ=hY[hY.length-1];if(hZ){var hX=hZ.getElementsByTagName("tr");if(hV._curIndex-1>=0&&hX[hV._curIndex-1]){hX[hV._curIndex-1].style.background=""}}}hV._curIndex=-1});var hT=T===0?0:1;var hV=this;if(hU.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(i,hU.getCurrentCity().code,{panoInstance:hU._pano,lngLat:hR.point,titleTip:hR.title,type:"busline",beforeDomId:"trans_nav"},function(){hV._overlays[hT].openInfoWindow(i)})}else{hV._overlays[hT].openInfoWindow(i)}if(this._hlRoute){this._hlRoute.hide()}}else{var hP=hJ.highlightMode;if(hP===BMAP_HIGHLIGHT_STEP){var hI=this._getCurStep(T-1);var i=cZ.createTransInfoWnd({content:hI.getDescription()?hI.getDescription(false):hI.instructions,total:hW,curIndex:T,nextTransCbk:function(hX){hV._select(hX)}});i.addEventListener("open",function(){hV._triggerCbk(ft.CBK_INFO_HTML_SET,hI,cZ.getInfoWindowDom(hU))});i.addEventListener("close",function(){if(hV._opts.renderOptions.panel){var hY=hJ.panel.getElementsByTagName("table");var hZ=hY[hY.length-1];if(hZ){var hX=hZ.getElementsByTagName("tr");if(hV._curIndex-1>=0&&hX[hV._curIndex-1]){hX[hV._curIndex-1].style.background=""}}}hV._curIndex=-1});var hO=hI.getPosition?hI.getPosition():hI.pathPoints[hI.pathPoints.length-1];var hV=this;if(hU.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(i,hU.getCurrentCity().code,{panoInstance:hU._pano,lngLat:hO,titleTip:hI.getDescription?hI.getDescription(false):hI.instructions,type:"driving",beforeDomId:"trans_nav"},function(){hU.openInfoWindow(i,hO)})}else{hU.openInfoWindow(i,hO)}}else{if(hP===BMAP_HIGHLIGHT_ROUTE){if(T===1&&!this._opts._enableTraffic){var hI=this._getCurStep(0);hU.setCenter(hI.getPosition?hI.getPosition():hI.pathPoints[hI.pathPoints.length-1]);if(hJ.autoViewport){hU.setZoom(17)}if(this._hlRoute){this._hlRoute.hide()}}else{if(this._segPolylinePoints[T-1]){if(!this._hlRoute){this._hlRoute=cZ.addRoute(hU,this._segPolylinePoints[T-1],hS.getRouteType()+2)}else{this._hlRoute.setPath(this._segPolylinePoints[T-1]);this._hlRoute.show()}if(hJ.autoViewport){var hM=hU.getViewport(this._hlRoute.getBounds());if(hM.zoom>17){hM.zoom=17}hU.setViewport(hM)}}}}}}}this._curIndex=T},_toggle:function(){var i=this._opts.renderOptions;if(i.panel){var e=C.getElementsByClassName(i.panel,"navtrans-res");if(e&&e.length>0){e=e[0];if(e&&e.style.display==="none"){e.style.display=""}else{e.style.display="none"}}var T=C.getElementsByClassName(i.panel,"navtrans-view");if(T&&T.length>0){T=T[0];C.toggleClass(T,"expand")}}},_clearOverlays:function(){var hI=this._opts.renderOptions.map;if(!hI){return}for(var T=0,e=this._overlays.length;T<e;T++){hI.removeOverlay(this._overlays[T]);this._overlays[T]=null}this._overlays.length=0;hI.removeOverlay(this._hlRoute);this._hlRoute=null;if(this._d){if(this._d.sliderMkr){hI.removeOverlay(this._d.sliderMkr);this._d.sliderMkr=null}if(this._d.tipLbl){hI.removeOverlay(this._d.tipLbl);this._d.tipLbl=null}for(var T=0,e=this._d.dragOverlays.length;T<e;T++){hI.removeOverlay(this._d.dragOverlays[T]);this._d.dragOverlays[T]=null}this._d.dragOverlays.length=0;if(this._d.cbkPly){hI.removeOverlay(this._d.cbkPly);this._d.cbkPly=null}for(var T=0,e=this._d.cxtMenu.length;T<e;T++){hI.removeContextMenu(this._d.cxtMenu[T]);this._d.cxtMenu[T]=null}this._d.cxtMenu.length=0;this._d.mouseOnViaMkr=false}},_delVia:function(T){if(this._results){var i=this._results.getStart();var e=this._results.getEnd();this._d.viaPts.splice(T,1);this._stopDragging();this._dragSearch(i,e)}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var hJ=this._results.getPlan(0);var hS=S("div",{style:"font:12px "+eV.fontFamily+";background:#fff"});var hI=this._d.viaPtsInfo;var e=hI.length;var hO=[];var hM="";switch(this.QUERY_TYPE){case cJ:hM="驾车";break;case R:hM="骑行";break;case ec:hM="步行";break}var hY=g6._genResultTitle(this._results.getEnd().title,hM,e>0);if(e>0){hO.push("<table style=\'width:100%;margin-left:4px;font:12px "+eV.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>");for(var hV=0;hV<e;hV++){hO.push("<tr>");if(hV===0){if(e===1){hO.push(\'<td style="padding:2px 5px;line-height:20px">途经点</td>\')}else{hO.push(\'<td valign="top" rowspan="\'+e+\'" style="padding:2px 5px;line-height:18px">途经点</td>\')}}hO.push(\'<td style="padding:2px 5px;line-height:20px">\'+hI[hV].title+"</td>");hO.push(\'<td style="padding:2px 10px;line-height:20px;cursor:pointer;color:#0000ff" onclick=\\\'BMapGL.I("\'+this.hashCode+\'")._delVia(\'+hI[hV]["curNo"]+")\'>删除</td>");hO.push("</tr>")}hO.push("</table>")}var hW=g6._genTitle(this._results.getStart().title,\'BMapGL.I("\'+this.hashCode+\'")._select(0)\',0);var hP=["<table class=\'navtrans-table\' style=\'width:100%;font:12px "+eV.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];var hU=0;for(var hR=0,hN=hJ.getNumRoutes();hR<hN;hR++){var hX=hJ.getRoute(hR);for(var hV=0,hT=hX.getNumSteps();hV<hT;hV++){var hL="";if(this._curIndex===hU+1){hL=";background:#f0f0f0"}hP.push(\'<tr style="cursor:pointer\'+hL+\'" onclick=\\\'BMapGL.I("\'+this.hashCode+\'")._select(\'+(hU+1)+")\'>");hP.push("<td style=\'border-bottom:1px solid #E4E6E7;padding:10px;line-height:20px;\' >"+(this._getCurStep(hU).getDescription?this._getCurStep(hU).getDescription():this._getCurStep(hU)["instructions"])+"</td>");hP.push("</tr>");hU++}}hP.push("</table>");var T=g6._genTitle(this._results.getEnd().title,\'BMapGL.I("\'+this.hashCode+\'")._select(\'+(hU+1)+")",1);var hQ="<div class=\'navtrans-view expand\' style=\'position:relative;color:#7777cc;background:#e5ecf9;height:53px;overflow:hidden;text-align:right\' onclick=\'BMapGL.I(\\""+this.hashCode+"\\")._toggle()\'><span class=\'suggest-plan\'>推荐</span><div class=\'suggest-plan-des\'>"+hJ.getDistance().replace(/(\\d+(?:.\\d+)?)/,"$1 ")+"&nbsp;&nbsp;|&nbsp;&nbsp;"+hJ.getDuration().replace(/(\\d+)/,"$1 ")+"</div>";if(this._results.moreResultsUrl){hQ+="<a style=\'color:#7777cc;position:absolute;top:5px;right:20px;\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>到百度地图查看&#187;</a>"}hQ+="&nbsp;<span class=\'navtrans-arrow\'></span></div>";var hK="<div class=\'navtrans-res\'>"+hO.join("")+hW+hP.join("")+T+"</div>";hS.innerHTML=hY+hQ+hK;this._opts.renderOptions.panel.appendChild(hS);this._triggerCbk(ft.CBK_RESULTS_HTML_SET,hS)}},_getRoadName:function(i,e){if(e===""||!e){if(i===9||i===12||i===1||i===16){e=cE.ROAD_TYPE[i]}}return e},_getPoiInfo:function(hK){var e="";var hJ=hK.poi;if(hJ){var hI=this._getPsType(hJ.ps)||"";var i=this._getPwType(hJ.pw)||"";var T=hJ.pd<((hK.t===13||hK.t===4)?1000:50)?"":"约"+aR(hJ.pd)+"后";e=i+hI+"<b>"+hJ.pn+"</b>"+T+(hI===""?"":"，")}return e},_getTicInfo:function(i){var e=i.iw;return !i.ic?"":((this._getIwGo(e)||"")+"<b>"+i.ic+"</b>"+(this._getIwTo(e)||""))},_getRoadAct:function(T,i){var e="沿";if(T===0||(!i&&T!==1&&T!==16&&T!==9&&T!==12)){e=""}return e},_getRetAct:function(T,i){var e="进入";if(!i&&(T===9||T===12)){e="上"}else{if(T===0||(!i&&T!==1&&T!==16)){e=""}}return e},_getTaxiFare:function(){if(this._json&&this._json.content&&this._json.content["taxi"]){var hI=this._json.content["taxi"];var e={distance:hI.dis,remark:hI.remark};if(hI.detail[0]){var T=hI.detail[0];e.day={initialFare:parseFloat(T.startPrice),unitFare:parseFloat(T.kmPrice),totalFare:parseFloat(T.totalPrice)}}if(hI.detail[1]){var i=hI.detail[1];e.night={initialFare:parseFloat(i.startPrice),unitFare:parseFloat(i.kmPrice),totalFare:parseFloat(i.totalPrice)}}return e}return null}});fw.TURN_TYPE=["","直行","右前方转弯","右转","右后方转弯","调头","左后方转弯","左转","左前方转弯","靠左","直行","靠右","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向"];fw.RET_TYPE=["","从起点出发","到达目的地","途经点","行驶"];fw.TURN_ICON_CLASS=["s-1","s-1","s-2","s-3","s-4","s-5","s-6","s-7","s-8","s-9","s-1","s-10","","","","","","","",""];fw.IWGO=["在","从","从"];fw.IWTO=["","","离开"];fw.PWTYPE=["过","在"];fw.PSTYPE=["左侧的","右侧的",""];fw.DWTYPE=["","朝"];C.extend(fw.prototype,{_createResults:function(e){return new dh(e)},_getTurnType:function(e){return fw.TURN_TYPE[e]},_getTurnIcon:function(T){var i="navtrans-navlist-icon "+(fw.TURN_ICON_CLASS[T]?fw.TURN_ICON_CLASS[T]:"");var e=\'<span class="\'+i+\'"></span>\';return e},_getRetType:function(e){return fw.RET_TYPE[e]},_getIwGo:function(e){return fw.IWGO[e]},_getIwTo:function(e){return fw.IWTO[e]},_getPwType:function(e){return fw.PWTYPE[e]},_getPsType:function(e){return fw.PSTYPE[e]},_getDwType:function(e){return fw.DWTYPE[e]}});a5.TURN_TYPE=["","直走","向右前方转","右转","向右后方转","向后转","向左后方转","左转","向左前方转","左转穿过马路并继续向前","右转穿过马路并继续向前","左转穿过马路并往回走","右转穿过马路并往回走","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向","","","",""];a5.TURN_ICON_CLASS=["s-1","s-1","s-2","s-3","s-4","s-5","s-6","s-7","s-8","s-7","s-3","s-7","s-3","","","","","","","","","","","",""];a5.RET_TYPE=["","从起点出发","到达目的地","途经点","走"];a5.IWGO=["在","从","从"];a5.IWTO=["","","离开"];a5.PWTYPE=["过","在"];a5.PSTYPE=["左侧的","右侧的",""];a5.DWTYPE=["","朝"];C.extend(a5.prototype,{_createResults:function(e){delete e.url;return new cO(e)},_getTurnType:function(e){return a5.TURN_TYPE[e]},_getTurnIcon:function(T){var i="navtrans-navlist-icon "+(a5.TURN_ICON_CLASS[T]?a5.TURN_ICON_CLASS[T]:"");var e=\'<span class="\'+i+\'"></span>\';return e},_getRetType:function(e){return a5.RET_TYPE[e]},_getIwGo:function(e){return a5.IWGO[e]},_getIwTo:function(e){return a5.IWTO[e]},_getPwType:function(e){return a5.PWTYPE[e]},_getPsType:function(e){return a5.PSTYPE[e]},_getDwType:function(e){return a5.DWTYPE[e]}});C.extend(bh.prototype,{_createResults:function(e){delete e.url;return new au(e)}});var eO=new d1(9,0);var gK=new d1(300,300);C.extend(cH.prototype,{render:function(hN){window.RouteAddrInst=this;var hK={};var hY=this.json;this.endIndex=1;var hI=this.endIndex;var hS=[];var hW=[];var h1=["sel_n","sel_n1","sel_y","sel_x","sel_x1"];var hZ=[-1,-1];var hT=[];var hW=[];var hP=hY.content["result"];this.tpCity=[hP.originInfo["area_id"],hP.destinationInfo["area_id"]];tempCode=hP.originInfo["area_id"];for(var hU=0;hU<hI+1;hU++){var hO=null;hS.push([]);hT.push("");hW.push("");if(hU==0){if(hP.originInfo){this.tpCity[0]=hP.originInfo["area_id"];tempCode=this.tpCity[0]}}else{if(hP.destinationInfo){this.tpCity[hU]=hP.destinationInfo["area_id"];tempCode=this.tpCity[hU]}}hO=this.getCurPoint30(hU);if(hO.length>0){hW[hU]=\'<a href="javascript:void(0)" ></a>\';hS[hU].push(\'<div id="RADiv_ResItem\'+hU+\'" class="sel_body_body_div sel_body_resitem">\');var hM=[0,9];if(hO.length<10){hM[1]=hO.length-1}hS[hU].push(this.makeListTable(hU,hM));if(hO.length>10){hS[hU].push(\'<div id="RADiv_PAGE\'+hU+\'" style="height:20px;" class="sel_body_body_page"></div>\');this.totalPage[hU]=Math.ceil(hO.length/10);this.curPageIndex[hU]=1}hS[hU].push("</div>");if(hO.length===1){hZ[hU]=2;this.qInfo[hU]["n"]=hO[0]["name"];this.qInfo[hU]["c"]=tempCode;this.qInfo[hU]["u"]=hO[0]["uid"];var e=new hj(hO[0]["location"]["lng"],hO[0]["location"]["lat"]);var h2=e;this.qInfo[hU]["point"]=e;this.qInfo[hU]["x"]=h2.lng;this.qInfo[hU]["y"]=h2.lat;this.qInfo[hU]["t"]=BMAP_POI_TYPE_NORMAL;var hR=this.addPointMarker(this._opts.renderOptions.map,h2,hO[0]["name"],hU);this.markerDest=hR;this.locPois.push(hR.point);hT[hU]=hO[0]["name"]}else{hZ[hU]=0}}}var hJ;var T;var hQ=false;var hX=false;for(var hV=0,hL;hV<hZ.length;hV++){hL=hZ[hV];if(hJ){if(hL==0||hL==3){hZ[hV]=hL+1}}else{if(hL==0&&!T){this.curPointIndex=hV;T=hV+1;continue}if(T&&hL==0){hZ[hV]=1}}}hK.startPointClass=h1[hZ[0]];this.startName=hP.originInfo["wd"];if(hT[0]==""){hK.startPoint=this.startName}else{hK.startPoint=hT[0]}hK.startBody=hS[0].join("");hK.endPointClass=h1[hZ[hI]];this.endName=hP.destinationInfo["wd"];if(hT[hI]==""){hK.endPoint=this.endName}else{hK.endPoint=hT[hI]}hK.endBody=hS[hI].join("");hK.startButton=hW[0];hK.endIndex=hI;hK.endButton=hW[hI];this.tpName=[];var h0=[""];hK.tpList=h0.join("");return this.template(hK)},bindEvent:function(){var i,e;if(C.G("RouteAddress_DIV0")){i=C.G("RouteAddress_DIV0").getElementsByTagName("tr");this.routDivTrBindFun(i)}if(C.G("RouteAddress_DIV1")){e=C.G("RouteAddress_DIV1").getElementsByTagName("tr");this.routDivTrBindFun(e)}var hJ=this;if(this.infoWindow){this.infoWindow.addEventListener("open",function(){var hK=C.G("selInfoWndBtn");C.on(hK,"click",function(){var hL=hK.getAttribute("data-uid").split("_");hJ.itmSelect(hL[0],hL[1])});C.on(hK,"mouseover",function(){hJ._selBtnOver(hK)});C.on(hK,"mousedown",function(){hJ._selBtnDown(hK)});C.on(hK,"mouseout",function(){hJ._selBtnOut(hK)})})}var hI,T;if(C.G("RouteAddress_DIV0")){hI=C.G("RouteAddress_DIV0").firstChild.firstChild;C.on(hI,"click",function(hL){var hK=hI.getAttribute("data-uid");hJ.showLst(hK)})}if(C.G("RouteAddress_DIV1")){T=C.G("RouteAddress_DIV1").firstChild.firstChild;C.on(T,"click",function(hL){var hK=T.getAttribute("data-uid");hJ.showLst(hK)})}},routDivTrBindFun:function(i){var e=this;this.each(i,function(T,hI){C.on(hI,"mouseover",function(hL){var hM=hI.getAttribute("data-uid").split("_");var hK=parseInt(hM[0],10);n2=parseInt(hM[1],10);gj=parseInt(hM[2],10);e._lstMouseOver(this,0,hM[0],gj-n2,hL)});C.on(hI,"mouseout",function(hL){var hM=hI.getAttribute("data-uid").split("_");var hK=parseInt(hM[0],10);n2=parseInt(hM[1],10);gj=parseInt(hM[2],10);e._lstMouseOut(this,0,hM[0],gj-n2,hL)});C.on(hI,"click",function(hL){var hM=hI.getAttribute("data-uid").split("_");var hK=parseInt(hM[0],10);n2=parseInt(hM[1],10);gj=parseInt(hM[2],10);e.select(hK,gj,hL)});var hJ=hI.childNodes[2].getElementsByTagName("div")[0];C.on(hJ,"click",function(hK){var hN=hJ.getAttribute("data-uid").split("_"),hM=hN[0],hL=hN[1];e.itmSelect(hM,hL)});C.on(hJ,"onmouseover",function(hK){e._selBtnOver(hJ)});C.on(hJ,"onmouseout",function(hK){e._selBtnOut(hJ)});C.on(hJ,"onmousedown",function(hK){e._selBtnDown(hJ)})})},formatJson30:function(i,e){},parseJson:function(hK,e){if(!hK.content){hK.content={start:[],end:[]}}hK.content["tpList"]=[];if(hK.result.type==19){this.parseQuery(hK,e);var hL=hK.content,hI=[],T=hL.length;hK.content={start:[],end:[]};if(T>2){for(var hJ=1;hJ<(T-1);hJ++){hI.push(hL[hJ])}}hK.content["end"]=hL[T-1];hK.content["tpList"]=hI;hK.content["start"]=hL[0]}return hK},parseQuery:function(hT,T){var hR={},hP=this,e,hI,hN=0,hL=0,hM=[],hO,hU=hT.result,hK=[];hR.city_list=[];hR.count=[];hR.current_null=[];hR.e_query=[];hR.e_wd=[];hR.end_city=[];hR.wd2=[];hR.prio_flag=[];hR.sug_index=[];hR.total=[];hR.s_wd="";hR.s_query="";this.canShowList=[];if(!hU.e_wd){hU.e_wd=[];hU.e_query=[]}e=this.parseOnePosition(T.start);hO=e.type;hR.s_wd=hO==1?e.keyword:hU.s_wd;hR.s_query=hO==1?e.keyword:hU.s_query;if(hO==1){hP.qInfo[hN].n=hR.s_wd;hP.qInfo[hN].x=e.point.split(",")[0];hP.qInfo[hN].y=e.point.split(",")[1]}this.canShowList.push(hO==2);hR.total.push(hO==1?1:hU.total[hL]);hR.count.push(hO==1?1:hU.count[hL]);hR.current_null.push(hO==1?0:hU.current_null[hL]);hR.prio_flag.push(hO==1?1:hU.prio_flag[hL]);hR.sug_index.push(hO==1?"":hU.sug_index[hL]);hM.push(hO==1?[{name:e.keyword,geo:"1|"+e.point+";"+e.point+"|"+e.point+";"}]:hT.content[hL]);hR.city_list.push(hO==1?0:hU.city_list[hL]);hR.wd2.push(hO==1?"":hU.wd2[hL]);if(hO==2){hL++}hN++;hK=decodeURIComponent(T.end).split("to:");for(var hJ=0,hS;(hS=hK[hJ]);hJ++){hS=this.parseOnePosition(hS);hO=hS.type;if(hO==2){if(hS.uid&&hS.point){hO=1}}this.canShowList.push(hO==2);var hQ=hO==2?hS.keyword:hL==0?hU.s_wd:hU.e_wd[hL-1];hR.e_wd.push(hQ);hR.e_query.push(hQ);hR.end_city.push(hO==1?hT.current_city:hL==0?hU.start_city:hU.end_city[hL-1]);if(hO==1){hP.qInfo[hN].n=hR.s_wd;hP.qInfo[hN].x=hS.point.split(",")[0];hP.qInfo[hN].y=hS.point.split(",")[1]}if(hS.if_wp){this.insertTP(hN-1,{query:hR.e_wd[hN-1],addr:hR.wd2[hN],point:hO==1?O.getPoiPoint(hS.point):null,uid:hS.uid});this.tpListInMap.push({query:hR.e_wd[hN-1],addr:hR.wd2[hN],point:hO==1?O.getPoiPoint(hS.point):null,uid:hS.uid})}hR.total.push(hO==1?1:hU.total[hL]);hR.count.push(hO==1?1:hU.count[hL]);hR.current_null.push(hO==1?0:hU.current_null[hL]);hR.prio_flag.push(hO==1?1:hU.prio_flag[hL]);hR.sug_index.push(hO==1?"":hU.sug_index[hL]);hM.push(hO==1?[{name:hS.keyword,geo:"1|"+hS.point+";"+hS.point+"|"+hS.point+";"}]:hT.content[hL]);hR.city_list.push(hO==1?0:hU.city_list[hL]);hR.wd2.push(hO==1?"":hU.wd2[hL]);if(hO==2){hL++}hN++}C.extend(hT.result,hR);hT.content=hM},insertTP:function(e,T){var i=C.extend({},T);if(this.tpList.length>e){this.tpList[e]=T}else{if(this.tpList.length==e){this.tpList.push(T)}else{return}}this.tpList[e]=i},parseOnePosition:function(i){var i=decodeURIComponent(i),e=i.split("$$");return{type:e[0],uid:e[1],point:e[2],keyword:e[3],if_sug:e[4],keyword2:e[5],fe_xy:e[6],if_wp:e[7]}},getCurPoint30:function(e){var i=[];switch(e){case 0:case"0":i=this.json.content["result"]["origin"]["content"];break;case 1:case"1":i=this.json.content["result"]["destination"]["content"];break}return i},getCurPoint:function(e){return e==0?this.json.content["start"]:(e==this.endIndex?this.json.content["end"]:this.json.content["tpList"][e-1])},makeListTable:function(hK,hJ,hI){var hM=this;this.curSelectedIndex=-1;var hN=hI?hI:this.getCurPoint30(hK);var hL=[];hL.push(\'<div id="RA_ResItem_\'+hK+\'"><table border="0" cellspacing="0" cellpadding="0" style="width:100%">\');for(var T=hJ[0];T<=hJ[1];T++){hL.push(\'<tr  onmouseover="RouteAddrInst._lstMouseOver(this, 0,\'+hK+", "+(T-hJ[0])+\', event)" onmouseout="RouteAddrInst._lstMouseOut(this, 0,\'+hK+", "+(T-hJ[0])+\', event)" onclick="RouteAddrInst.select(\'+hK+","+T+\', event)"  filter = "item" data-uid="\'+hK+"_"+hJ[0]+"_"+T+\'"  ><th><div title="在图上显示该点" class="icon iconbg" id="no_\'+hK+"_"+(T-hJ[0]+1)+\'"></div></th>\');var e=(hK==0)?"选为起点":(hK==this.endIndex)?"选为终点":"选为途经点";hL.push(\'<td style="word-break:break-all;padding-right:24px">\');hL.push(\'<a href="javascript:void(0)">\'+hN[T]["name"]+"</a>");if(hN[T]["address"]&&hN[T]["address"]!=""){hL.push("<div>");hL.push(\'<span style="color:#999">地址: \'+hN[T]["address"]+"</span>");hL.push("</div>")}hL.push("</td>");hL.push(\'<td style="vertical-align:middle;width:106px"><div tid="selBtn_\'+hK+"_"+T+\'" class="selBtn"  onclick="RouteAddrInst.itmSelect(\'+hK+","+T+\');return false;" onmouseover="RouteAddrInst._selBtnOver(this)" onmouseout="RouteAddrInst._selBtnOut(this)" onmousedown="RouteAddrInst._selBtnDown(this)" data-uid = "\'+hK+"_"+T+\'"  >\'+e+"</div>");hL.push(\'<a data-uid="\'+hN[T]["uid"]+\'" href="javascript:void(0);" class="list_street_view_poi" style="visibility:hidden"><img src="https://map.baidu.com/wolfman/static/common/images/transparent.gif" ></a>\');hL.push("</td>");hL.push("</tr>")}hL.push("</table></div>");return hL.join("")},addPointMarker:function(hJ,hI,i,e,T){var hL;if(e==0){hL=cZ.addDestPoi(hJ,hI,i,c9)}else{if(e==this.endIndex){hL=cZ.addDestPoi(hJ,hI,i,bV)}else{var hK=this.tpListInMap[e-1];hK.point=hI;T&&(hK.uid=T);hL=cZ.addWayPointMkr(hJ,hI,e-1)}}this.destList.push(hL);return hL},template:function(i){var T=[];T.push(\'<div class="RouteAddressOuterBkg">\');T.push(\'<div class="RouteAddressTip"><span>请选择准确的起点、途经点或终点</span></div>\');T.push(\'<div class="RouteAddressInnerBkg">\');T.push(\'<div id="pos5" style="display:none"></div>\');T.push(\'<div id="RouteAddress_DIV0" class="\'+i.startPointClass+\'"> \');T.push(\'<div class="sel_body">\');T.push(\'<div class="sel_body_top" data-uid="0" onclick="RouteAddrInst.showLst(0)" >\');T.push(\'<div class="sel_body_title">\');T.push(\'<div class="sel_body_sign"></div>\');T.push(\'<div class="sel_body_name">起点：<b id="B_PointName0">\'+i.startPoint+"</b></div>");T.push("</div>");T.push(\'<div id="RD_TOP_BUT0" class="sel_body_button">\'+i.startButton+"</div>");T.push("</div>");T.push(\'<div class="sel_body_body" id="RADIV_BODY0">\'+i.startBody+"</div>");T.push("</div>");T.push("</div>");T.push(i.tpList);T.push(\'<div id="RouteAddress_DIV\'+i.endIndex+\'" class="\'+i.endPointClass+\'">\');T.push(\'<div class="sel_body">\');T.push(\'<div class="sel_body_top" data-uid=\'+i.endIndex+\' onclick="RouteAddrInst.showLst(\'+this.endIndex+\')" >\');T.push(\'<div class="sel_body_title">\');T.push(\'<div class="sel_body_sign"></div>\');T.push(\'<div class="sel_body_name">终点：<b id="B_PointName\'+i.endIndex+\'">\'+i.endPoint+"</b></div>");T.push("</div>");T.push(\'<div id="RD_TOP_BUT\'+i.endIndex+\'" class="sel_body_button">\'+i.endButton+"</div>");T.push("</div>");T.push(\'<div class="sel_body_body" id="RADIV_BODY\'+i.endIndex+\'">\'+i.endBody+"</div>");T.push("</div>");T.push("</div>");T.push(\'<div id="pos6" style="display:none"></div>\');T.push("</div>");T.push("</div>");var e=T.join("");return e},showLst:function(hQ){this.curPointIndex=hQ;var hO=this,hP=[];var hI=hP.length+1;var hL=this.getCurPoint30(hQ);var hM=hO.curPageIndex;var hN=C.G("RouteAddress_DIV"+hQ)["className"];if(hN=="sel_n"||hN=="sel_x"||(this.canShowList&&!this.canShowList[hQ])){return}if(hN=="sel_n1"||hN=="sel_y"||hN=="sel_x1"){for(var T=0;T<=hI;T++){var e=C.G("RouteAddress_DIV"+T);C.G("B_PointName"+T).innerHTML=this.getCurPoiName(T);if(e.className=="sel_x"){e.className="sel_x1"}else{if(e.className=="sel_n"){e.className="sel_n1"}}}hO.clearMarkers();if(hO.markerDest){for(var T=0;T<hO.destList.length;T++){hO.map.removeOverlay(hO.destList[T])}hO.destList=[];hO.markerDest=null}if(hN=="sel_y"){hO.qInfo[hQ]={n:"",c:0,u:0,x:0,y:0,t:-1};hO.resType[hQ]=0}var hK=0;if(hQ===0){hK=hO.json.content["result"]["origin"].length}else{if(hQ===1){hK=hO.json.content["result"]["destination"].length}}if(hK<=0){C.G("RouteAddress_DIV"+hQ)["className"]="sel_x"}else{C.G("RouteAddress_DIV"+hQ)["className"]="sel_n";var hJ=(hM[hQ]-1)*10+9;if(hL.length<(hJ+1)){hJ=hL.length-1}hO.addMarkers(hQ,[(hM[hQ]-1)*10,hJ])}}this.curSelectedIndex=-1},_selectIt:function(hO,hK){var hN=this;var hQ;if(C.G("RA_ResItem_"+hO)){hQ=C.G("RA_ResItem_"+hO).childNodes[0]}if(hQ){var hM=hQ.rows[hK];if(hM){hM.style.backgroundColor="#F4F4F4";var T=hM.getElementsByTagName("td")[1];var hI=T.childNodes[0];hI.style.visibility="visible";var i=hM.getElementsByTagName("th")[0];var hP=i.childNodes[0];hP.style.backgroundPosition=-hK*18+"px -166px"}}if(hN.markersList.length>hK){var hL=eV.staticHost+"/wolfman/static/common/images/";hL+="markers_new2x_2960fb4.png";var e=new d1(18*hK,166);var hJ=new g2(hL,new d1(18,27),{offset:new d1(9,27),imageOffset:e,infoWindowOffset:eO,imageSize:gK,});hN.markersList[hK].setIcon(hJ);hN._setTop(hN.markersList[hK],true,true)}},_lstMouseOver:function(hI,T,hL,i,hK){var hJ=this._opts.renderOptions.map;if(this.curSelectedIndex!=i){hJ.closeInfoWindow();this._selectIt(hL,i)}},_lstMouseOut:function(hI,T,hK,i,hJ){if(this.curSelectedIndex!=i){this._unSelectIt(hK,i)}},_unSelectIt:function(hO,hK){var hN=this;var hQ=null;if(C.G("RA_ResItem_"+hO)){hQ=C.G("RA_ResItem_"+hO).childNodes[0]}if(hQ){var hM=hQ.rows[hK];hM.style.backgroundColor="#ffffff";var T=hM.getElementsByTagName("td")[1];var hI=T.childNodes[0];hI.style.visibility="";var i=hM.getElementsByTagName("th")[0];var hP=i.childNodes[0];hP.style.backgroundPosition=-hK*18+"px -273px"}if(hN.markersList.length>hK){var hL=eV.staticHost+"/wolfman/static/common/images/";hL+="markers_new2x_2960fb4.png";var e=new d1(18*hK,273);var hJ=new g2(hL,new d1(18,27),{offset:new d1(9,27),imageOffset:e,infoWindowOffset:eO,imageSize:gK,});hN.markersList[hK].setIcon(hJ);hN._setTop(hN.markersList[hK],false)}},_setTop:function(T,i,e){if(!T||!T.setTop){return}if(i&&!T._isTop&&T.iconDom&&T.iconDom.style){T._isTop=true;if(e){T.setTop(true,1000100)}else{T.setTop(true)}return}if(!i&&T.iconDom&&T.iconDom.style){delete T._isTop;T.setTop(false)}},select:function(T,i,hJ){if(arguments.length>2){hJ=hJ||window.e;var e=hJ.srcElement||hJ.target;if(e.className=="selBtn"){return}}var hL=this.json.content||[];var hI=this;var hK=hI.getCurPoint30(T);this.map.closeInfoWindow();if(!hK){return}if((hI.resCity[0]!=hI.resCity[1])&&hI.markerDest){if(this.map){this.map.setViewport(hI.pointsList)}}this._showInfoWindow(hK,T,i);if(this.curSelectedIndex!=-1){this._unSelectIt(T,this.curSelectedIndex)}this.curSelectedIndex=i%10;this._selectIt(T,this.curSelectedIndex)},clearMarkers:function(){var i=this;(function T(){if(i.markersList.length===0){return}i.map.removeOverlay(i.markersList.shift());T()})();(function e(){if(i.pointsList.length===0){return}i.pointsList.shift();e()})()},itmSelect:function(hO,hN){var hS=this;var hI=this.map;var hR=hS.json.content||[];var hQ=this.getCurPoint30(hO);hS.qInfo[hO]["n"]=hQ[hN]["name"];hS.qInfo[hO]["c"]=this.resCity[hO];hS.qInfo[hO]["u"]=hQ[hN]["uid"];var hU=new hj(hQ[hN]["location"]["lng"],hQ[hN]["location"]["lat"]);var hK=hU;hS.qInfo[hO]["point"]=hU;hS.qInfo[hO]["x"]=hK.lng;hS.qInfo[hO]["y"]=hK.lat;hS.qInfo[hO]["t"]=BMAP_POI_TYPE_NORMAL;if(C.G("B_PointName"+hO)){C.G("B_PointName"+hO).innerHTML=hQ[hN]["name"]}hS.markerDest=this.addPointMarker(hI,hK,hQ[hN]["name"],hO);if(hO!=0&&hO!=this.endIndex){var hT=this.tpListInMap[hO-1];hT.query=hQ[hN].name}hS.clearMarkers();if(this.isAllPointSure()){if(hS.markerDest){for(var hJ=0;hJ<hS.destList.length;hJ++){hS.map.removeOverlay(hS.destList[hJ])}hS.destList=[];hI.removeOverlay(hS.markerDest);hS.markerDest=null}hS.submit()}else{if(C.G("RouteAddress_DIV"+hO)){C.G("RouteAddress_DIV"+hO)["className"]="sel_y"}var T=0;for(var hJ=1;hJ<=this.endIndex;hJ++){var hM=(hO+hJ)%(this.endIndex+1);if(C.G("RouteAddress_DIV"+hM)&&C.G("RouteAddress_DIV"+hM)["className"]!="sel_y"){T=hM;break}else{T=hM;break}}if(hS.resType[T]==0){if(C.G("RouteAddress_DIV"+(T))){C.G("RouteAddress_DIV"+(T))["className"]="sel_n"}var hP=hS.curPageIndex[T];var hL=(hP-1)*10+9;var e=this.getCurPoint30(T);if(e.length<(hL+1)){hL=e.length-1}hS.addMarkers(T,[(hP-1)*10,hL]);hS.select(T,0)}else{if(hS.resType[T]==2){if(C.G("RouteAddress_DIV"+(T))){C.G("RouteAddress_DIV"+(T))["className"]="sel_n"}}else{if(C.G("RouteAddress_DIV"+(T))){C.G("RouteAddress_DIV"+(T))["className"]="sel_x"}}}this.curPointIndex=T}},submit:function(){var hI=this;var hJ=this.map;var hK=hI.qInfo[0]["c"];var i=hI.qInfo[hI.endIndex]["c"];if(hK==i){var hL=hK}var e={};var T=new a6("onpoiselected");e.start_name=hI.qInfo[0]["point"]["lat"]+","+hI.qInfo[0]["point"]["lng"];e.end_name=hI.qInfo[1]["point"]["lat"]+","+hI.qInfo[1]["point"]["lng"];e.region=hI.qInfo[0]["c"]||hI.qInfo[1]["c"];T.paramInfo=e;hJ.dispatchEvent(T)},getTPointQueryParam:function(hN,e){var hM=2,hJ="",hO="",hK="",T="0",i="",hI="",hP="",hL="1";if(hN.point||hN.rPoint){hM=1;hO=hN.point?(hN.point.lng+","+hN.point.lat):(hN.rPoint.lng+","+hN.rPoint.lat);if(hN.uid){hM=2;hJ=hN.uid}}if(hN.query){hK=hN.query}if(hN.addr){T="1";i=hN.addr}if(!isNaN(e)){hM=e}return hM+"$$"+hJ+"$$"+hO+"$$"+hK+"$$"+T+"$$"+i+"$$"+hI+"$$"+hL+"$$+to:"},isAllPointSure:function(){for(var e=0;e<=this.endIndex;e++){if(this.qInfo[e]["n"]==""&&!this.qInfo[e]["x"]&&!this.qInfo[e]["y"]||this.qInfo[e]["n"]==undefined){return false}}return true},_selBtnOver:function(e){e.style.backgroundPosition="-100px -81px"},_selBtnOut:function(e){e.style.backgroundPosition="-21px -81px"},_selBtnDown:function(e){e.style.backgroundPosition="-220px -81px";e.style.fontWeight="bold"},initialize:function(){var hM=this;var hI=this.endIndex;var hP=this.json;hM.setParsValue();for(var hK=0;hK<=hI;hK++){if(C.G("RADiv_PAGE"+hK)){pg0=new gy("RADiv_PAGE"+hK,function(hS){var hR=hM.curPointIndex;var hQ=[(hS-1)*10,hS*10-1];if(hM.resCount[hR]<(hQ[1]+1)){hQ[1]=hM.resCount[hR]-1}C.remove=function(i){i=C.G(i);var hT=i.parentNode;hT&&hT.removeChild(i)};if(C.G("RA_ResItem_"+hR)){C.remove(C.G("RA_ResItem_"+hR));C.insertHTML(C.G("RADiv_ResItem"+hR),"AFTERBEGIN",hM.makeListTable(hR,hQ))}hM.addMarkers(hR,hQ,true);C.G("RADiv_ResItem"+hR).scrollTop=0;hM.curPageIndex[hR]=hS},{pagecap:5,pageCount:hM.totalPage[hK],page:hM.curPageIndex[T]})}}var hJ=[0,9];var hO=this.curPointIndex,hN=C.G("RouteAddress_DIV"+hO),e=this.getCurPoint30(hO);if(hN.className=="sel_n"){if(e&&e.length>0){if(e.length<(hJ[1]+1)){hJ[1]=e.length-1}hM.addMarkers(hO,hJ);hM.select(hO,0)}}else{if(this.markerDest&&hN.className=="sel_x"){this.map.setViewport(this.locPois)}}for(var T=0;T<=hI;T++){if(C.G("RouteAddress_DIV"+T)["className"]=="sel_y"){var hL=this.getCurPoint30(T);if(hL.length>0&&hL[0].ifFromIW&&hL[0].ifFromIW==1){C.rc(C.G("RD_TOP_BUT"+T),"sel_body_button");C.G("RD_TOP_BUT"+T).innerHTML=""}}}},withoutPanelInitial:function(){var hM=this;var hI=this.endIndex;var hP=this.json;hM.setParsValue();for(var hL=0;hL<=hI;hL++){var T=hM.curPointIndex;var hK=[0,9];if(hM.resCount[T]<(hK[1]+1)){hK[1]=hM.resCount[T]-1}hM.addMarkers(T,hK,true)}var hJ=[0,9];var hO=this.curPointIndex,hN=C.G("RouteAddress_DIV"+hO),e=this.getCurPoint30(hO);if(hO==1){if(e&&e.length>0){if(e.length<(hJ[1]+1)){hJ[1]=e.length-1}hM.addMarkers(hO,hJ)}}else{if(this.markerDest&&hO==0){if(this.map){this.map.setViewport(this.pointsList)}}}hM.select(hO,0)},setStatusByRes:function(T){var hI=this.map;if(T.current_city){if(!(T.result.result_show&1)&&(T.result.type==29||T.result.type==13)){var hJ=T.current_city;var i=["country","province","city","area"],hK=hJ.type!=null?modelConfig.level[i[hJ.type]]:undefined,e=hJ.geo!=null?e=O.parseGeo(hJ.geo,true).point:undefined;if(!hI.enableLoadTiles){hI.enableLoadTiles=true;hI.centerAndZoom(e||hI.getCenter(),hK||hI.getZoom())}else{if(hK){hI.zoomTo(hK)}if(e){hI.setCenter(e)}}}}},setParsValue:function(){this.resCity=this.tpCity;var e=this.json.content["result"];if(e.origin["content"].length>0){if(e.origin["content"].length===1){this.resType[0]=1}else{this.resType[0]=0}this.resCount[0]=e.origin["content"].length}else{this.resType[0]=3}if(e.destination["content"].length>0){if(e.destination["content"].length===1){this.resType[1]=1}else{this.resType[1]=0}this.resCount[1]=e.destination["content"].length}else{this.resType[1]=3}return},addMarkers:function(hR,hQ,hJ){var hT=this.json.content||[];var hU=this;var hS=this.getCurPoint30(hR);var hI=hU.map;hU.clearMarkers();if(!hS){return}for(var hO=hQ[0];hO<=hQ[1];hO++){var hV=new hj(hS[hO]["location"]["lng"],hS[hO]["location"]["lat"]);hU.markersList.push(cZ.addSearchPoi_R(hV,hO-hQ[0],hS[hO]["name"],{type:"RouteAddrMarker"},hI));hU.pointsList.push(hV)}var hM=hU.pointsList;if(hU.markerDest){if(!((hU.resCity[0]!=hU.resCity[1]))){hM.push(hU.markerDest.getPosition())}}var e=this.map.getMapType();if(false){var hK=b1[BMAP_PERSPECTIVE_MAP].citys;var hN=hK[hI.currentCity][1];var hP=getPointsBounds(hM);var T=hI.getViewport(hP)["zoom"];if(hN.intersects(hP)){if(T<=15){T=15}hI.centerAndZoom(hM[0],T)}else{if(hI){hI.setViewport(hM)}}}else{if(hI){hI.setViewport(hM)}}if(hU.pointsList.length==11){hU.pointsList.pop()}var hL=this.markersList;for(var hO=hQ[0];hO<=hQ[1];hO++){(function(){var i=hO;if(hL[hO-hQ[0]]){hL[hO-hQ[0]].addEventListener("click",function(){hU.select(hR,i)});hL[hO-hQ[0]].addEventListener("mouseover",function(){var hW=i%10;if(hU.curSelectedIndex!=hW){hU._selectIt(hR,hW)}});hL[hO-hQ[0]].addEventListener("mouseout",function(){var hW=i%10;if(hU.curSelectedIndex!=hW){hU._unSelectIt(hR,hW)}})}})()}},_showInfoWindow:function(hM,hK,hJ){var hN=this;var hL=hM[hJ];var i="<span class=\'iw_poi_title\' title=\'"+hL.name+"\'>"+hL.name+"</span>";var T=[];var hO="";if(hL.address&&hL.address!=""){hO="地址: "+hL.address}T.push("<div style=\'padding:11px 11px 6px 11px;line-height:20px;word-break:break-all\'>"+hO+"</div>");T.push("<div style=\'line-height:180%;margin-bottom:10px;\'>");var hI="选为途经点";if(hK==0){hI="选为起点"}if(hK==this.endIndex){hI="选为终点"}T.push("<div style=\'text-align:center;\'><div id=\'selInfoWndBtn\' class=\'selInfoWndBtn\'  data-uid = \'"+hK+"_"+hJ+"\'  />"+hI+"</div>");T.push("</div>");if(!this.infoWindow){this.infoWindow=new am(T.join(""),{title:i,height:0,width:280,margin:[0,0,0,0]});this.infoWindow.addEventListener("open",function(){var hP=C.G("selInfoWndBtn");C.on(hP,"click",function(){var hQ=hP.getAttribute("data-uid").split("_");hN.itmSelect(hQ[0],hQ[1])});C.on(hP,"mouseover",function(){hN._selBtnOver(hP)});C.on(hP,"mousedown",function(){hN._selBtnDown(hP)});C.on(hP,"mouseout",function(){hN._selBtnOut(hP)})});this.infoWindow.addEventListener("close",function(){hN._unSelectIt(hK,e)})}else{this.infoWindow.setTitle(i);this.infoWindow.setContent(T.join(""))}var e=hJ%10;if(this.markersList&&this.markersList[e]){this.markersList[e].openInfoWindow(this.infoWindow)}},getCurPoiName:function(e){if(e==undefined){e=this.curPointIndex}if(e==0){return this.startName}else{if(e==this.endIndex){return this.endName}else{return this.tpName[e-1]}}},each:function(hJ,T){for(var hI=0,e=hJ.length;hI<e;hI++){T(hI,hJ[hI])}}});C.extend(hk.prototype,{_asyncSearch:function(hJ,e,hI){var T=this;var i=this.getUrl(hJ,e,hI);T.goURI("web",i)},routeCall:function(hJ,e,hI){var T=this;var i=this.getUrl(hJ,e,hI);T.goURI("web",i)},setPointParameters:function(hI,i){var T=this.opts;var hJ="";if(hI&&hI.latlng&&hI.name){var e=hI.latlng;hJ="latlng:"+e.lat+","+e.lng;hJ+="|name:"+hI.name}else{var e=hI.latlng;hJ=e?e.lat+","+e.lng:(hI.name?hI.name:"")}T[i]=hJ},getUrl:function(hI,hL,e){this.setPointParameters(hI,"origin");this.setPointParameters(hL,"destination");this.opts=C.extend(this.opts,e);var hJ=this.opts;var T=[];var hO="";var hR="";if(typeof(hJ.origin)==="undefined"||hJ.origin===""){hJ.origin=""}var hQ={destination:false,mode:false};for(var hK in hJ){hO=hK+"="+hJ[hK];T.push(hO);if(typeof(hQ[hK])!=="undefined"){hQ[hK]=true}}this.mode=hJ.mode;if(hQ.mode===false){var hP="mode="+BMAP_MODE_DRIVING;this.mode=BMAP_MODE_DRIVING;T.push(hP);hQ.mode=true}var hN=true;for(var hM in hQ){hN=hN&&hQ[hM]}if(hN){return T.join("&")}return false},goURI:function(T,i,hJ){var e=function(hK){var hL=document.createElement("script");hL.src="http://127.0.0.1:6259/sendintent?callback=send&intent="+encodeURIComponent(hK+"&src=baidu|jsapi#Intent;scheme=bdapp;package=com.baidu.BaiduMap;end");document.body.appendChild(hL)};if(i){var hI=a9[T]+i+"&src=baidu|jsapi";if(T==="web"){hI+="&output=html"}location.href=hI;hJ&&hJ()}}});');
