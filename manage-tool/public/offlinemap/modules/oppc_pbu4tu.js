/**/ï»¿_jsload&&_jsload('oppc', 'function eF(){this._currentState="idle";this._currentTouchCount=0;this._firstPointerId=-1;this._secondPointerId=-1}eF.prototype.takeAction=function(e,i){if(this["_on"+e]){this["_on"+e](i)}return this.getState()};eF.prototype._onmousedown=function(e){if(this._currentTouchCount===0){this._firstPointerId=e}else{if(this._currentTouchCount===1){this._secondPointerId=e}}this._currentTouchCount++;if(this._currentState==="idle"){this._currentState="readyToDrag"}else{if(this._currentState==="dragging"||this._currentState==="readyToDrag"){this._currentState="readyToPinch"}else{if(this._currentState==="pinching"){this._currentState="freeze"}else{this._currentState="freeze"}}}};eF.prototype._onmousemove=function(){if(this._currentState==="readyToDrag"||this._currentState==="dragging"){this._currentState="dragging"}else{if(this._currentState==="readyToPinch"){this._currentState="pinching"}}};eF.prototype._onmouseup=function(e){if(this._currentState==="idle"){return}this._currentTouchCount--;if(this._currentState==="readyToDrag"||this._currentState==="dragging"){this._currentState="idle";this._firstPointerId=-1;this._secondPointerId=-1}else{if(this._currentState==="readyToPinch"||this._currentState==="pinching"){this._clearId(e);this._currentState="freeze"}else{if(this._currentState==="freeze"){if(this._currentTouchCount===0){this._currentState="idle";this._firstPointerId=-1;this._secondPointerId=-1;return}if(this._currentTouchCount===2){if(e!==this._firstPointerId&&e!==this._secondPointerId){this._currentState="pinching"}}if(e===this._firstPointerId||e===this._secondPointerId){this._clearId(e);this._currentState="freeze"}}}}};eF.prototype._ongesturestart=function(){if(window.TouchEvent||!window.GestureEvent){return}if(this._currentState==="idle"||this._currentState==="readyToDrag"){this._currentState="readyToPinch"}};eF.prototype._ongesturechange=function(){if(window.TouchEvent||!window.GestureEvent){return}if(this._currentState==="readyToPinch"){this._currentState="pinching"}};eF.prototype._ongestureend=function(){if(window.TouchEvent||!window.GestureEvent){return}if(this._currentState==="readyToPinch"||this._currentState==="pinching"||this._currentState==="freeze"){this._currentState="idle"}};eF.prototype.getState=function(){return dO[this._currentState]||0};eF.prototype.reset=function(){this._currentState="idle";this._currentTouchCount=0;this._firstPointerId=-1;this._secondPointerId=-1};eF.prototype._clearId=function(e){if(e===this._firstPointerId){this._firstPointerId=-1}else{if(e===this._secondPointerId){this._secondPointerId=-1}}};eF.prototype.setState=function(e){this._currentState=e};bj.register(function(e){if(e._mouse){return}e._mouse=new he(e);if(!e._mouse._drag){e._mouse=null}if(e._renderType==="webgl"){e.addEventListener("dblclick",function(i){if(!e.config.enableDblclickZoom){return}this.zoomIn(i.point)});e.addEventListener("rightdblclick",function(i){if(!e.config.enableDblclickZoom){return}this.zoomOut(i.point)});e.addEventListener("minuspress",function(i){this.zoomOut()});e.addEventListener("pluspress",function(i){this.zoomIn()})}});function aD(hI,T){var i={};i.id=hI.pointerId||0;i.clientPos={x:hI.clientX||hI.pageX||0,y:hI.clientY||hI.pageY||0};i.clientPos.x=hI.clientX-hI.layerX+hI.offsetX;i.clientPos.y=hI.clientY-hI.layerY+hI.offsetY;i.offsetPos={x:hI.layerX||hI.offsetX||0,y:hI.layerY||hI.offsetY||0};i.target=hI.target;i.button=hI.button||0;i.ctrlKey=hI.ctrlKey||false;i.metaKey=hI.metaKey||false;var hJ=dy(i,T);C.extend(i,hJ);i.offsetPosMap=new eb(hJ.x,hJ.y);i.timeStamp=hI.timeStamp;i.domEvent=hI;if(hI.type&&hI.type.indexOf("wheel")>-1){i.wheelDelta=hI.wheelDelta;i.detail=hI.detail;i.deltaX=hI.deltaX;i.deltaY=hI.deltaY;i.deltaMode=hI.deltaMode}i.offsetX=i.offsetPosMap.x;i.offsetY=i.offsetPosMap.y;i.layerX=hI.layerX;i.layerY=hI.layerY;return i}function dy(hI,T){var hK=hI.target;var hQ=hI.clientPos.x;var hP=hI.clientPos.y;var hN=null;var hM=null;if(hK.nodeType!==1){hK=hK.parentNode}var hL=T.getContainer();var hJ=hL;while(hJ){hQ-=hJ.offsetLeft;hP-=hJ.offsetTop;hJ=hJ.offsetParent}if(typeof window.scrollY==="number"){hP+=window.scrollY}if(typeof window.scrollX==="number"){hQ+=window.scrollX}var i=T.getPanes();var e=null;while(hK&&hK!==hL){if(hK.hashCode){if(C.instance(hK.hashCode) instanceof cP){hN=C.instance(hK.hashCode)}if(C.instance(hK.hashCode) instanceof am||C.instance(hK.hashCode) instanceof hy){hM=C.instance(hK.hashCode)}}var hR=hK.parentNode;if(hR===i.floatPane||hR===i.markerMouseTarget||hR===i.floatShadow||hR===i.labelPane||hR===i.markerPane||hR===i.mapPane){e=hK}hK=hR}var hO=null;if(e&&!hN&&!hM){hO=e}return{x:hQ,y:hP,overlay:hN,infoWindow:hM,customOverlayDom:hO,pixel:new eb(hQ,hP),point:T.pixelToPointIn(new eb(hQ,hP)),latlng:T.pixelToPoint(new eb(hQ,hP))}}function gb(hJ,hI){var hK=hJ.changedTouches[0];var i=hJ.changedTouches.length;var T={target:hJ.target,timeStamp:hJ.timeStamp,ctrlKey:hJ.ctrlKey||false,webkitForce:hJ.webkitForce,metaKey:hJ.metaKey||false,touchesCount:hJ.touches.length,targetTouchesCount:hJ.targetTouches.length};if(hJ.changedTouches){T.changedTouchesCount=hJ.changedTouches.length}else{T.changedTouchesCount=1}eB(hK,T,hI);if(i>1){T.secondTouchInfo={};C.extend(T.secondTouchInfo,T);eB(hJ.changedTouches[1],T.secondTouchInfo,hI)}return T}function eB(hK,hL,e){if(!hK){return}var hN=hK.clientX;var hM=hK.clientY;hL.id=hK.identifier||0;hL.clientPos={x:hN,y:hM};var hI=0;var T=0;var i=e.container;while(i.offsetParent){hI+=i.offsetLeft;T+=i.offsetTop;i=i.offsetParent}hL.offsetPos={x:hN-hI,y:hM-T};hL.button=0;hL.offsetPosMap=new eb(hL.offsetPos.x,hL.offsetPos.y);var hJ=dy(hL,e);C.extend(hL,hJ)}function B(hM,hL){var i=hM.clientX;var hN=hM.clientY;if(typeof window.scrollY==="number"){hN+=window.scrollY}var hK={};hK.id=0;hK.clientPos={x:i,y:hN};hK.target=hM.target;var hI=0;var T=0;var hJ=hL.container;while(hJ.offsetParent){hI+=hJ.offsetLeft;T+=hJ.offsetTop;hJ=hJ.offsetParent}hK.offsetPos={x:i-hI,y:hN-T};hK.timeStamp=hM.timeStamp;hK.offsetPosMap=new eb(hK.offsetPos.x,hK.offsetPos.y);hK.scale=hM.scale;hK.rotation=hM.rotation;return hK}function he(e){this._map=e;if(e._renderType==="webgl"){this._drag=new b8(e)}else{if(typeof gU==="undefined"){return}this._drag=new gU(e)}this._earthDrag=null;this._earthWheel=null;this._dragStarted=false;this._touchStarted=false;this._waitForSecondTouch=false;this._firstTouchInfo={};this._secondTouchInfo={};this._currentTouchCount=0;this._prevGestureScale=1;this._useGesture=!!((fW()&&window.GestureEvent)||(!window.TouchEvent&&window.GestureEvent));this._opButton=-1;this._rotationFix=0;this._pinchRotationThreshold=20;this._pinchZoomThreshold=0.2;this._gestureStatus={zoom:false,rotate:false,tilt:false,dragZoom:false};this._diffX=0;this._diffY=0;this._enableRightDrag=true;if(typeof navigator.userAgent==="string"&&navigator.userAgent.indexOf("QQBrowser")>0){this._enableRightDrag=false}this._lastWheelTime=new Date();this._isModernBrowser=e.config.isModernBrowser;if(e.getRenderType()==="webgl"){e.deepZoom=new ao(e)}else{if(this._isModernBrowser){e.deepZoom=new bz(e)}}this._stateMachine=new eF();this._init();this._bind();if(this._useGesture){this._bindGesture()}this._bindRightButton();this._bindMouseWheel();this._operationVelocity=0;this._lastDiffDistance=0;this._zoomVelocity=0;this._lastDiffZoom=0;this._rotationVelocity=0;this._initRotation=0;this._trackVelocityTimer=null;this._trackTimeStamp=0;this._lastDragPoint={x:0,y:0};this._penultimateDragPoint={x:0,y:0};this._touchInMap=false}he.prototype._init=function(){this._supportPointerEvent=(window.PointerEvent||window.MSPointerEvent)&&(navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);var e={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};if(this._supportPointerEvent){if(window.PointerEvent){e.mousedown="pointerdown";e.mousemove="pointermove";e.mouseup="pointerup"}else{if(window.MSPointerEvent){e.mousedown="MSPointerDown";e.mousemove="MSPointerMove";e.mouseup="MSPointerUp"}}}this._eventMapping=e};he.prototype._bind=function(){var hJ=this._map;var T=hJ.temp;var i=this._eventMapping;var hI=this;var e=hJ.platform;C.on(e,i.mousedown,function(hL){if(fW()){return}hI._mousedown=true;var hK=aD(hL,hJ);hI._mouseButton=hL.button;hJ.dispatchEvent(C.extend(new a6("onmousedown"),hK));hI._processMouseDown(hK)});C.on(e,"touchstart",function(hL){if(hI._mousedown===true){return}hI._touchStarted=true;var hK=gb(hL,hJ);hI._processMouseDown(hK);hI._touchInMap=true;if(!hK.customOverlayDom){hL.preventDefault()}});C.on(document,i.mousemove,function(hL){if(hI._touchStarted){return}var hK=aD(hL,hJ);hK.button=hI._mouseButton;if(hJ.currentOperation===dO.idle){hJ.dispatchEvent(C.extend(new a6("onmousemove"),hK))}hI._processMouseMove(hK)});C.on(document,"touchmove",function(hK){if(!hI._touchInMap){return}hI._processMouseMove(gb(hK,hJ));hK.preventDefault});C.on(document,i.mouseup,function(hK){if(hI._touchStarted){return}hI._mousedown=false;hI._processMouseUp(aD(hK,hJ))});C.on(document,"touchend",function(hO){if(!hI._touchInMap){return}if(!hI._firstTouchInfo||!hI._firstTouchInfo.offsetPos){hI._processMouseUp(aD(hO,hJ));return}if(hO.targetTouches.length===0){var hM=Math.abs(hI._diffX)>5||Math.abs(hI._diffY)>5;hI._touchStarted=false;if(!hI._twoFingerTouched&&!hM){var hK=new a6("onclick");C.extend(hK,hI._firstTouchInfo);hK.icon=hJ.getIconByClickPosition(hI._firstTouchInfo.offsetPos);hJ.dispatchEvent(hK);if(hI._waitForSecondTouch===false){hI._waitForSecondTouch=true;hI._firstTouchPos={x:hI._firstTouchInfo.offsetPos.x,y:hI._firstTouchInfo.offsetPos.y};hI._doubleTouchTimer=setTimeout(function hL(){hI._waitForSecondTouch=false;hI._doubleTouchTimer=null},hJ.config.clickInterval)}else{if(Math.abs(hI._firstTouchInfo.offsetPos.x-hI._firstTouchPos.x)<20&&Math.abs(hI._firstTouchInfo.offsetPos.y-hI._firstTouchPos.y)<20){var hN=new a6("ondblclick");C.extend(hN,hI._firstTouchInfo);hJ.dispatchEvent(hN)}hI._waitForSecondTouch=false;clearTimeout(hI._doubleTouchTimer);hI._doubleTouchTimer=null}}hI._twoFingerTouched=false;hI._touchInMap=false}hI._processMouseUp(gb(hO,hJ))});C.on(e,"click",function(hN){if(window.TouchEvent&&fW()){return}if(hJ.getLock()===true){return}if(hJ.currentOperation===dO.idle){var hM=hI._diffX===0&&hI._diffY===0;var hL=aD(hN,hJ);if(hM){var hK=new a6("onclick");C.extend(hK,hL);hK.icon=hJ.getIconByClickPosition(hK.offsetPosMap);hJ.dispatchEvent(hK)}if(!T._clickTimer){T._clickTimer=setTimeout(function(){T._clickTimer=null;if(hM){var hO=new a6("onclickex");C.extend(hO,hL);hJ.dispatchEvent(hO)}},hJ.config.clickInterval)}}hI._diffX=0;hI._diffY=0});hJ.container.onselectstart=function(){return false};C.on(hJ.container,"contextmenu",function(hK){hK.cancelBubble=true;bP(hK)});C.on(e,"dblclick",function(hK){if(hJ.getLock()===true){return}if(hJ.currentOperation===dO.idle){if(C.Browser.ie){hJ.dispatchEvent(C.extend(new a6("onclick"),aD(hK,hJ)))}if(T._clickTimer){clearTimeout(T._clickTimer);T._clickTimer=null}hJ.dispatchEvent(C.extend(new a6("ondblclick"),aD(hK,hJ)))}});C.on(document,"mousedown",function(hL){hL=window.event||hL;var hK=hL.srcElement||hL.target;if(T.canKeyboard){T.canKeyboard=hJ.container.contains(hK)}else{T.canKeyboard=e.contains(hK)}});C.on(e,"webkitmouseforcedown",function(hK){hJ.dispatchEvent(C.extend(new a6("onforcedown"),aD(hK,hJ)))});C.on(e,"webkitmouseforceup",function(hK){hJ.dispatchEvent(C.extend(new a6("onforceup"),aD(hK,hJ)))})};he.prototype._bindGesture=function(){var e=this;var i=this._map;C.on(i.platform,"gesturestart",function(hI){i.currentOperation=e._stateMachine.takeAction("gesturestart");var T=B(hI,i);e._gestureStartTime=T.timeStamp;if(T.rotation<-160){e._rotationFix=180}else{if(T.rotation>160){e._rotationFix=-180}else{e._rotationFix=0}}e._pinchStartPosition=T.offsetPosMap;e._getCurrentDrag().onReadyToPinch(hI,{initMiddlePoint:T.offsetPosMap,pinchStartPosition:e._pinchStartPosition,zoomRatio:1});hI.preventDefault()});C.on(document,"gesturechange",function(hK){if(i.currentOperation!==dO.readyToPinch&&i.currentOperation!==dO.pinching){return}i.currentOperation=e._stateMachine.takeAction("gesturechange");if(i.currentOperation!==dO.pinching){return}var hJ=B(hK,i);if(isNaN(hJ.scale)){hJ.scale=e._prevGestureScale}else{e._prevGestureScale=hJ.scale}hJ.rotation+=e._rotationFix;var T=hJ.offsetPosMap;e._pinchingPosition=T;e._diffX=T.x-e._pinchStartPosition.x;e._diffY=T.y-e._pinchStartPosition.y;var hI=e._getPinchParam(hJ);if(!hI){hK.preventDefault();return}e._getCurrentDrag().onPinching(hK,{pinchStartPosition:e._pinchStartPosition,pinchingPosition:T,pinchingDistance:hI.pinchingDistance,zoomRatio:hI.zoomRatio,angleDiff:hI.rotation,gestureStatus:e._gestureStatus});hK.preventDefault()});C.on(document,"gestureend",function(hJ){if(i.currentOperation!==dO.readyToPinch&&i.currentOperation!==dO.pinching){return}var hI=B(hJ,i);if(isNaN(hI.scale)){hI.scale=e._prevGestureScale}else{e._prevGestureScale=hI.scale}var T=e._pinchParam||{};e._getCurrentDrag().onPinchEnd(hJ,{pinchStartPosition:e._pinchStartPosition,pinchEndPosition:e._pinchingPosition,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:e._gestureStatus});e._resetGestureParam();i.currentOperation=e._stateMachine.takeAction("gestureend");hJ.preventDefault()})};he.prototype._getPinchParam=function(hI){var hN=hI.scale;var hP=hI.rotation;var hJ=hI.offsetPosMap;var hM=hJ.x-this._pinchStartPosition.x;var hK=hJ.y-this._pinchStartPosition.y;var T={x:hM,y:hK};var hO=hI.timeStamp-this._gestureStartTime;if(hO<100){return null}var i=this._gestureStatus;if(!this._gestureDetected){this._gestureDetected=true;if(Math.abs(hM)<10&&Math.abs(hK)>10&&Math.abs(hN-1)<0.1&&hP<10){i.tilt=true}}var hL=0;if(!i.tilt&&!i.rotate){if(Math.abs(hP)>this._pinchRotationThreshold){this._initRotation=hP;if(hP>0){hL=hP-this._pinchRotationThreshold}else{hL=hP+this._pinchRotationThreshold}i.rotate=true}else{hP=0}}if(i.rotate&&this._initRotation){hL+=hP-this._initRotation}var e=hN;if(i.tilt){e=1}this._pinchParam={zoomRatio:e,rotation:hL,pinchingDistance:T};return this._pinchParam};he.prototype._resetGestureParam=function(){this._initRotation=0;this._gestureStatus.zoom=false;this._gestureStatus.rotate=false;this._gestureStatus.tilt=false;this._gestureStatus.dragZoom=false;this._gestureDetected=false;this._pinchParam=null;this._gestureStartTime=null};he.prototype._bindRightButton=function(){var i=this._map;var e=this;C.on(i.container,this._eventMapping.mouseup,function(T){if(i.mapType===BMAP_EARTH_MAP){return}if(i.getLock()===true){return}if(i.currentOperation!==dO.readyToDrag){if(i.currentOperation===dO.dragging&&e._diffX===0&&e._diffY===0){}else{return}}if(T.button===2){e._processRightClick(aD(T,i))}})};he.prototype._processMouseDown=function(hN){var i=this._map;if(hN.overlay&&hN.overlay instanceof dk&&hN.overlay._config.enableDraggingMap===false&&!fW()){if(i.currentOperation===dO.idle){this._clearStatus();this._firstTouchInfo=hN;this._firstTouchInfo.initX=hN.offsetPosMap.x;this._firstTouchInfo.initY=hN.offsetPosMap.y;return}}if(i.currentOperation!==dO.idle&&hN.button!==this._opButton){return}if(hN.button===2&&this._currentTouchCount===1){return}if(i.getLock()){return}if(this._currentTouchCount===2){return}this._currentTouchCount++;if(this._currentTouchCount===2){this._twoFingerTouched=true}if(this._lastTouchstartTime&&fW()){var hJ=hN.timeStamp-this._lastTouchstartTime;if(hJ<200){this._gestureStatus.dragZoom=true}}this._lastTouchstartTime=hN.timeStamp;i.currentOperation=this._stateMachine.takeAction("mousedown",hN.id);if(hN.secondTouchInfo){this._currentTouchCount++;i.currentOperation=this._stateMachine.takeAction("mousedown",hN.secondTouchInfo.id)}if(i.currentOperation===dO.readyToDrag){if(C.Browser.ie||(C.Browser.firefox&&hN.target.setCapture)){hN.target.setCapture()}var hK=this._firstTouchInfo;C.extend(hK,hN);hK.initX=hN.offsetPosMap.x;hK.initY=hN.offsetPosMap.y;this._opButton=hN.button;if(hN.button===2&&this._enableRightDrag===false){i.currentOperation=dO.idle;this._stateMachine.reset();return}this._getCurrentDrag().onReadyToDrag(hN)}else{if(i.currentOperation===dO.readyToPinch){if(hN.secondTouchInfo){C.extend(this._firstTouchInfo,hN);this._firstTouchInfo.initX=hN.offsetPosMap.x;this._firstTouchInfo.initY=hN.offsetPosMap.y;C.extend(this._secondTouchInfo,hN.secondTouchInfo);this._secondTouchInfo.initX=hN.secondTouchInfo.offsetPosMap.x;this._secondTouchInfo.initY=hN.secondTouchInfo.offsetPosMap.y;this._opButton=hN.button}else{C.extend(this._secondTouchInfo,hN);this._secondTouchInfo.initX=hN.offsetPosMap.x;this._secondTouchInfo.initY=hN.offsetPosMap.y}if(this._useGesture){return}this._initTouchDistance=gN(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);this._initMiddlePoint=cV(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);var hI=this._firstTouchInfo.initX-this._initMiddlePoint.x;var hP=this._initMiddlePoint.y-this._firstTouchInfo.initY;var T=this._secondTouchInfo.initX-this._initMiddlePoint.x;var hO=this._initMiddlePoint.y-this._secondTouchInfo.initY;var hL;if(hI-T!==0){var hM=(hO-hP)/(T-hI);hL=c8(Math.atan(hM))}else{hL=90}if(hL<0){hL=180+hL}this._initAngle=hL;this._preAngle=hL;this._pinchStartPosition=this._initMiddlePoint;this._getCurrentDrag().onReadyToPinch(hN,{initMiddlePoint:this._initMiddlePoint,pinchStartPosition:this._pinchStartPosition,zoomRatio:1})}}};he.prototype._processMouseMove=function(hK){var i=this._map;if(i.currentOperation===dO.idle){return}if(hK.id===this._firstTouchInfo.id){C.extend(this._firstTouchInfo,hK)}else{if(hK.id===this._secondTouchInfo.id){C.extend(this._secondTouchInfo,hK)}}if(hK.secondTouchInfo){if(hK.secondTouchInfo.id===this._firstTouchInfo.id){C.extend(this._firstTouchInfo,hK.secondTouchInfo)}else{if(hK.secondTouchInfo.id===this._secondTouchInfo.id){C.extend(this._secondTouchInfo,hK.secondTouchInfo)}}}i.currentOperation=this._stateMachine.takeAction("mousemove",hK.id);if(i.currentOperation===dO.pinching){if(this._useGesture){return}if(!this._gestureStartTime){this._gestureStartTime=hK.timeStamp}var hO=gN(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);var hN=cV(this._firstTouchInfo.offsetPosMap,this._secondTouchInfo.offsetPosMap);this._pinchingPosition=hN;this._diffX=hN.x-this._initMiddlePoint.x;this._diffY=hN.y-this._initMiddlePoint.y;var hL={scale:Math.round(hO/this._initTouchDistance*100)/100,rotation:this._calcRotationDiff(hN),offsetPosMap:hN,timeStamp:hK.timeStamp};this._pinchingPosition=hN;var T=this._getPinchParam(hL);if(T){this._zoomRatio=T.zoomRatio;this._getCurrentDrag().onPinching(hK,{initMiddlePoint:this._initMiddlePoint,pinchStartPosition:this._pinchStartPosition,pinchingPosition:hN,pinchingDistance:T.pinchingDistance,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:this._gestureStatus})}}else{if(i.currentOperation===dO.dragging){var hJ=this._getCurrentDrag();if(this._dragStarted===false){hJ.onDragStart&&hJ.onDragStart(hK);this._dragStarted=true}if(hK.id===this._firstTouchInfo.id){this._diffX=hK.offsetPosMap.x-this._firstTouchInfo.initX;this._diffY=hK.offsetPosMap.y-this._firstTouchInfo.initY}else{if(hK.secondTouchInfo&&hK.secondTouchInfo.id===this._firstTouchInfo.id){this._diffX=hK.secondTouchInfo.offsetPosMap.x-this._firstTouchInfo.initX;this._diffY=hK.secondTouchInfo.offsetPosMap.y-this._firstTouchInfo.initY}}this._lastDragPoint=hK.pixel;var hI;if(this._lastDragPoint.x===this._penultimateDragPoint.x&&this._lastDragPoint.y===this._penultimateDragPoint.y){hI={x:this._diffX,y:this._diffY}}else{hI={x:this._lastDragPoint.x-this._penultimateDragPoint.x,y:this._lastDragPoint.y-this._penultimateDragPoint.y}}if(!i.config.enableDragging){return}hJ.onDragging(hK,{diffX:this._diffX,diffY:this._diffY,velocity:this._operationVelocity,button:this._opButton,dragDistance:{x:this._diffX,y:this._diffY},gestureStatus:this._gestureStatus,dir:hI});if(!this._trackVelocityTimer){var hM=this;this._trackTimeStamp=(new Date()).getTime();this._trackVelocityTimer=setInterval(function(){hM._trackVelocity();hM._penultimateDragPoint=hM._lastDragPoint},30)}}}};he.prototype._calcRotationDiff=function(hN){var i=this._firstTouchInfo.offsetPosMap.x-hN.x;var hM=hN.y-this._firstTouchInfo.offsetPosMap.y;var e=this._secondTouchInfo.offsetPosMap.x-hN.x;var hL=hN.y-this._secondTouchInfo.offsetPosMap.y;var hI;if(i-e!==0){var hJ=(hL-hM)/(e-i);hI=c8(Math.atan(hJ))}else{hI=90}if(hI<0){hI=180+hI}var T=hI;while(this._preAngle-hI>100){hI=hI+180}while(this._preAngle-hI<-100){hI=hI-180}var hK=this._initAngle-hI;this._preAngle=hI;return hK};he.prototype._processMouseUp=function(hJ){var hI=this._map;if(hI.currentOperation===dO.idle){return}if(hJ.button!==this._opButton){return}this._currentTouchCount--;if(hI.currentOperation===dO.readyToDrag||hI.currentOperation===dO.dragging){if(this._trackVelocityTimer){clearInterval(this._trackVelocityTimer);this._trackVelocityTimer=null}this._dragStarted=false;var i;if(this._lastDragPoint.x===this._penultimateDragPoint.x&&this._lastDragPoint.y===this._penultimateDragPoint.y){i={x:this._diffX,y:this._diffY}}else{i={x:this._lastDragPoint.x-this._penultimateDragPoint.x,y:this._lastDragPoint.y-this._penultimateDragPoint.y}}this._getCurrentDrag().onDragEnd(hJ,{velocity:this._operationVelocity,dragDistance:{x:this._diffX,y:this._diffY},gestureStatus:this._gestureStatus,dir:i});this._clearStatus(hJ);this._resetGestureParam();if(C.Browser.ie||(C.Browser.firefox&&hJ.target.releaseCapture)){hJ.target.releaseCapture()}this._opButton=-1}else{if(hI.currentOperation===dO.pinching){if(!this._useGesture){var T=this._pinchParam;if(T){this._getCurrentDrag().onPinchEnd(hJ,{pinchStartPosition:this._pinchStartPosition,pinchEndPosition:this._pinchingPosition,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:this._gestureStatus})}this._resetGestureParam()}this._clearId(hJ.id)}else{if(hI.currentOperation===dO.freeze){if(this._currentTouchCount===0){this._clearStatus(hJ)}else{if(hJ.id===this._firstTouchInfo.id||hJ.id===this._secondTouchInfo.id){if(!this._useGesture){var T=this._pinchParam;if(T){this._getCurrentDrag().onPinchEnd(hJ,{pinchStartPosition:this._pinchStartPosition,pinchEndPosition:this._pinchingPosition,zoomRatio:T.zoomRatio,angleDiff:T.rotation,gestureStatus:this._gestureStatus})}this._resetGestureParam()}this._clearId(hJ.id)}}}}}hI.currentOperation=this._stateMachine.takeAction("mouseup",hJ.id);if(hJ.changedTouchesCount===2||hJ.targetTouchesCount===0){hJ.changedTouchesCount=1;this._processMouseUp(hJ)}if(this._currentTouchCount===0&&fW()){this._diffX=this._diffY=0}};he.prototype._clearId=function(e){if(e===this._firstTouchInfo.id){this._firstTouchInfo={}}else{if(e===this._secondTouchInfo.id){this._secondTouchInfo={}}}};he.prototype._clearStatus=function(){this._firstTouchInfo={};this._secondTouchInfo={}};he.prototype._processRightClick=function(hJ){var hI=this._map;var T=hI.temp;if(T.rightDblclickTimer){clearTimeout(T.rightDblclickTimer);T.rightDblclickTimer=null;hI.dispatchEvent(C.extend(new a6("onrightclick"),hJ));hI.dispatchEvent(C.extend(new a6("onrightdblclick"),hJ))}else{hI.dispatchEvent(C.extend(new a6("onrightclick"),hJ));var i=C.extend(new a6("onrightclickex"),hJ);T.rightDblclickTimer=setTimeout(function(){T.rightDblclickTimer=null;hI.dispatchEvent(i)},hI.config.clickInterval)}};he.prototype._bindMouseWheel=function(){var hI=this._map;var T=this;if(!C.Browser.firefox){C.on(hI.container,"mousewheel",function i(hJ){if(hI.getLock()===true){return}if(!hI.config.enableWheelZoom){return}if(hI.mapType!==BMAP_EARTH_MAP){if(T._isModernBrowser){T._deepZoomWheel(hJ)}else{T._wheel(hJ)}}else{if(T._earthWheel){T._earthWheel.onWheel(aD(hJ,hI))}}bP(hJ)})}else{C.on(hI.container,"wheel",function e(hJ){if(hI.getLock()===true){return}if(!hI.config.enableWheelZoom){return}if(hI.mapType!==BMAP_EARTH_MAP){if(T._isModernBrowser){T._deepZoomWheel(hJ)}else{T._wheel(hJ)}}else{if(T._earthWheel){T._earthWheel.onWheel(aD(hJ,hI))}}bP(hJ)})}};he.prototype._getCurrentDrag=function(){var e=this._map;if(e.getMapType()!==BMAP_EARTH_MAP){return this._drag}return this._earthDrag};he.prototype._wheel=function(hL){var hK=this._map;var hI=this._map.temp;if(hI.dragAni){hI.dragAni.stop();hI.dragAni=null;setTimeout(function(){hK.dispatchEvent(new a6("onmoveend"))},1)}if(hI.touchZoomLabelCanvas){hI.touchZoomLabelCanvas.style.display="none"}if(hI.touchZoomDiv){hI.touchZoomDiv.style.display="none"}hL=window.event||hL;hK.lastLevel=hK.zoomLevel;var T=new a6("onmousewheel");T.trend=hL.wheelDelta>=0;if(isNaN(hL.wheelDelta)){T.trend=hL.deltaY<=0}var i=new Date();if(T.trend===true&&hK.zoomLevel===hK.getMaxZoom()||T.trend===false&&hK.zoomLevel===hK.getMinZoom()||i-this._lastWheelTime<220){hK.currentOperation^=dO.mousewheel;if(T.trend===true&&hK.zoomLevel===hK.getMaxZoom()||T.trend===false&&hK.zoomLevel===hK.getMinZoom()){var hJ=new a6("onzoomexceeded");if(hK.zoomLevel===hK.getMaxZoom()){hJ.targetZoom=hK.zoomLevel+1}else{hJ.targetZoom=hK.zoomLevel-1}hK.dispatchEvent(hJ)}bP(hL);return}this._astWheelTime=i;C.extend(T,aD(hL,hK));hK.dispatchEvent(T)};he.prototype._deepZoomWheel=function(hI){var T=this._map;var i=new a6("ondeepzoommousewheel");C.extend(i,aD(hI,T));T.dispatchEvent(i)};he.prototype.setEarthDrag=function(e){this._earthDrag=e};he.prototype.setEarthWheel=function(e){this._earthWheel=e};he.prototype._trackVelocity=function(){var T=(new Date()).getTime();var e=T-this._trackTimeStamp;if(e===0){return}this._trackTimeStamp=T;var hI=Math.sqrt(Math.pow(this._diffX,2)+Math.pow(this._diffY,2));var hJ=Math.abs(hI-this._lastDiffDistance);this._lastDiffDistance=hI;var i=500*hJ/e;this._operationVelocity=(0.6*i+0.4*this._operationVelocity)};function bz(e){this.map=e;this.tileMgr=e.tileMgr;this.canvas2dMapMgr=e.canvas2dMapMgr;this.enableCanvas2dMap=!!(e.getRenderType()==="canvas");this.zoomCount=0;this.preZoomCount=null;this.preRenderTick=1;this.maxZoomWheelDir=1;this.minZoomWheelDir=-1;this.isDispatchZoomStart=false;this.maxZoom=e.getMaxZoom();this.minZoom=e.getMinZoom();this.lastWheelTime=0;this.opMethod="";this.inDecayMode=false;this.lastWheelDelta=0;this.lastDiff=0;this._animationLayer=gf.get(e);this.bindEvent()}var bS=bz.prototype;bS.bindEvent=function(){var e=this;var i=e.map;i.addEventListener("maptypechange",function(T){e.maxZoom=i.getMaxZoom();e.minZoom=i.getMinZoom()});i.addEventListener("deepzoommousewheel",function(T){e.wheel(T)})};bS.wheel=function(hX){var h1=this,h0=h1.map,hP=h0.temp;if(hP.dragAni){h1.enableCanvas2dMap&&h1.canvas2dMapMgr.updateLabel();hP.dragAni.stop();hP.dragAni=null;h0.dispatchEvent(new a6("onmoveend"))}var hJ=Math.floor(hX.timeStamp);var hY=hJ-this.lastWheelTime;var hT=hX.wheelDelta>=0;if(isNaN(hX.wheelDelta)){hT=hX.deltaY<=0}var hZ=Math.abs(hX.deltaY);var hK=Math.abs(hX.wheelDelta);var hU=hZ;if(hY>100){this.inDecayMode=false;this.opMethod=bG(hK,hU,hX.deltaMode);this.zoomCount=0;this.preZoomCount=null;h0.fire(new a6("onmousewheelscroll"))}if(this.opMethod==="padScroll"){if(hU===0&&hY===0){if(this.inDecayMode===false){this.inDecayMode=true}}}if(hY===0){return}this.lastWheelTime=hJ;if(this.opMethod==="padScroll"&&hY<40){if(hT){h1.zoomCount+=0.13}else{h1.zoomCount-=0.16}var hQ=hX.wheelDelta-this.lastWheelDelta;var i=hQ-this.lastDiff;var hI=this.lastDiff;this.lastDiff=hQ;this.lastWheelDeltaAbs=hK;this.lastWheelDelta=hX.wheelDelta;this.lastTrend=hT;if(typeof this.lastTrend==="boolean"&&hT!==this.lastTrend||this.opMethod==="padScroll"&&hK===3&&!isNaN(i)&&Math.abs(hQ-hI)>50){h1._animationLayer.stopAnimation();if(h1.zoomAni){h1.zoomAni.stop();h1.zoomAni=null}}else{if(this.preZoomCount!==0){if((hQ<0&&hI>0)||(hQ>0&&hI<0)){if(hU<5){this.inDecayMode=false}}else{return}}}}this.preZoomCount=this.zoomCount;var hW=hX.wheelDelta/120||-hX.detail/3;if(hW===0&&C.Browser.firefox){hW=-hX.deltaY}if(hW===0){return}var hV=hW>=0?1:-1;var hN=Math.ceil(Math.abs(hW))*hV;if(this.opMethod==="padPinch"){hN=hX.deltaY}var hM=hN>0?1:-1;var T=h0.getZoom();if(hM<0){h1.maxZoomWheelDir=-1}if(hM>0){h1.minZoomWheelDir=1}var hS=h1.maxZoom;var hO=h1.minZoom;if((T>=hS&&hM>0&&h1.maxZoomWheelDir===1)||(T<=hO&&hM<0&&h1.minZoomWheelDir===-1)){var hR=new a6("onzoomexceeded");if(T>=hS){hR.targetZoom=T+1}else{hR.targetZoom=T-1}h0.dispatchEvent(hR);return}if(this.opMethod==="mouseWheel"&&this.zoomAni){return}if(this.opMethod!=="mouseWheel"){hN*=0.6}h1.zoomCount+=hN;if(this.opMethod==="mouseWheel"){h1.zoomCount=h1.limitZoomCount(h1.zoomCount)}var hL=new eb(hX.pixel.x,hX.pixel.y);if(this.opMethod!=="mouseWheel"){if(h1.zoomAni||h1.timer||h1.zoomCount===0||h1.inDecayMode===true){return}h1.timer=setTimeout(function(){var e=Math.abs(h1.zoomCount);e=Math.round(e);if(hT){h1.zoomCount=e}else{h1.zoomCount=-e}h1.zoomCount=h1.limitZoomCount(h1.zoomCount);if(h1.zoomCount===0){h1.timer=null;return}h1.zoomMap(hL,h1.zoomCount,hM);h1.timer=null},30);return}this._animationLayer.stopAnimation();h1.timer&&clearTimeout(h1.timer);h1.timer=setTimeout(function(){h1.zoomMap(hL,h1.zoomCount,hM);h1.timer=null},25)};bS.limitZoomCount=function(T){var hI=this,hJ=hI.minZoom,e=hI.maxZoom,i=this.map.getZoom();T=Math.min(Math.max(T,-3),3);if(i+T>e){T=e-i}else{if(i+T<hJ){T=hJ-i}}return T};bS.zoomMap=function(hJ,hQ,hK,hI,i){var hT=this.map;var e=hT.getZoom();var hL=hT.getCenterIn().clone();var hU=this;var T=hU.tileMgr;var hR=e+Math.round(hQ);var hO=hT.width;var hM=hT.height;i=i||{};hI=hI||new d1(0,0);if(i.fireEvent!==false&&!hU.isDispatchZoomStart){hU.isDispatchZoomStart=true;hT.dispatchEvent(new a6("onzoomstart"))}if(hT.config.zoomCenter){hJ=hT.pointToPixelIn(hT.config.zoomCenter)}var hW=hT.pixelToPointIn(hJ);var hV=hT.getZoomUnits(hR);var hN=new hj(hW.lng+hV*(hO/2-hJ.x+hI.width),hW.lat-hV*(hM/2-hJ.y+hI.height));hN=hT.restrictCenter(hN,hV,hR);var hP=hT.pointToPixelIn(hW,{center:hN,zoom:hR});var hS=0;this.zoomAni=this._animationLayer.startAnimation({fixPosition:hJ,fixMCPosition:hW,zoomCount:hQ,pixOffset:hI,onAnimationBeforeLooping:function(hZ,h1){var hX=hT.getZoomUnits(h1);var h0=new hj(hW.lng+hX*(hO/2-hJ.x+hI.width*hZ),hW.lat-hX*(hM/2-hJ.y+hI.height*hZ));h0=hT.restrictCenter(h0,hX,h1);var h3=hT.pointToPixelIn(hW,{center:h0,zoom:h1});var hY=0;if(hT.isRestrict===true){hY=h3.y-hJ.y}if(hY!==0&&hS===0){var h2=hT.pointToPixelIn(hW,{center:h0,zooom:h1});hS=hP.y-h2.y}return{loopingCenter:h0,yDiff:hY,totalYDiff:hS}},onAnimationLooping:function(hY,h1,hZ){if(!hZ){var hX=hT.getZoomUnits(h1);hZ=new hj(hW.lng+hX*(hO/2-hJ.x+hI.width*hY),hW.lat-hX*(hM/2-hJ.y+hI.height*hY));hZ=hT.restrictCenter(hZ)}if(hU.enableCanvas2dMap){var h0=new a6("onzooming_inner");h0.zoom=h1;h0.center=hZ;hT.dispatchEvent(h0)}},onAnimationFinish:function(){hT.zoomLevel=hR;hT.centerPoint=hN;T.moveGridTiles();hT.dispatchEvent(new a6("onzooming"));if(i.fireEvent!==false){var hX=new a6("onzoomend");hX.notClearLabel=true;hT.dispatchEvent(hX)}hU.zoomCount=0;hU.maxZoomWheelDir=1;hU.minZoomWheelDir=-1;hU.isDispatchZoomStart=false;hU.zoomAni=null;if(i.callback){i.callback()}}})};function gU(e){this._map=e;this._touchZoomLayer=null;this._zoomStartFired=false}C.extend(gU.prototype,{onReadyToDrag:function(hJ,i){if(hJ.button===2){return}var hI=this._map;var T=hI.temp;if(T.dragAni){T.dragAni.stop();T.dragAni=null;hI.dispatchEvent(new a6("onmoveend"))}if(!hI.config.enableDragging){return}T.pl=hI.offsetX;T.pt=hI.offsetY;if(T.curSpotsArray.length===0){hI.platform.style.cursor=hI.config.draggingCursor}else{hI.platform.style.cursor="pointer"}},onReadyToPinch:function(hJ,T){if(!this._touchZoomLayer){this._touchZoomLayer=gf.get(this._map)}this._touchZoomLayer.hideNonAnimationLayers();var i=T.pinchStartPosition;if(this._map.config.fixCenterWhenPinch){var hI=this._map.getSize();i.x=hI.width/2;i.y=hI.height/2}this._touchZoomLayer.setFixPosition(i);this._touchZoomLayer.prepareLayer();this._touchZoomLayer.prepareAniParam();this._touchZoomLayer.prepareLabelLayer();this._pinchStartPosition=i;this._pinchStartPositionMC=this._map.pixelToPointIn(i)},onDragStart:function(T){if(T.button===2){return}var i=this._map;if(!i.config.enableDragging){return}i.platform.style.cursor=i.config.draggingCursor},onDragging:function(hK,T){var hJ=this._map;if(!hJ.config.enableDragging){return}if(hK.button===2||T.button===2){return}var hI=hJ.temp;var i=40;var hL=hK.timeStamp;var hM=(hL-hI.lastLoadTileTime)>i;if(hM){hI.lastLoadTileTime=hL}hI.lastDomMoveTime=hL;if(Math.abs(T.diffX)>1||Math.abs(T.diffY)>1){if(!hI._moved){hJ.dispatchEvent(C.extend(new a6("ondragstart"),hK));hJ.dispatchEvent(new a6("onmovestart"));hI._moved=true}hJ.dispatchEvent(C.extend(new a6("ondragging"),hK));hJ._setPlatformPosition(T.diffX,T.diffY,{initMapOffsetX:hI.pl,initMapOffsetY:hI.pt,dispatchEvent:hM})}},onPinching:function(hM,hI){var hJ=this._map;var T=this._pinchStartPositionMC;var hP=this._pinchStartPosition;var hK=Math.log(hI.zoomRatio)/Math.log(2);if(hK!==1&&this._zoomStartFired===false){hJ.dispatchEvent(new a6("onzoomstart"));this._zoomStartFired=true}var hO=hJ.getZoom()+hK;if(hO>hJ.getMaxZoom()){hO=hJ.getMaxZoom()}else{if(hO<hJ.getMinZoom()){hO=hJ.getMinZoom()}}var hR=Math.pow(2,hO-hJ.getZoom());var hQ=hJ.getZoomUnits(hO);var i=new hj(T.lng+hQ*(hJ.width/2-hP.x),T.lat-hQ*(hJ.height/2-hP.y));i=hJ.restrictCenter(i,hQ,hO);var hL=hJ.pointToPixelIn(T,{center:i,zoom:hO});var hN=hL.y-hP.y;this._touchZoomLayer.setZoom(hR,hN);var hM=new a6("onzooming_inner");hM.zoom=hO;hM.center=i;hJ.dispatchEvent(hM)},onDragEnd:function(hJ,i){var hI=this._map;if(!hI.config.enableDragging){return}if(hJ.button===2){return}var T=hI.temp;if(T.curSpotsArray.length===0){hI.platform.style.cursor=hI.config.defaultCursor}else{hI.platform.style.cursor="pointer"}if(T._moved){hI.dispatchEvent(C.extend(new a6("ondragend"),hJ));if(!hI.config.enableInertialDragging||hJ.timeStamp-T.lastDomMoveTime>100){hI.dispatchEvent(new a6("onmoveend"))}else{this._processMotion(i.velocity,i.dragDistance)}}T._moved=false},onPinchEnd:function(hL,i){var hK=this._map;var hI=Math.round(Math.log(i.zoomRatio)/Math.log(2));var T=Math.max(Math.min(hK.getZoom()+hI,hK.getMaxZoom()),hK.getMinZoom());var hM=hK.pixelToPointIn(this._pinchStartPosition);hK.zoomTo(T,hM,{noAnimation:true,fireEvent:false});hK.dispatchEvent(new a6("onzoomend"));this._zoomStartFired=false;var hJ=this;setTimeout(function(){hJ._touchZoomLayer.showNonAnimationLayers();hJ._touchZoomLayer.setZoomFinish();hJ._touchZoomLayer.showLabel()},30)},_processMotion:function(hI,hR){var hO=this._map;var hT=hO.temp;var i=(new Date()).getTime();var e=0.5*hI;var hS=0;var hQ=0;if(hR.y===0){hS=e}else{var hM=Math.abs(hR.x/hR.y);hQ=Math.round(Math.sqrt(e*e/(1+hM*hM)));hS=Math.round(hM*hQ)}var hP=hR.x+hS;var hN=hR.y+hQ;if(hR.x<0){hP=hR.x-hS}if(hR.y<0){hN=hR.y-hQ}if(hT.dragAni){hT.dragAni.stop();hT.dragAni=null;hO.dispatchEvent(new a6("onmoveend"))}var hK=true;var T=hO.config.isModernBrowser?60:30;var hL=0;var hJ=0;hT.dragAni=new o({duration:10000,fps:T,render:function(hW,hV){var hU=(new Date()).getTime()-i;var hX=Math.exp(-hU/250);hL=hR.x>=0?(hP-hS*hX):(hP+hS*hX);hJ=hR.y>=0?(hN-hQ*hX):(hN+hQ*hX);if(hS*hX<10&&hQ*hX<10){hT.dragAni.stop();return}hO._setPlatformPosition(Math.round(hL),Math.round(hJ),{initMapOffsetX:hT.pl,initMapOffsetY:hT.pt,dispatchEvent:hK})},finish:function(){hT.dragAni=null;hO._setPlatformPosition(Math.round(hL),Math.round(hJ),{initMapOffsetX:hT.pl,initMapOffsetY:hT.pt});hO.dispatchEvent(new a6("onmoveend"))},onStop:function(){hT.dragAni=null;hO._setPlatformPosition(Math.round(hL),Math.round(hJ),{initMapOffsetX:hT.pl,initMapOffsetY:hT.pt});hO.dispatchEvent(new a6("onmoveend"))}})}});bj.register(function(i){var e=i;if(i._keyboardInit===true){return}i._keyboardInit=true;C.on(document,"keydown",function(T){if(e.temp.stopArrow===true){e.temp.stopArrow=false}if(e.config.enableKeyboard&&e.temp.canKeyboard){var T=window.event||T;var hI=false;if(C.Platform.macintosh){if(T.metaKey===true){hI=true}}else{if(T.ctrlKey===true){hI=true}}switch(T.keyCode||T.which){case 189:case 109:case 173:if(!hI){e.temp.operating=true;e.dispatchEvent(new a6("onminuspress"))}break;case 61:case 187:case 107:if(!hI){e.temp.operating=true;e.dispatchEvent(new a6("onpluspress"))}break;case 33:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 34:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 35:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 36:e.temp.operating=false;e.temp.stopArrow=true;T.cancelBubble=true;T.returnValue=false;break;case 37:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=1;e._arrow();T.cancelBubble=true;T.returnValue=false;break;case 38:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=2;e._arrow();T.cancelBubble=true;T.returnValue=false;break;case 39:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=4;e._arrow();T.cancelBubble=true;T.returnValue=false;break;case 40:if(e.mapType==="B_EARTH_MAP"){return}e.temp.operating=true;e.temp.arrow|=8;e._arrow();T.cancelBubble=true;T.returnValue=false;break}}});C.on(document,"keyup",function(T){if(e.config.enableKeyboard){var T=window.event||T;switch(T.keyCode||T.which){case 37:e.temp.arrow=e.temp.arrow&~1;if(e.temp.arrow!==0){e._arrow()}break;case 38:e.temp.arrow=e.temp.arrow&~2;if(e.temp.arrow!==0){e._arrow()}break;case 39:e.temp.arrow=e.temp.arrow&~4;if(e.temp.arrow!==0){e._arrow()}break;case 40:e.temp.arrow=e.temp.arrow&~8;if(e.temp.arrow!==0){e._arrow()}break}}e.temp.operating=false});c2.prototype._arrow=function(){if(this.mapType===BMAP_EARTH_MAP){return}if(this._arrow.occurrent&&this._arrow._lastArrow===this.temp.arrow&&this.temp.stopArrow===true){return}var T=this;var hJ=T.temp.arrow;T._arrow._lastArrow=hJ;T._arrow.interval=30;T._arrow.duration=999;T._arrow.dx=T._arrow.dy=0;if(hJ&1){T._arrow.dx=1}if(hJ&2){T._arrow.dy=1}if(hJ&4){T._arrow.dx=-1}if(hJ&8){T._arrow.dy=-1}if(hJ&1&&hJ&4){T._arrow.dx=0}if(hJ&2&&hJ&8){T._arrow.dy=0}if(!T._arrow.occurrent){T._arrow.occurrent=true;T._arrow.time=new Date().getTime();T._arrow.beginTime=T._arrow.time;T.dispatchEvent(new a6("onmovestart"));var hI=new o({fps:T._arrow.interval,duration:T._arrow.duration,transition:ci.linear,render:function(hQ){var hL=T._arrow;var hO=T.temp.arrow;if(T._arrow._lastArrow!==hO){T._arrow._lastArrow=hO;if(hO&1){hL.dx=1}if(hO&2){hL.dy=1}if(hO&4){hL.dx=-1}if(hO&8){hL.dy=-1}if(hO&1&&hO&4){hL.dx=0}if(hO&2&&hO&8){hL.dy=0}}if(T.temp.stopArrow===true){hL.dx=0;hL.dy=0}var hP=new Date().getTime();var hN=Math.pow((hP-hL.beginTime)/hL.duration,2);if(!T.temp.arrow){hL.occurrent=false;hI.terminative=true;T._arrow.time=new Date().getTime();setTimeout(function(){T.dispatchEvent(new a6("onmoveend"))},40)}var hR=(hP-hL.time);var hM=hL.dx*hR*hN>=0?Math.ceil(hL.dx*hR*hN):Math.floor(hL.dx*hR*hN);var hK=hL.dy*hR*hN>=0?Math.ceil(hL.dy*hR*hN):Math.floor(hL.dy*hR*hN);if(hM!==0&&hK!==0){hM=Math.round(hM*0.7);hK=Math.round(hK*0.7)}hL.time=hP;T._setPlatformPosition(hM,hK)},finish:function(){T._arrow.time=new Date().getTime();setTimeout(function(){T._arrowPan()},T._arrow.interval)}})}};c2.prototype._arrowPan=function(){var hK=this;var hI=hK._arrow;if(hK.temp.stopArrow){hI.dx=0;hI.dy=0}if(!hK.temp.arrow){hI.occurrent=false;hK.dispatchEvent(new a6("onmoveend"));return}var hL=new Date().getTime();var hM=(hL-hI.time);var hJ=Math.ceil(hI.dx*hM);var T=Math.ceil(hI.dy*hM);hI.time=hL;hK._setPlatformPosition(hJ,T);setTimeout(function(){hK._arrowPan()},hI.interval)}});e5.prototype.zoom=function(hJ,hI){var hL=hI?hI.width:0;var hK=hI?hI.height:0;var hW=this.map;var hY=hW.config;var hX=this;var hV={x:hJ.x-parseInt(hX.tilesDiv.style.left,10)-hW.offsetX,y:hJ.y-parseInt(hX.tilesDiv.style.top,10)-hW.offsetY};if(hW.overlayDiv){hW.overlayDiv.style.visibility="hidden"}var e;for(var hS=0,hR=hX.tileLayers.length;hS<hR;hS++){e=hX.tileLayers[hS];if(!e.baseLayer){e.tilesDiv.style.visibility="hidden"}}if(!this.zoomsDiv){this.zoomsDiv=this.tilesDiv.cloneNode(true)}else{if(this.zoomsDiv.parentNode&&!this._zTimeLine){this.zoomsDiv.parentNode.removeChild(this.zoomsDiv);this.zoomsDiv=null;this.zoomsDiv=this.tilesDiv.cloneNode(true)}}var T=this.zoomsDiv;var hP=T.style;hP.display="block";this.tilesDiv.style.visibility="hidden";hW.platform.insertBefore(T,hW.platform.firstChild);var hU=[];var hM=hW.zoomLevel-hW.lastLevel;if(!hX._diff){hX._diff=hM}else{if(hW.zoomLevel-hW.lastLevel>0){hX._diff++}else{hX._diff--}}if(this._zTimeLine&&this._zTimeLine.schedule===0){this._zTimeLine.stop();this._zTimeLine=null;hM=hX._diff}var hO=Math.pow(2,hM);var hT=T.children.length;for(var hS=hT-1;hS>-1;hS--){var hN={};var hQ=T.children[hS].style;hN.top=parseInt(hQ.top,10)||0;hN.left=parseInt(hQ.left,10)||0;hN.width=parseInt(hQ.width,10);hN.height=parseInt(hQ.height,10);hN.dw=hN.width*hO-hN.width;hN.dh=hN.height*hO-hN.height;hN.dx=(hN.left-hV.x)*hO-(hN.left-hV.x);hN.dy=(hN.top-hV.y)*hO-(hN.top-hV.y);hU[hS]=hN}T._ol=parseInt(T.style.left,10);T._ot=parseInt(T.style.top,10);if(this._zTimeLine){this._zTimeLine.stop();this._zTimeLine=null}this._zTimeLine=new o({fps:20,duration:hY.enableContinuousZoom?hY.zoomerDuration:1,transition:ci.easeInQuad,render:function(h1){if(h1<0.1){return}for(var h0=hU.length-1;h0>-1;h0--){var h2=hU[h0];if(T.children[h0]){var hZ=T.children[h0].style;hZ.top=Math.round(h2.top+h2.dy*h1)+"px";hZ.left=Math.round(h2.left+h2.dx*h1)+"px";hZ.width=Math.ceil(h2.width+h2.dw*h1)+"px";hZ.height=Math.ceil(h2.height+h2.dh*h1)+"px"}}if(hL||hK){hP.left=T._ol-(hL*h1)+"px";hP.top=T._ot-(hK*h1)+"px"}},finish:function(){if(hW.getZoom()===3&&hW.getMapType()==="B_NORMAL_MAP"){hW.centerPoint.lat=0}hX.moveGridTiles(true);if(hW.overlayDiv){setTimeout(function(){hW.overlayDiv.style.visibility="visible"},10)}for(var h0=0,hZ=hX.tileLayers.length;h0<hZ;h0++){e=hX.tileLayers[h0];if(!e.baseLayer){e.tilesDiv.style.visibility=""}}hX.tilesDiv.style.visibility="";delete hX._diff;hW.dispatchEvent(new a6("onzoomend"));T=null;hX._zTimeLine=null}})};');
