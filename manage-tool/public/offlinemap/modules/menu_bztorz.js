/**/ï»¿_jsload&&_jsload('menu', 'C.extend(ca.prototype,{initialize:function(e){if(this._container){return false}this._map=e;this._render();var hN=this;this._container.style.cursor=e.config.defaultCursor;C.on(document,"mousedown",function(i){if(!hN._container){return}hN.hide()});C.on(this._container,"mousemove",h);C.on(this._container,"click",function(i){hN.hide();h(i)});var hM=this._opts.container;if(!hM){hM=this._map.container;e.addEventListener("onspotmouseover",function(i){hN.spots=i.spots});var T;e.addEventListener("onspotmouseout",function(i){T=i.spots;delete hN.spots});e.addEventListener("onspotclick",function(i){hN.spots=i.spots});e.addEventListener("rightclickex",function(hT){if(this.getMapType()===BMAP_EARTH_MAP){return}if(!hN._container||hT.infoWindow||!hN._enable){return}if(e.currentOperation!==dO.idle){return}if(!hN.spots&&T&&T.length>0){var hV=hT.pixel;var hU=T[0];var hS=hU.pt;var i=this.pointToPixelIn(hS);var hR=hU.bd;if(hV.x-i.x<hR[2]&&hV.x-i.x>hR[0]&&i.y-hV.y<hR[3]&&i.y-hV.y>hR[1]){hN.spots=T}}hN._showMenu(hT,hM);delete hN.spots});e.addEventListener("forcedown",function(hT){if(this.getMapType()===BMAP_EARTH_MAP){return}if(!hN._container||hT.infoWindow||!hN._enable){return}if(!hN.spots&&T&&T.length>0){var hV=hT.pixel;var hU=T[0];var hS=hU.pt;var i=this.pointToPixelIn(hS);var hR=hU.bd;if(hV.x-i.x<hR[2]&&hV.x-i.x>hR[0]&&i.y-hV.y<hR[3]&&i.y-hV.y>hR[1]){hN.spots=T}}hN._showMenu(hT,hM);delete hN.spots})}else{C.on(hM,"contextmenu",function(hR){if(e.getMapType()===BMAP_EARTH_MAP){return}if(e.currentOperation!==dO.idle){return}if(!hN._container||!hN._enable){return}hR=window.event||hR;var i=hR.target||hR.srcElement;while(i&&!C.hc(i,"pop")){i=i.parentNode}if(i&&C.hc(i,"pop")){hN.hide();return}hN._showMenu(hR,hM,true);return bP(hR)})}var hP=[];for(var hK=this._items.length-1;hK>=0;hK--){var hQ=this._items[hK];if(hQ._insertIndex!==-1){hP=hP.concat(this._items.splice(hK,1))}}for(var hK=0,hI=this._items.length;hK<hI;hK++){var hQ=this._items[hK];if(hQ._type==="menuitem"){hQ.initialize(e,this)}if(hQ._type==="divider"){this._dividers[hQ._dIndex].dom=dC(this._container,"<div class=\'BMap_cmDivider\'></div>")}}for(var hK=hP.length-1;hK>=0;hK--){var hQ=hP[hK];if(hQ._type==="menuitem"){hQ.initialize(e,this)}if(hQ._type==="divider"){for(var hJ=0,hO=this._items.length;hJ<hO;hJ++){if(hJ===hQ._insertIndex){var hL=this._items[hJ]._container||this._dividers[this._items[hJ]._dIndex].dom;this._dividers[hQ._dIndex].dom=hs(hL,"<div class=\'BMap_cmDivider\'></div>");break}}}}for(var hK=hP.length-1;hK>=0;hK--){var hQ=hP[hK];this._items.splice(hQ._insertIndex,0,hQ)}this._updateShadowSize()},_draw:function(){if(this._map){this.initialize(this._map);if(this._isOpen){this._isOpen=false;this.show()}}},remove:function(){if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}this._map=null},_render:function(){this._container=dC(this._map.container,"<div unselectable=\'on\'></div>");this._container.className="BMap_contextMenu";this._container.style.fontSize="12px";return this._container},addItem:function(hJ,e){if(!hJ||hJ._type!="menuitem"||hJ._text==""||hJ._width<=0){return}for(var hI=0,T=this._items.length;hI<T;hI++){if(this._items[hI]===hJ){return}}if(e===undefined||e>this._items.length-1){e=-1}hJ._insertIndex=e;hJ.initialize(this._map,this);if(e===-1){this._items.push(hJ);this._rItems.push(hJ)}else{this._items.splice(e,0,hJ);this._rItems.splice(e,0,hJ)}C.ac(hJ.getDom(),"BMap_cmLstItem");if(this._items.length>1){this._items[this._items.length-2]._type=="menuitem"&&C.rc(this._items[this._items.length-2].getDom(),"BMap_cmLstItem")}else{this._items[0]._type=="menuitem"&&C.ac(this._items[0].getDom(),"BMap_cmFstItem")}this._updateShadowSize()},removeItem:function(hI){if(!hI||hI._type!="menuitem"){return}for(var T=0,e=this._items.length;T<e;T++){if(this._items[T]===hI){this._items[T].remove();this._items.splice(T,1);delete hI._insertIndex;e--}}for(var T=0,e=this._rItems.length;T<e;T++){if(this._rItems[T]===hI){this._rItems[T].remove();this._rItems.splice(T,1);delete hI._insertIndex;e--}}if(!this._container){return}if(this._items.length>0){this._items[this._items.length-1]._type=="menuitem"&&C.ac(this._items[this._items.length-1].getDom(),"BMap_cmLstItem")}this._updateShadowSize()},addSeparator:function(e){if(e===undefined||e>this._items.length-1){e=-1}var hM={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null});if(!this._container){return}var hL="<div class=\'BMap_cmDivider\'></div>";if(e===-1){this._dividers[this._dividers.length-1].dom=dC(this._container,hL)}else{var hJ=this._items;for(var hK=0,hI=hJ.length;hK<hI;hK++){if(hK===e){var T=hJ[hK]._container||this._dividers[hJ[hK]._dIndex].dom;this._dividers[this._dividers.length-1].dom=hs(T,hL);break}}}if(e===-1){this._items.push(hM)}else{this._items.splice(e,0,hM)}this._updateShadowSize()},removeSeparator:function(T){if(!this._dividers[T]){return}if(this._dividers[T].dom&&this._dividers[T].dom.parentNode){this._dividers[T].dom.parentNode.removeChild(this._dividers[T].dom)}for(var hI=0,e=this._items.length;hI<e;hI++){if(this._items[hI]&&this._items[hI]._type=="divider"&&this._items[hI]._dIndex==T){this._items.splice(hI,1);e--}if(this._items[hI]&&this._items[hI]._type=="divider"&&this._items[hI]._dIndex>T){this._items[hI]._dIndex--}}this._dividers.splice(T,1);this._updateShadowSize()},setPosition:function(e,i){this._left=e;this._top=i;this._container.style.left=e+"px";this._container.style.top=i+"px"},show:function(){if(this._isOpen==true){return}if(this._rItems.length==0){return}this._isOpen=true;if(this._container){this._container.style.visibility="visible"}var e=new a6("onopen");e.point=this.curPoint;e.pixel=this.curPixel;this.dispatchEvent(e)},hide:function(){if(this._isOpen==false){return}this._isOpen=false;if(this._container){this._container.style.visibility="hidden"}var e=new a6("onclose");e.point=this.curPoint;e.pixel=this.curPixel;this.dispatchEvent(e)},setCursor:function(e){if(!e){return}this._opts.cursor=e;if(this._container){this._container.style.cursor=this._opts.cursor}},_updateShadowSize:function(){if(this._container){this._container.offsetWidth+"px";this._container.offsetHeight+"px"}},_showMenu:function(hK,hN,hM){if(this._rItems.length==0){return}var hO=this;var hQ=hK.layerX||hK.offsetX;var hP=hK.layerY||hK.offsetY;var hS=hK.target||hK.srcElement;if(hM){var hL=hS;if(hN==hO._map.container&&hL!==hO._map.maskLayer&&hL.nodeName.toLowerCase()!="svg"){while(hL&&!C.hc(hL,"shadow")){hL=hL.parentNode}if(!C.hc(hL,"shadow")||hL.getAttribute("type")!="infowindow_shadow"){hO.hide();return}}while(hS&&hS!=hO._map.container){if(!(hS.clientWidth==0&&hS.clientHeight==0&&hS.offsetParent&&hS.offsetParent.nodeName.toLowerCase()=="td")){if(hS.nodeName.toLowerCase()=="svg"){hQ+=parseInt(hS.getAttribute("viewBox").split(" ")[0])||0;hP+=parseInt(hS.getAttribute("viewBox").split(" ")[1])||0}else{hQ+=hS.offsetLeft;hP+=hS.offsetTop}}hS=hS.offsetParent||hS.parentNode}hO.curPixel=new eb(hQ,hP)}else{hO.curPixel=hK.pixel}if(this.spots&&this.spots.length>0){var hJ=this.spots[0];var hT=hJ.userdata.iconPoint;hO.curPoint=hT;hO.curPixel=hO._map.pointToPixelIn(hT)}else{if(hK.overlay&&hK.overlay instanceof dk){hO.curPoint=hK.overlay.getPoint();hO.curPixel=hO._map.pointToPixelIn(hO.curPoint)}else{hO.curPoint=hO._map.pixelToPointIn(hO.curPixel)}}if(hO.curPoint.lng<b1[hO._map.mapType].bounds[0]||hO.curPoint.lng>b1[hO._map.mapType].bounds[2]||hO.curPoint.lat<b1[hO._map.mapType].bounds[1]||hO.curPoint.lat>b1[hO._map.mapType].bounds[3]){return}var hI=hO.getDom().offsetHeight;var hR=hO.getDom().offsetWidth;var T=hK.offsetX;var i=hK.offsetY;if(hM){T=hQ;i=hP}if(hK.offsetX+hR>this._map.width){T-=hR}if(hK.offsetY+hI>this._map.height){i-=hI}hO.setPosition(T,i);hO.show()}});C.extend(fq.prototype,{initialize:function(e,i){if(this._container){return false}this._map=e;this._contextmenu=i;if(i.getDom()){this._render();this._bind();if(!this._enabled){this._enabled=true;this.disable()}}return true},remove:function(){var e=this;if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}this._contextmenu=null;this._map=null},_draw:function(){if(this._contextmenu&&this._map){this.initialize(this._map,this._contextmenu)}},_render:function(){var hK="<div"+(this._opts.id?" id=\'"+this._opts.id+"\'":"")+" unselectable=\'on\'><span>"+this._text+"</span></div>";var hO=this._insertIndex;var hJ=this._contextmenu.getDom();var hL=this._contextmenu._items;var T=this._contextmenu._dividers;if(hO===-1){this._container=dC(hJ,hK)}else{for(var hI=0,e=hL.length;hI<e;hI++){if(hI===hO){var hM=hL[hI]._container||T[hL[hI]._dIndex].dom;this._container=hs(hM,hK);break}}}hJ.style.borderRadius="4px";var hN=this._container.style;hN.padding="8px 8px";hN.MozUserSelect="none";hN.lineHeight="22px";hN.width=this._opts.width+"px";if(this._enabled){hN.color="#656565";hN.cursor="pointer"}else{hN.color="#aaa";hN.cursor=this._map.config.defaultCursor}return this._container},_bind:function(){var e=this;C.on(this._container,"click",function(i){if(!e._enabled){h(i);return}if(e._callback&&e._callback.call){var T=ef.convertMC2LL(e._contextmenu.curPoint);e._callback.call(e,T,e._contextmenu.curPixel)}});C.on(this._container,"mousedown",function(i){h(i)});C.on(this._container,"mouseover",function(){if(!e._enabled){return}e._container.style.color="#3385ff";e._container.style.backgroundColor="#F0F8FF"});C.on(this._container,"mouseout",function(){if(!e._enabled){return}e._container.style.color="#656565";e._container.style.backgroundColor="#fff"})},setText:function(e){if(!e){return}this._text=e+"";if(this._container){this._container.innerHTML="<span>"+this._text+"</span>"}},enable:function(){this._enabled=true;if(this._container){this._container.style.color="#656565";this._container.style.cursor="pointer"}},disable:function(){this._enabled=false;if(this._container){this._container.style.color="#aaa";this._container.style.cursor=this._map.config.defaultCursor}}});');
