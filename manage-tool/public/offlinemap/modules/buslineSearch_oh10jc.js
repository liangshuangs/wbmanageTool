/**/﻿_jsload&&_jsload('buslineSearch', 'C.extend(dW.prototype,{_asyncSearch:function(){for(var T=0,e=this._queryList.length;T<e;T++){var hI=this._queryList[T];this[hI.method].apply(this,hI.arguments)}delete this._queryList},_getMoreUrl:function(T,e){var i=eV.apiHost+"/line?region="+T+"&name="+e+"&output=html&src=jsapi";return i},getBusList:function(e){var i=this;this._getIdByLoc(this._loc,function(hI){if(!hI){this._busListResult=new eJ({keyword:e,city:"",moreUrl:"",_cityCode:""});i._setStatus(BMAP_STATUS_INVALID_REQUEST);i._triggerCbk(ft.CBK_BUSLIST_COMPLETE,this._busListResult);return}var T={qt:i.QUERY_TYPE_BUSLIST,c:hI,wd:e};cv.request(function(hK,hJ){i._busListDataCbk(hK,hJ)},T,{keyword:e})})},_busListDataCbk:function(hJ,e){this["clearResults"]();var hL=hJ.result;if(!hJ.content||hL.error!=0||hL.type!=this.RETURN_TYPE_BUSLIST){this._busListResult=new eJ({keyword:e.keyword,city:hJ.current_city["name"],moreUrl:"",_cityCode:hJ.current_city["code"]});this._setStatus(BMAP_STATUS_SERVICE_UNAVAILABLE);this._triggerCbk(ft.CBK_BUSLIST_COMPLETE,this._busListResult);return}var hN=hJ.content,T=[];for(var hI=0,hK=hN.length;hI<hK;hI++){var hM={name:hN[hI]["name"],_uid:hN[hI]["uid"],_cityCode:hJ.current_city["code"],_index:hI,_keyword:e.keyword,_poiType:hN[hI]["poiType"]||2};T.push(hM)}this._busListResult=new eJ({keyword:e.keyword,city:hJ.current_city["name"],moreUrl:this._getMoreUrl(hJ.current_city["name"],e.keyword),listItems:T,_cityCode:hJ.current_city["code"]});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(ft.CBK_BUSLIST_COMPLETE,this._busListResult);this._renderBusListPanel();this._jumpCity(hJ.current_city["geo"],hJ.current_city["level"],hJ.current_city["code"])},_renderBusListPanel:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._busListResult&&this._busListResult.getNumBusList()>0){var e=S("div",{style:"font:12px "+eV.fontFamily+";background:#fff"});e.id="divResult"+this.hashCode;var hJ=this._busListResult.getNumBusList(),hK=[];for(var hI=0;hI<hJ;hI++){var hL=this._busListResult.getBusListItem(hI).name;hK.push("<dl style=\'margin:3px 3px\'><dt><span style=\'cursor:pointer\' onclick=BMapGL.I(\\""+this.hashCode+\'")._selectBusListItem(\'+hI+")><img id=imgBLIcon"+hI+" src="+dW._iconOpen+" style=\'border:none\' /></span>&nbsp;&nbsp;<a style=\'color:blue\' href=\'javascript:void(0)\' onclick=BMapGL.I(\\""+this.hashCode+\'")._selectBusListItem(\'+hI+")>"+hL+"</a></dt><dd id=ddBLInfo"+hI+" style=\'display:none;margin:2px 0px\'></dd></dl>")}var T="";if(this._busListResult.moreResultsUrl){T+=\'<div style="color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right">\';T+=\'<a style="color:#7777cc" href="\'+this._busListResult.moreResultsUrl+\'" target="_blank">到百度地图查看&#187;</a>\';T+="&nbsp;</div>"}e.innerHTML=hK.join("")+T;this._opts.renderOptions.panel.appendChild(e);this._triggerCbk(ft.CBK_BUSLISTHTML_SET,e)}},_jumpCity:function(hI,hJ,i){var T=this._opts.renderOptions.map;if(T){var e=O.parseGeo(hI,true).point;if(this._preCityCode){if(this._preCityCode!=i){T.centerAndZoom(e,hJ);this._preCityCode=i}}else{T.centerAndZoom(e,hJ);this._preCityCode=i}}},_switchDDContainer:function(hI){var hL=this;if(this._busListResult){for(var hJ=0,T=this._busListResult.getNumBusList();hJ<T;hJ++){var e=C.G("ddBLInfo"+hJ);var hK=C.G("imgBLIcon"+hJ);if(hJ==hI){if(e.style.display=="none"){e.style.display="block";hK.src=dW._iconClose}else{e.style.display="none";hK.src=dW._iconOpen}}else{e.style.display="none";hK.src=dW._iconOpen}}}},_selectBusListItem:function(hI,T){if(!T){var e=C.G("ddBLInfo"+hI);var i=C.G("imgBLIcon"+hI);if(e.style.display=="block"){e.style.display="none";i.src=dW._iconOpen;return}}if(this._busListResult&&this._busListResult[hI]&&this._busListResult[hI].getNumBusStations()>0){this._busLine=this._busListResult[hI];this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(ft.CBK_BUSLINE_COMPLETE,this._busLine);this._renderBusLinePanel(hI);this._renderBusLineMap(hI);return}var hJ=this;var hL=this._busListResult.getBusListItem(hI);var hK={qt:hJ.QUERY_TYPE_BUSLINE,c:hL._cityCode,uid:hL._uid};cv.request(function(hN,hM){hJ._busLineDataCbk(hN,hM,hI)},hK,{name:hL.name,_poiType:hL._poiType})},clearResults:function(){delete this._busListResult;delete this._busLine;delete this._stops;delete this._preA;this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},getBusLine:function(e){if(e&&typeof e=="object"&&e._uid&&e._uid!=""&&(typeof e._cityCode!="undefined")&&e._cityCode.toString()!=""&&(typeof e._index!="undefined")&&e._index.toString()!=""&&(typeof e._keyword!="undefined")&&e._keyword.toString()!=""){if(this._busListResult&&this._busListResult.getNumBusList()>0&&e._cityCode==this._busListResult._cityCode&&e._keyword==this._busListResult.keyword){this["_selectBusListItem"](e._index,true)}}},_busLineDataCbk:function(hU,hI,hP){var T=hU.result;if(!hU.content||!hU.content[0]||T.error!=0||T.type!=this.RETURN_TYPE_BUSLINE){this._busLine=new Y({name:hI.name});this._setStatus(BMAP_STATUS_SERVICE_UNAVAILABLE);this._triggerCbk(ft.CBK_BUSLINE_COMPLETE,this._busLine);return}var hR=hU.content[0];var hS="",hT="",hN="",hM={},hQ=[];hS=hR.startTime;hT=hR.endTime;hN=hR.company;if(hR.geo){var hJ=O.parseGeo(hR.geo,true);hM=new aj(hJ.points,{strokeWeight:10})}if(hR.stations){for(var hK=0,hO=hR.stations["length"];hK<hO;hK++){if(hR.stations[hK]["geo"]){var e=O.parseGeo(hR.stations[hK]["geo"],true);var hL={name:hR.stations[hK]["name"],position:e.point,_uid:hR.stations[hK]["uid"]};hQ.push(hL)}}}this._busLine=new Y({name:hI.name,startTime:hS,endTime:hT,company:hN,polyline:hM,stations:hQ,_poiType:hI._poiType});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(ft.CBK_BUSLINE_COMPLETE,this._busLine);this._busListResult[hP]=this._busLine;this._renderBusLinePanel(hP);this._renderBusLineMap(hP)},_renderBusLinePanel:function(hK){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._busLine&&this._busLine.getNumBusStations()>0){this._switchDDContainer(hK);var hI=C.G("ddBLInfo"+hK);if(hI){var hM=[];hM.push("<table style=\'width:100%;background:#CDCDCD;font:12px "+eV.fontFamily+"\' cellspacing=\'1\' cellpadding=\'1\' ><tbody>");hM.push("<tr><td style=\'width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4\' >首末车时间</th><td  style=\'background:#FFFFFF;line-height:22px;padding:0px 8px\' >"+this._busLine.startTime+"-"+this._busLine.endTime+"</td></tr>");hM.push("<tr><td style=\'width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4\' >所属公司</th><td  style=\'background:#FFFFFF;line-height:22px;padding:0px 8px\' >"+this._busLine.company+"</td></tr>");hM.push("</tbody></table>");if(this._busLine._poiType==4){hM.push("<p style=\'margin:2px 0px;font:12px "+eV.fontFamily+";\'>沿线地铁站:</p>")}else{hM.push("<p style=\'margin:2px 0px;font:12px "+eV.fontFamily+";\'>沿线公交站点:</p>")}hM.push("<table style=\'width:100%;font:12px "+eV.fontFamily+";\' ><tbody>");for(var hL=0,e=this._busLine.getNumBusStations();hL<e;hL++){var hJ=hL+1;hM.push("<tr><td style=\'width:20px\'>"+hJ+"</th><td><a id=aStop_"+hK+"_"+hL+" style=\'color:blue\' href=\'javascript:void(0)\' onclick=BMapGL.I(\\""+this.hashCode+\'")._selectBusStop(\'+hK+","+hL+")>"+this._busLine.getBusStation(hL).name+"</a></td></tr>")}hM.push("</tbody></table>");hI.innerHTML=hM.join("")}var T=C.G("divResult"+this.hashCode);this._triggerCbk(ft.CBK_BUSLINEHTML_SET,T)}},_renderBusLineMap:function(hI){if(this._opts.renderOptions.map&&this._busLine&&this._busLine.getNumBusStations()>0){this._clearOverlays();cZ.addRoute(this._opts.renderOptions.map,this._busLine.getPath());var hN=this._busLine.getPolyline();this._triggerCbk(ft.CBK_POLYLINES_SET,hN);var hL=this;this._stops=[];for(var hK=0,e=this._busLine.getNumBusStations();hK<e;hK++){var hM=this._busLine.getBusStation(hK)["position"];var T=this._busLine.getBusStation(hK)["name"];var hJ=cZ.addStationPoi(this._opts.renderOptions.map,hM,T);(function(hQ,hO,hP){hQ.addEventListener("click",function(hS){var i=[\'<div style="font:12px \'+eV.fontFamily+\'">\'];i.push(\'<div style="margin:17px;text-align:center;"><b>\'+hO+"</b></div>");i.push("</div>");var hT=new hy(i.join(""),{height:0,width:150,});hT.addEventListener("open",function(){var hU=C.G("aStop_"+hI+"_"+hP);if(hU){hU.style.backgroundColor="#cccccc"}});hT.addEventListener("close",function(){var hU=C.G("aStop_"+hI+"_"+hP);if(hU){hU.style.backgroundColor="#ffffff"}});var hR=hL._opts.renderOptions.map;if(hR.config.enableStreetEntrance){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(hT,hR.getCurrentCity().code,{panoInstance:hR._pano,lngLat:hS.target.getPosition(),titleTip:hO,type:"busline"},function(){hQ.openSimpleInfoWindow(hT)})}else{hQ.openSimpleInfoWindow(hT)}})})(hJ,T,hK);hJ._stName=T;this._stops.push(hJ)}this._triggerCbk(ft.CBK_MARKERS_SET,this._stops);if(this._opts.renderOptions.autoViewport){this._opts.renderOptions.map.setViewport(hN.getPath(),{margins:[5,5,5,5]})}}},_selectBusStop:function(T,i){if(this._opts.renderOptions.map&&this._stops&&this._stops.length>0){var hI=this._stops[i];if(hI._stName){var hJ=[\'<div style="font:12px \'+eV.fontFamily+\'">\'];hJ.push(\'<div style="margin:17px;text-align:center;"><b>\'+hI._stName+"</b></div>");hJ.push("</div>");var hL=new hy(hJ.join(""),{height:0,width:150,});hL.addEventListener("open",function(){var hM=C.G("aStop_"+T+"_"+i);if(hM){hM.style.backgroundColor="#cccccc"}});hL.addEventListener("close",function(){var hM=C.G("aStop_"+T+"_"+i);if(hM){hM.style.backgroundColor="#ffffff"}});var hK=this._opts.renderOptions.map;if(hK.config.enableStreetEntrance){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(hL,hK.getCurrentCity().code,{panoInstance:hK._pano,lngLat:hI.getPosition(),titleTip:hI._stName,type:"busline"},function(){hI.openSimpleInfoWindow(hL)})}else{hI.openSimpleInfoWindow(hL)}}}else{if(this.preA){this.preA.style.backgroundColor="#ffffff"}var e=C.G("aStop_"+T+"_"+i);if(e){e.style.backgroundColor="#cccccc"}this.preA=e}},_clearOverlays:function(){if(this._opts.renderOptions.map){this._opts.renderOptions.map.clearOverlays()}},_setStatus:function(e){if(typeof e=="number"){this._status=e}else{delete this._status}}});function eJ(e){this["keyword"]=e.keyword||"";this["city"]=e.city;this["moreResultsUrl"]=e.moreUrl;this._listItems=e.listItems&&e.listItems.slice(0)||[];this._cityCode=e._cityCode}C.extend(eJ.prototype,{getBusListItem:function(e){if(this._listItems[e]){return this._listItems[e]}},getNumBusList:function(){return this._listItems.length}});function Y(e){this["name"]=e.name||"";this["startTime"]=e.startTime||"";this["endTime"]=e.endTime||"";this["company"]=e.company||"";this._polyline=e.polyline||{};this._stations=e.stations&&e.stations.slice(0)||[];this._poiType=e._poiType||2}C.extend(Y.prototype,{getBusStation:function(e){if(this._stations[e]){return this._stations[e]}},getNumBusStations:function(){return this._stations.length},getPolyline:function(){return this._polyline},getPath:function(){if(this._polyline.getPath()){return this._polyline.getPath()}}});');
