/**/﻿_jsload&&_jsload('localSearch', 'function gy(e,hJ,i){d5.call(this);if(!e){return}this.container=(typeof(e)=="object")?e:C.G(e);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=hJ;this.update=true;var T={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!i){i=T}for(var hI in i){if(typeof(i[hI])!="undefined"){this[hI]=i[hI]}}this.render()}C.extend(gy.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var i=location.search;var T=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var e=i.match(T);this.page=RegExp.$1},createHtml:function(){var hO=[];var hI=this.page-1;var hL=this.page+1;hO.push(\'<p style="margin:0;padding:0;white-space:nowrap">\');if(hI<1){}else{if(this.page>=this.pagecap){var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp1}">首页</a></span>\';hO.push(T.replace("{temp1}","BMapGL.I(\'"+this.hashCode+"\').toPage(1);"))}var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp2}">上一页</a></span>\';hO.push(T.replace("{temp2}","BMapGL.I(\'"+this.hashCode+"\').toPage("+hI+");"))}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var hJ=this.page-this.pagecap-1}else{var hJ=this.page-this.page%this.pagecap+1}var hM=hJ+this.pagecap-1}else{var hN=Math.floor(this.pagecap/2);var hK=this.pagecap%2-1;if(this.pageCount>this.page+hN){var hM=this.page+hN;var hJ=this.page-hN-hK}else{var hM=this.pageCount;var hJ=this.page-hN-hK}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var hJ=this.pageCount-this.pagecap+1;var hM=this.pageCount}for(var e=hJ;e<=hM;e++){if(e>0){if(e==this.page){hO.push(\'<span style="margin-right:3px">\'+e+"</span>")}else{if(e>=1&&e<=this.pageCount){var T=\'<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="{temp3}">[\'+e+"]</a></span>";hO.push(T.replace("{temp3}","BMapGL.I(\'"+this.hashCode+"\').toPage("+e+");"))}}}}if(hL>this.pageCount){}else{var T=\'<span><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp4}">下一页</a></span>\';hO.push(T.replace("{temp4}","BMapGL.I(\'"+this.hashCode+"\').toPage("+hL+");"))}hO.push("</p>");return hO.join("")},toPage:function(i){var e=i?i:1;if(typeof(this.callback)=="function"){this.callback(e);this.page=e}if(this.update){this.render()}}});dH.isReqDataMap=function(i,e){if(!i||typeof e=="undefined"){return false}if(i==ee&&e!=gW&&e!=gY&&e!=gg&&e!=cd&&e!=an){return false}if(i==f4&&e!=fp){return false}if(i==dG&&e!=cC){return false}if(i==bk&&e!=hG){return false}if(i==X&&e!=eA){return false}if(i==aw&&e!=cx){return false}return true};C.extend(dH.prototype,{_check:function(){for(var T=0,e=this._queryList.length;T<e;T++){var hI=this._queryList[T];this[hI.method].apply(this,hI.arguments)}delete this._queryList;this.initialize()},initialize:function(){var e=this;this.renderMap=new z(e);this.renderList=new g0(e)},search:function(e,i){if(!e||(e instanceof Array&&(e.length<1||e.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE);return}i=i||{};if(i.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:e,searchType:"local",customData:i.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var hI=arguments[2]||{};var T=this;this._getIdByLoc(this._loc,function(hN){hN=hN||1;T._isMultiKey=T._isKeywordArray(e);var hM;if(!T._isMultiKey){hM={qt:i.forceLocal?P:ee,c:hN,wd:e,rn:T.getPageCapacity()}}else{var hL=e.join("$$");var hJ=e.length;hM={qt:X,c:hN,wd:hL,wdn:hJ,rn:T.getPageCapacity()}}if(T._opts.reqFrom){C.extend(hM,{from:T._opts.reqFrom})}C.extend(hM,hI.params);if(i.log){hM.log="center"}var hK={params:hM,options:i,userKw:hI.userKw||e};C.extend(hK,hI);cv.request(function(hP,hO){T._rawDataCbk(hP,hO)},hM,hK)})},_isKeywordArray:function(e){if(e&&e instanceof Array){return true}else{return false}},searchInBounds:function(e,hJ,i){if(!e||!hJ||(e instanceof Array&&(e.length<1||e.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE);return}var i=i||{};var hI=this;if(i.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:e,bounds:hJ,searchType:"bound",customData:i.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var T=arguments[2]||{};this._getIdByLoc(this._loc,function(hR){hR=hR||1;var hQ=hJ.getSouthWest();var hP=hJ.getNorthEast();hQ=ef.convertLL2MC(hQ);hP=ef.convertLL2MC(hP);var hL="("+hQ.lng+","+hQ.lat+";"+hP.lng+","+hP.lat+")";hI._isMultiKey=hI._isKeywordArray(e);var hO;if(!hI._isMultiKey){hO={qt:dG,c:hR,wd:e,ar:hL,rn:hI._opts.pageCapacity,l:18}}else{var hN=e.join("$$");var hK=e.length;hO={qt:bk,c:hR,wd:hN,wdn:hK,ar:hL,rn:hI.getPageCapacity(),l:18}}if(hI._opts.reqFrom){C.extend(hO,{from:hI._opts.reqFrom})}C.extend(hO,T.params);var hM;if(T&&T.center&&T.radius){hM={params:hO,bounds:hJ,center:T.center,radius:T.radius,userKw:T.userKw||e}}else{hM={params:hO,bounds:hJ,userKw:T.userKw||e}}cv.request(function(hT,hS){hI._rawDataCbk(hT,hS)},hO,hM)})},searchNearby:function(hJ,T,hK,hQ){if(!hJ||!T||(!(T instanceof hj||T instanceof cX)&&typeof T=="object"&&!T.uid)||(hJ instanceof Array&&(hJ.length<1||hJ.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE);return}var hQ=hQ||{};if(hQ.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:hJ,center:T,radius:hK,searchType:"nearby",customData:hQ.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}hK=hK||dH.DEFAULT_RADIUS;hK=hK<0?dH.DEFAULT_RADIUS:(hK>dH.MAX_RADIUS?dH.MAX_RADIUS:hK);var hN=this;var i=arguments[3]||{};if(T instanceof hj||T instanceof cX){var hI=ef.convertLL2MC(T);var hM=new hj(hI.lng-hK,hI.lat-hK);var hL=new hj(hI.lng+hK,hI.lat+hK);var hP=ef.convertMC2LL(hM);var hO=ef.convertMC2LL(hL);var e=new dM(new hj(hP.lng,hP.lat),new hj(hO.lng,hO.lat));i.center=T;i.radius=hK;this.searchInBounds(hJ,e,i);return}this._getIdByLoc(this._loc,function(hV){hV=hV||1;hN._isMultiKey=hN._isKeywordArray(hJ);var hT;if(!hN._isMultiKey){hT={qt:f4,c:hV,wd:hJ,rn:hN.getPageCapacity(),uid:T.uid,r:hK}}else{hT={qt:aw,c:hV,wd:hJ.join("$$"),wdn:hJ.length,rn:hN.getPageCapacity(),uid:T.uid,r:hK}}if(typeof T=="string"){if(!hN._isMultiKey){hT.qt=ee;hT.wd=T+" "+hJ}else{hT.qt=X;var hR=[];for(var hS=0;hS<hJ.length;hS++){var hU=T+" "+hJ[hS];hR.push(hU)}hT.wd=hR.join("$$");hT.wdn=hR.length}delete hT.r;delete hT.uid}if(hN._opts.reqFrom){C.extend(hT,{from:hN._opts.reqFrom})}C.extend(hT,i.params);cv.request(function(hX,hW){hN._rawDataCbk(hX,hW)},hT,{params:hT,center:T,radius:hK,userKw:i.userKw||hJ})})},_rawDataCbk:function(hT,hJ){var hS=this;if(hT.result["type"]==hG||hT.result["type"]==eA||hT.result["type"]==cx){hS._isMultiKey=true}else{hS._isMultiKey=false}this.clearResults();hS._json=hT;this._ud=hJ;var T=hT.result;var hQ=hJ.params.qt;if(!hS._isMultiKey){if(T.error!=0||!dH.isReqDataMap(hQ,T.type)){var hL=hT.current_city;this._results=new ct({keyword:hJ.userKw,city:hL.name,province:hL.up_province_name||"",ccode:hL.code,pc:hS.getPageCapacity(),center:hJ.center,radius:hJ.radius,bounds:((hJ.center&&hJ.radius)?undefined:hJ.bounds),moreUrl:this._getMoreUrl(hJ,hL)});this._results._qt=hJ.params.qt;this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._results);hS.renderList.dispatchEvent(new a6("onrender"));return}}else{if(T.error!=0||!dH.isReqDataMap(hQ,T.type)){var hL=hT.current_city;this._arrResults=[];var hI=hJ.userKw;for(var hP=0,hM=hI.length;hP<hM;hP++){var hO=new ct({keyword:hI[hP],city:hL.name,province:hL.up_province_name||"",ccode:hL.code,pc:hS.getPageCapacity(),center:hJ.center,radius:hJ.radius,bounds:((hJ.center&&hJ.radius)?undefined:hJ.bounds),moreUrl:""});hO._qt=hJ.params.qt;this._arrResults.push(hO)}this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._arrResults);hS.renderList.dispatchEvent(new a6("onrender"));return}}hS._processRaw(hJ);hS.renderMap.dispatchEvent(new a6("onrender"));hS.renderList.dispatchEvent(new a6("onrender"));var e=this._ud.center;if(e&&typeof e!="string"&&!(e instanceof hj||e instanceof cX)){this.renderMap.addCenterPoi(e)}var hR=this._json.result&&this._json.result.type;var hK={};switch(hR){case gW:case fp:case cC:case hG:case eA:case cx:hK.points=this._arrPoints;break;case gg:hK.center=this._results.getPoi(0)["point"];hK.level=this._json.content["level"];break;case an:hK.center=this._results.getPoi(0)["point"];hK.level=13;break;case cd:hK.center=this._results.getPoi(0)["point"];hK.level=parseInt(this._json.content[1]);break;default:break}this.renderMap.getBestViewport(hK);var hN;if(!this._isMultiKey){hN=this._results}else{hN=this._getMaxResults()}if(this._opts.renderOptions.selectFirstResult&&hN&&hN.getNumPois()>0){var hS=this;setTimeout(function(){hS.select(0)},240)}},_processRaw:function(hM){var h6=this._json.result,ii=this._json.content,h2=this._json.current_city,ij=h6.type,hQ=this,hN=h6.page_num||0,hZ=0,h7=0,hT=[],h4=[],e=[],ih=[],h1=[],hV=[];if(this._json.psrs&&this._json.psrs["SEResult"]){var hJ=this._json.psrs["SEResult"];if(hJ.length>0){for(var ie=0,hR=hJ.length;ie<hR;++ie){hV.push(hJ[ie])}}}var h9=this._json.suggest_query;if(h9){for(var ie=0,hR=h9.length;ie<hR;++ie){h9[ie]&&h9[ie]["query"]&&hV.push(h9[ie]["query"])}}hV=O.unique(hV);if(ij!=gY&&ij!=cd){var hX;if(!this._isMultiKey){h7=h6.count-(hN==0?(h6.spec_dispnum||0):0);hZ=h6.total<760?h6.total:760;hX=hN==0?(h6.spec_dispnum||0):0}if(ij!=gg){if(!this._isMultiKey){for(var ie=hX;ie<h6.count;ie++){if(ii&&ii[ie]){var hK=ii[ie];if(hK.addr===null){continue}var hU=this._formatAddr(hK.addr,hK.poiType);var hY=[];if(hK.cla&&hK.cla["length"]>0){var hI=hK.cla["length"];while(hI--){var h5=hK.cla[hI][1];h5=h5.replace("<b>","").replace("</b>","");hY.unshift(h5)}}var h3={title:hK.name,uid:hK.uid,point:O.parseGeo(hK.geo,true).point,url:ft._getPoiUrl(hK.uid,h2.code),detailUrl:"https://api.map.baidu.com/place/detail?uid="+hK.uid+"&output=html&source=jsapi",address:hU,city:h2.name,province:h2.up_province_name||"",phoneNumber:hK.tel,postcode:hK.zip,type:hK.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(hK.acc_flag&&hK.acc_flag==1)?true:false};if(hY.length>0){h3.tags=hY}hT.push(h3);h4.push(h3.point);this._arrPois.push(h3)}}}else{var hP=h6.result_array;var h8=hM.userKw.length;for(var ie=0;ie<h8;ie++){ih[ie]=[];h1[ie]=[];e[ie]=[];if(!hP[ie]){continue}if(hP[ie]["type"]==gY){if(ii&&ii[ie]){for(var ic=0;ic<ii[ie].length;ic++){var T=ii[ie][ic];e[ie].push({city:T.name,_code:T.code,numResults:T.num})}}if(this._json.more_city&&this._json.more_city[ie]){var hS=this._json.more_city[ie];for(var ic=0,ia=hS.length;ic<ia;ic++){for(var ib=0,h0=hS[ic]["city"]["length"];ib<h0;ib++){var T=hS[ic]["city"][ib];e[ie].push({city:T.name,_code:T.code,numResults:T.num})}}}continue}var hW=hP[ie]["count"];var hO=hP[ie]["page_num"]||0;var ig=hP[ie]["total"]>760?760:hP[ie]["total"];var hL={count:hW,pagenum:hO,total:ig};h1[ie].push(hL);for(var ic=0;ic<hW;ic++){if(ii&&ii[ie]&&ii[ie][ic]){var hK=ii[ie][ic];if(hK.addr===null){continue}var hU=this._formatAddr(hK.addr,hK.poiType);var hY=[];if(hK.cla&&hK.cla["length"]>0){var hI=hK.cla["length"];while(hI--){var h5=hK.cla[hI][1];h5=h5.replace("<b>","").replace("</b>","");hY.unshift(h5)}}var h3={title:hK.name,uid:hK.uid,point:O.parseGeo(hK.geo,true).point,url:ft._getPoiUrl(hK.uid,h2.code),detailUrl:"https://api.map.baidu.com/place/detail?uid="+hK.uid+"&output=html&source=jsapi",address:hU,city:h2.name,province:h2.up_province_name||"",phoneNumber:hK.tel,postcode:hK.zip,type:hK.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(hK.acc_flag&&hK.acc_flag==1)?true:false,tags:hY};ih[ie].push(h3);h4.push(h3.point);this._arrPois.push(h3)}}}}}else{h7=hZ=1;var h3={title:ii.cname,uid:ii.uid,point:O.parseGeo(ii.geo,true).point,address:ii.cname,url:eV.mapHost+"?s="+encodeURIComponent("s&wd="+h6.wd)};hT.push(h3);this._arrPois.push(h3);h4.push(h3.point)}}else{if(ij==cd){h7=hZ=1;var h3={title:h6.wd,point:O.parseGeoStr(ii[0]),url:eV.mapHost+"?s="+encodeURIComponent("s&wd="+h6.wd)};hT.push(h3);this._arrPois.push(h3);h4.push(h3.point)}if(ij==gY){h7=hZ=0;for(var ie=0;ie<ii.length;ie++){e.push({city:ii[ie]["name"],_code:ii[ie]["code"],numResults:ii[ie]["num"]})}if(this._json.more_city){var hS=this._json.more_city;for(var ie=0,ia=hS.length;ie<ia;ie++){for(var ic=0,h0=hS[ie]["city"]["length"];ic<h0;ic++){var ii=hS[ie].city[ic];e.push({city:ii.name,_code:ii.code,numResults:ii.num})}}}}}this._arrPoints=h4;if(!this._isMultiKey){this._results=new ct({keyword:hM.userKw,count:h7,total:hZ,pageIdx:h6.page_num,city:h2.name,province:h2.up_province_name||"",ccode:h2.code,pois:hT,cityList:e,pc:hQ.getPageCapacity(),center:hM.center,radius:hM.radius,bounds:((hM.center&&hM.radius)?undefined:hM.bounds),moreUrl:this._getMoreUrl(hM,h2),suggestions:hV});this._results._qt=hM.params.qt;if(hZ==0&&ij!=gY){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{if(ij!=gY){this._setStatus(BMAP_STATUS_SUCCESS)}else{this._setStatus(BMAP_STATUS_CITY_LIST)}}this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._results)}else{this._arrResults=[];var h8=hM.userKw.length;var id=true;for(var ie=0;ie<h8;ie++){if(h1[ie].length>0&&h1[ie][0].total>0){id=false}var hT=new ct({keyword:hM.userKw[ie]||"",count:h1[ie].length>0?h1[ie][0].count:0,total:h1[ie].length>0?h1[ie][0].total:0,pageIdx:h1[ie].length>0?h1[ie][0].pagenum:0,city:h2.name,province:h2.up_province_name||"",ccode:h2.code,pois:ih[ie]||[],cityList:e[ie]||[],pc:hQ.getPageCapacity(),center:hM.center,radius:hM.radius,bounds:((hM.center&&hM.radius)?undefined:hM.bounds),moreUrl:"",suggestions:hV});hT._qt=hM.params.qt;this._arrResults.push(hT)}if(id){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{this._setStatus(BMAP_STATUS_SUCCESS)}this._triggerCbk(ft.CBK_SEARCH_COMPLETE,this._arrResults)}},_getMoreUrl:function(i,hI){var hM="";var hK=typeof i.center=="string"?(i.center+" "+i.userKw):i.userKw;var hN=hI.name,hL,hP,e,T="";if(typeof i.center=="object"&&!(i.center instanceof hj||i.center instanceof cX)){hP=i.center.point;hL=i.radius}if(i.bounds&&!i.center){e=i.bounds}if(i.center&&(i.center instanceof hj||i.center instanceof cX)){hP=i.center;hL=i.radius}hM=eV.apiHost+"/place/search?res=jsapi&query="+hK+"&region="+hN+"&output=html";if(hP){hM+="&location="+hP.lat+","+hP.lng+"&radius="+hL}if(e){var hO=e.getSouthWest();var hJ=e.getNorthEast();hM+="&bounds="+hO.lat+","+hO.lng+","+hJ.lat+","+hJ.lng}return hM},_formatAddr:function(i,e){e=e||BMAP_POI_TYPE_NORMAL;if(e==BMAP_POI_TYPE_BUSSTOP||e==BMAP_POI_TYPE_SUBSTOP){return O.unique(i.split(";")).join("; ")}return i},_chkMultiKeyResults:function(hJ){for(var hI=0,e=hJ.length;hI<e;hI++){var T=hJ[hI];if(T.getCurrentNumPois()>0){return true}}return false},_clearOverlays:function(){for(var T=0,e=this._overlays.length;T<e;T++){this._overlays[T].remove();this._overlays[T]=null}this._overlays.length=0;for(var T=0,e=this._arrPois.length;T<e;T++){this._arrPois[T]=null}this._arrPois.length=0;if(this._centerMkr){this._centerMkr.remove();this._centerMkr=null}},_getMaxResults:function(){if(!this._isMultiKey){return this._results}var hK;var e=-1;for(var hJ=0,T=this._arrResults.length;hJ<T;hJ++){var hI=this._arrResults[hJ];if(hI.getNumPages()>e){hK=hI;e=hI.getNumPages()}}return hK},clearResults:function(){delete this._json;delete this._status;delete this._results;if(this._isMultiKey){delete this._arrResults}delete this._ud;this._curIndex=-1;this._setStatus();this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},gotoPage:function(i){if(this._useCustomdata){this.customSearch.gotoPage(i);return}if(this._ud){var e;if(!this._isMultiKey){e=this._results}else{e=this._getMaxResults()}if(typeof i=="number"&&!isNaN(i)&&i>=0&&i<=e.getNumPages()-1){this._ud.params.pn=i;var T=this._ud.params.qt;switch(T){case ee:case P:this.search(this._ud.params.wd,this._ud.options,this._ud);break;case dG:this.searchInBounds(this._ud.params.wd,this._ud.bounds,this._ud);break;case f4:this.searchNearby(this._ud.params.wd,this._ud.center,this._ud.radius,this._ud);break;case bk:this.searchInBounds(this._ud.userKw,this._ud.bounds,this._ud);break;case X:this.search(this._ud.userKw,this._ud.options,this._ud);break;case aw:this.searchNearby(this._ud.userKw,this._ud.center,this._ud.radius,this._ud);break;default:break}}else{this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(ft.CBK_SEARCH_COMPLETE)}}},_createCustomSearchInstance:function(){if(!this.customSearch){var e=this;this.customSearch=new CustomSearch(e)}},select:function(e){this.renderMap.select(e);this.renderList.select(e);this._curIndex=e}});function ct(e){this["keyword"]=e.keyword||"";this._pageIndex=e.pageIdx||0;this._currentNumPois=e.count||0;this._numPois=e.total||0;this._numPages=Math.ceil(e.total/e.pc);this["center"]=e.center;this["radius"]=e.radius;this["bounds"]=e.bounds;this["city"]=e.city;this["province"]=e.province;this["viewport"]=e.viewport;this["moreResultsUrl"]=e.moreUrl;this._pois=e.pois&&e.pois.slice(0)||[];this._cityList=e.cityList&&e.cityList.slice(0);this["suggestions"]=e.suggestions||[]}C.extend(ct.prototype,{getPoi:function(e){if(this._pois[e]){return this._pois[e]}},getNumPois:function(){return this._numPois},getNumPages:function(){return this._numPages},getCurrentNumPois:function(){return this._currentNumPois},getPageIndex:function(){return this._pageIndex},getCityList:function(){return this._cityList},toString:function(){return"LocalResult"}});function z(e){d5.call(this);this.localSearch=e;this.map=e._opts.renderOptions.map;this._overlays=e._overlays;this.initialize()}z.inherits(d5,"RenderMap");C.extend(z.prototype,{initialize:function(){this.addEventListener("onrender",this._render)},_render:function(){if(!this.map){return}var hK=this;var hL=this.localSearch._arrPois;var hJ=[];for(var hI=0,e=hL.length;hI<e;hI++){var hM=hL[hI];hJ.push(hM.point);var T=this._addPoi(hM.point,hI,hM.title);if(!T){continue}hM.marker=T;(function(){var i=hI;T.addEventListener("click",function(){hK.localSearch.select(i)})})();this._overlays.push(T)}this.localSearch._triggerCbk(ft.CBK_MARKERS_SET,hL)},addCenterPoi:function(hI){var e=hI;var i=this;if(e&&typeof e!="string"&&!(e instanceof hj||e instanceof cX)){var T=this.localSearch._centerMkr=cZ.addCenterPoi(this.map,e.point,e.title);T.addEventListener("click",function(){i.localSearch.select(-1);i.localSearch._curIndex="c";var hJ=i._createInfoWindowByPoi(hI);T.openInfoWindow(hJ)})}},_addPoi:function(T,e,hI){if(this.localSearch._opts.pageCapacity<=dH.DEFAULT_PAGE_CAPACITY&&!this.localSearch._isMultiKey){return cZ.addSearchPoi(this.map,T,e,hI)}else{return cZ.addSearchInBoundsPoi(this.map,T,hI)}},select:function(hJ){if(this.map&&hJ>-1&&this._overlays[hJ]){if(fW()){var i=null;for(var hI=0,e=this._overlays.length;hI<e;hI++){i=this._overlays[hI];if(hJ==hI){i.setIcon(i.icoActive)}else{i.setIcon(i.icoDefault)}i.draw}}else{for(var hI=0,e=this._overlays.length;hI<e;hI++){i=this._overlays[hI];i.setTop(false)}}this.map.closeInfoWindow();var hL=this.localSearch._arrPois[hJ];if(!hL){return}var T=this._createInfoWindowByPoi(hL);var hK=this._overlays[hJ];hK.setTop(true);hK.openInfoWindow(T)}},_createInfoWindowByPoi:function(T){var e=cZ.createSearchInfoWnd({title:T.title,addr:T.address,tel:T.phoneNumber,url:T.url,detailUrl:T.detailUrl,uid:T.uid,poiType:T.type});var i=this;e.addEventListener("close",function(){i.localSearch.renderList.clearSelected()});e.addEventListener("open",function(){i.localSearch._triggerCbk(ft.CBK_INFO_HTML_SET,T,cZ.getInfoWindowDom(i.map))});return e},getBestViewport:function(i){var e=this.localSearch._opts.renderOptions;if(this.map){if(i.points){var hK=i.points;var hI=!e.autoViewport,hJ=!e.selectFirstResult&&e.autoViewport,T=this.map.getViewport(hK,{margins:[30,30,30,30]});if(!hI){this.map.setViewport(T,{enableAnimation:hJ})}}else{i.level=O.getBestLevel(i.level,this.map);if(e.autoViewport){this.map.centerAndZoom(i.center,i.level)}}}}});function g0(e){d5.call(this);this.localSearch=e;this.panel=e._opts.renderOptions.panel;this.initialize()}g0.inherits(d5,"RenderList");C.extend(g0.prototype,{initialize:function(){this.addEventListener("render",this._render)},_render:function(){if(!this.panel){return}var T=S("div",{style:"font:12px "+eV.fontFamily+";border:1px solid #999;"});var hK=S("div",{style:"background:#fff"});var hM=S("ol",{style:"list-style:none;padding:0;margin:0"});var hJ=this.localSearch.getStatus();var e=null;if(hJ==BMAP_STATUS_SUCCESS){for(var hL=0,hI=this.localSearch._arrPois.length;hL<hI;hL++){var hO=this._createItem(hL);hM.appendChild(hO)}}else{if(hJ==BMAP_STATUS_CITY_LIST){if(hJ==BMAP_STATUS_CITY_LIST&&!this.localSearch._isMultiKey){for(var hL=0,hI=Math.min(6,this.localSearch._results.getCityList().length);hL<hI;hL++){var hO=this._createCityItem(hL);hM.appendChild(hO)}}}else{var hN="";switch(hJ){case BMAP_STATUS_UNKNOWN_LOCATION:hN="抱歉，未找到相关地点。";break;case BMAP_STATUS_INVALID_KEY:hN="抱歉，您所提供的key无效。";break}var hO=S("li",{style:"margin:2px 0;padding:0 5px 0 3px;overflow:hidden;line-height:17px"});hO.innerHTML=hN;hM.appendChild(hO)}}hK.appendChild(hM);T.appendChild(hK);e=this._createResultsControl();T.appendChild(e);this.panel.appendChild(T);this.localSearch._triggerCbk(ft.CBK_RESULTS_HTML_SET,T)},_createItem:function(hK){var e=this.localSearch._arrPois;if(!e||!e[hK]){return}var T=e[hK],hR=S("li",{style:"margin:2px 0;padding:0 5px 5px 0px;cursor:pointer;overflow:hidden;line-height:17px;*zoom:1;"});if(this.localSearch._curIndex>-1&&hK==this.localSearch._curIndex){hR.style.backgroundColor="#f0f0f0"}var i=eV.staticHost+"/wolfman/static/common/images/";i+="markers_new2x_2960fb4.png";var hI="-139px";var hJ=hK==0?"0px":"-"+hK*18+"px";if(this.localSearch._opts.pageCapacity>dH.DEFAULT_PAGE_CAPACITY||this.localSearch._isMultiKey){hJ="-180px"}var hQ=[\'<span style="background:url(\'+i+") "+hJ+" "+hI+\' no-repeat;background-size: 300px 300px;width:18px;height:27px;cursor:pointer;float:left;*zoom:1;overflow:hidden;margin:2px 3px 0 5px;*margin-right:0px;display:inline;">&nbsp;</span>\'];var hP,hN,hL;if(!this.localSearch._isMultiKey){hL=this.localSearch._results.keyword}else{hL=this.localSearch._ud.userKw.join("|")}var hO=new RegExp(hL,"ig");if(T.title){hP=T.title.replace(hO,"<b>$&</b>")}if(T.type==BMAP_POI_TYPE_BUSSTOP){hP+="-公交车站"}else{if(T.type==BMAP_POI_TYPE_SUBSTOP){hP+="-地铁站"}}hQ.push(\'<div style="zoom:1;overflow:hidden;padding:0 5px;">\');hQ.push(\'<div style="line-height:20px;font-size:12px;"><span style="color:#00c;">\'+hP+"</span>");if(T.detailUrl){hQ.push(\'<a target="_blank" href="\'+T.detailUrl+\'" style="margin-left:5px;font-size:12px;color:#3d6dcc;font-weight:normal;text-decoration:none;">详情&raquo;</a>\')}hQ.push("</div>");if(T.address){hN=T.address.replace(hO,"<b>$&</b>");hQ.push(\'<div style="padding:2px 0;line-height:18px;*zoom:1;overflow:hidden;"><b style="float:left;font-weight:bold;*zoom:1;overflow:hidden;padding-right:5px;*margin-right:-3px;">地址:</b><span style="color:#666;display:block;zoom:1;overflow:hidden;">\'+hN+"</span></div>")}if(T.phoneNumber){hQ.push(\'<div style="padding:2px 0;line-height:18px;*zoom:1;overflow:hidden;"><b style="float:left;font-weight:bold;*zoom:1;overflow:hidden;padding-right:5px;*margin-right:-3px;">电话:</b><span style="color:#666;">\'+T.phoneNumber+"</span></div>")}hQ.push("</div>");hR.innerHTML=hQ.join("");var hM=this;hR.onclick=function(){hM.localSearch.select(hK)};return hR},_createResultsControl:function(){var i=this;var hJ=S("div",{style:"white-space:nowrap;text-align:right;background:#e5ecf9;margin-top:5px;padding:2px;overflow:hidden;zoom:1;"});if(!this.localSearch._isMultiKey&&!this.localSearch._useCustomdata){var T=S("a",{style:"color:#7777cc;float:right;",href:this.localSearch._results.moreResultsUrl,target:"_blank",title:"到百度地图查看更多结果"});T.innerHTML="更多结果&#187;";hJ.appendChild(T)}var e=S("div",{style:"float:left;margin-right:5px"});var hI=this.localSearch._getMaxResults();if(this.localSearch._arrPois.length>0){var hK=new gy(e,function(hL){i.localSearch.gotoPage(hL-1)},{pageCount:hI.getNumPages(),page:hI.getPageIndex()+1,update:false})}hJ.appendChild(e);return hJ},clearSelected:function(){if(this.panel){if(typeof this.localSearch._curIndex=="number"&&this.localSearch._curIndex!=-1&&this.panel.getElementsByTagName("li")[this.localSearch._curIndex]){this.panel.getElementsByTagName("li")[this.localSearch._curIndex].childNodes[1].style.backgroundColor=""}}this.localSearch._curIndex=-1},select:function(i){if(this.panel){var e=this.localSearch._curIndex;if(typeof e=="number"&&e!=-1&&this.panel.getElementsByTagName("li")[e]){this.panel.getElementsByTagName("li")[e].childNodes[1].style.backgroundColor=""}if(typeof i=="number"&&i!=-1&&this.panel.getElementsByTagName("li")[i]){this.panel.getElementsByTagName("li")[i].childNodes[1].style.backgroundColor="#f0f0f0"}}},_createCityItem:function(e){var hI=S("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});hI._index=e;var hJ=this.localSearch._results.getCityList();hI.innerHTML=\'<span style="color:#00c;text-decoration:underline"333>\'+hJ[e]["city"]+\'</span> <span style="color:#666">(共\'+hJ[e]["numResults"]+"条结果)</span>";var T=this.localSearch;var i=T._results;hI.onclick=function(){T.setLocation(i.getCityList()[e]["city"]);T.search(i.keyword)};return hI}});');
